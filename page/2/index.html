<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="gleamwang" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="gleamwang">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="gleamwang">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gleamwang">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> gleamwang </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?efdc2faeb9f92acd5d4ea8e8cd639fdd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">gleamwang</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/17/macOS-Security-and-Privacy-Guide/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/17/macOS-Security-and-Privacy-Guide/" itemprop="url">
                  【译】MacOS 的安全和隐私指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-17T00:00:00+08:00">
                2016-12-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/17/macOS-Security-and-Privacy-Guide/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/17/macOS-Security-and-Privacy-Guide/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MacOS-的安全和隐私指南"><a href="#MacOS-的安全和隐私指南" class="headerlink" title="MacOS 的安全和隐私指南"></a>MacOS 的安全和隐私指南</h1><ul>
<li>原文地址：<a href="https://github.com/drduh/macOS-Security-and-Privacy-Guide" target="_blank" rel="external">macOS Security and Privacy Guide</a></li>
<li>原文作者：<a href="https://github.com/drduh" target="_blank" rel="external">drduh</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a></li>
<li>译者：<a href="https://github.com/yifili09" target="_blank" rel="external">Nicolas(Yifei) Li</a>, <a href="https://github.com/MAYDAY1993" target="_blank" rel="external">MAYDAY1993</a>, <a href="https://github.com/DeadLion" target="_blank" rel="external">DeadLion</a></li>
<li>校对者：<a href="https://github.com/lovelyCiTY" target="_blank" rel="external">lovelyCiTY</a>, <a href="https://github.com/sqrthree" target="_blank" rel="external">sqrthree</a></li>
</ul>
<p>这里汇集了一些想法，它们是有关如何保护运行了 macOS 10.12 “Sierra” 操作系统（以前是 <strong>OS X</strong>）的现代化苹果 Mac 电脑，也包含了一些提高个人网络隐私的小贴士。</p>
<p>这份指南的目标读者是那些希望采用企业级安全标准的”高级用户”，但是也适用于那些想在 Mac 上提高个人隐私和安全性的初级用户们。</p>
<p>一个系统的安全与否完全取决于管理员的能力。没有一个单独的技术、软件，或者任何一个科技能保证计算机完全安全；现代的计算机和操作系统都是非常复杂的，并且需要大量的增量修改才能获得在安全性和隐私性上真正意义的提高。</p>
<p><strong>免责声明</strong>：若按照以下操作后对您的 Mac 电脑造成损伤，<strong>望您自行负责</strong>。</p>
<p>如果你发现了本文中的错误或者有待改进的内容，请提交 <code>pull request</code> 或者 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues" target="_blank" rel="external">创建一个 <code>issue</code></a>.</p>
<ul>
<li><a href="#基础知识">基础知识</a></li>
<li><a href="#固件">固件</a></li>
<li><a href="#准备和安装-macos">准备和安装 macOS</a><ul>
<li><a href="#虚拟机">虚拟机</a></li>
</ul>
</li>
<li><a href="#首次启动">首次启动</a></li>
<li><a href="#管理员和普通用户账号">管理员和普通用户账号</a></li>
<li><a href="#对整个磁盘进行数据加密">对整个磁盘进行数据加密</a></li>
<li><a href="#防火墙">防火墙</a><ul>
<li><a href="#应用程序层的防火墙">应用程序层的防火墙</a></li>
<li><a href="#第三方防火墙">第三方防火墙</a></li>
<li><a href="#内核级的数据包过滤">内核级的数据包过滤</a></li>
</ul>
</li>
<li><a href="#系统服务">系统服务</a></li>
<li><a href="#spotlight-建议">Spotlight 建议</a></li>
<li><a href="#homebrew">Homebrew</a></li>
<li><a href="#dns">DNS</a><ul>
<li><a href="#hosts-文件">Hosts 文件</a></li>
<li><a href="#dnsmasq">Dnsmasq</a><ul>
<li><a href="#检测-dnssec-验证">检测 DNSSEC 验证</a></li>
</ul>
</li>
<li><a href="#dnscrypt">DNSCrypt</a></li>
</ul>
</li>
<li><a href="#captive-portal">Captive portal</a></li>
<li><a href="#证书授权">证书授权</a></li>
<li><a href="#openssl">OpenSSL</a></li>
<li><a href="#curl">Curl</a></li>
<li><a href="#web">Web</a><ul>
<li><a href="#代理">代理</a></li>
<li><a href="#浏览器">浏览器</a></li>
<li><a href="#插件">插件</a></li>
</ul>
</li>
<li><a href="#pgpgpg">PGP/GPG</a></li>
<li><a href="#otr">OTR</a></li>
<li><a href="#tor">Tor</a></li>
<li><a href="#vpn">VPN</a></li>
<li><a href="#病毒和恶意软件">病毒和恶意软件</a></li>
<li><a href="#系统完整性保护">系统完整性保护</a></li>
<li><a href="#gatekeeper-和-xprotect">Gatekeeper 和 XProtect</a></li>
<li><a href="#密码">密码</a></li>
<li><a href="#备份">备份</a></li>
<li><a href="#wi-fi">Wi-Fi</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#物理访问">物理访问</a></li>
<li><a href="#系统监控">系统监控</a><ul>
<li><a href="#openbsm-监测">OpenBSM 监测</a></li>
<li><a href="#dtrace">DTrace</a></li>
<li><a href="#运行">运行</a></li>
<li><a href="#网络">网络</a></li>
</ul>
</li>
<li><a href="#二进制白名单">二进制白名单</a></li>
<li><a href="#其它">其它</a></li>
<li><a href="#相关软件">相关软件</a></li>
<li><a href="#其它资源">其它资源</a></li>
</ul>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>安全标准的最佳实践适用于以下几点:</p>
<ul>
<li><p>创建一个威胁模型</p>
<ul>
<li>考虑下什么是你需要保护的，避免谁的侵害？你的对手会是一个 <a href="https://theintercept.com/document/2015/03/10/strawhorse-attacking-macos-ios-software-development-kit/" target="_blank" rel="external">TLA</a> 机构么？（如果是的，你需要考虑替换使用 <a href="http://www.openbsd.org" target="_blank" rel="external">OpenBSD</a>），或者是一个在网络上好管闲事的偷听者，还是一起针对你精心策划的 <a href="https://en.wikipedia.org/wiki/Advanced_persistent_threat" target="_blank" rel="external">apt</a> 网络攻击？</li>
<li>研究并识别出<a href="https://www.usenix.org/system/files/1401_08-12_mickens.pdf" target="_blank" rel="external">那些威胁</a>，想一想如何减少被攻击的面。</li>
</ul>
</li>
<li><p>保持系统更新</p>
<ul>
<li>请为你的系统和软件持续更新补丁！更新补丁！更新补丁！（重要的事情说三遍）。</li>
<li>可以使用 <code>App Store</code> 应用程序来完成对 <code>macOS</code> 系统的更新，或者使用命令行工具 <code>softwareupdate</code>，这两个都不需要注册苹果账号。</li>
<li>请为那些你经常使用的程序，订阅公告邮件列表（例如，<a href="https://lists.apple.com/mailman/listinfo/security-announce" target="_blank" rel="external">Apple 安全公告</a>）。</li>
</ul>
</li>
<li><p>对敏感数据进行加密</p>
<ul>
<li>除了对整个磁盘加密之外，创建一个或者多个加密的容器，用它们来保存一些你的密码、秘钥、那些个人文件和余下的其他数据。</li>
<li>这有助于减少数据泄露造成的危害。</li>
</ul>
</li>
<li><p>经常备份数据</p>
<ul>
<li>定期创建<a href="https://www.amazon.com/o/ASIN/0596102461/backupcentral" target="_blank" rel="external">数据备份</a>，并且做好遇到危机时候的数据恢复工作。</li>
<li>在拷贝数据备份到外部存储介质或者 “云” 系统中之前，始终对它们进行加密。</li>
<li>定期对备份进行测试，验证它们是可以工作的。例如，访问某一部分文件或者对比哈希校验值。</li>
</ul>
</li>
<li><p>注意钓鱼网站</p>
<ul>
<li>最后，具有高安全意识的管理员能大大降低系统的安全风险。</li>
<li>在安装新软件的时候，请加倍小心。始终选择<a href="https://www.gnu.org/philosophy/free-sw.en.html" target="_blank" rel="external">免费的软件</a>和开源的软件（<a href="https://superuser.com/questions/19492/is-mac-os-x-open-source" target="_blank" rel="external">当然了，macOS 不是开源的</a>)</li>
</ul>
</li>
</ul>
<h2 id="固件"><a href="#固件" class="headerlink" title="固件"></a>固件</h2><p>为固件设定一个密码，它能阻止除了你的启动盘之外的任何其它设备启动你的 Mac 电脑。它也能设定成每次启动时为必选项。</p>
<p><a href="https://www.ftc.gov/news-events/blogs/techftc/2015/08/virtues-strong-enduser-device-controls" target="_blank" rel="external">当你的计算机被盗的时候，这个功能是非常有用的</a>，因为唯一能重置固件密码的方式是通过 <code>Apple Store</code>，或者使用一个 <a href="https://reverse.put.as/2016/06/25/apple-efi-firmware-passwords-and-the-scbo-myth/" target="_blank" rel="external">SPI 程序</a>，例如 <a href="http://ho.ax/posts/2012/06/unbricking-a-macbook/" target="_blank" rel="external">Bus Pirate</a> 或者其它刷新电路的程序。</p>
<ol>
<li><p>开始时，按下 <code>Command</code> 和 <code>R</code> 键来启动<a href="https://support.apple.com/en-au/HT201314" target="_blank" rel="external">恢复模式 / Recovery Mode</a>。</p>
</li>
<li><p>当出现了恢复模式的界面，从 <code>Utilities / 工具</code> 菜单中选择 <strong>Firmware Password Utility / 固件密码实用工具</strong>。</p>
</li>
<li><p>在固件工具窗口中，选择 <strong>Turn On Firmware Password / 打开固件密码</strong>。</p>
</li>
<li><p>输入一个新的密码，之后在 <strong>Verify / 验证</strong> 处再次输入一样的密码。</p>
</li>
<li><p>选择 <strong>Set Password / 设定密码</strong>。</p>
</li>
<li><p>选择 <strong>Quit Firmware Utility / 退出固件工具</strong> 关闭固件密码实用工具。</p>
</li>
<li><p>选择 Apple 菜单，并且选择重新启动或者关闭计算机。</p>
</li>
</ol>
<p>这个固件密码会在下一次启动后激活。为了验证这个密码，在启动过程中按住 <code>Alt</code> 键 - 按照提示输入密码。</p>
<p>当启动进操作系统以后。固件密码也能通过 <code>firmwarepasswd</code> 工具管理。</p>
<p><img width="750" alt="Using a Dediprog SF600 to dump and flash a 2013 MacBook SPI Flash chip to remove a firmware password, sans Apple" src="https://cloud.githubusercontent.com/assets/12475110/17075918/0f851c0c-50e7-11e6-904d-0b56cf0080c1.png"></p>
<p><strong>在没有 Apple 技术支持下，使用 <a href="http://www.dediprog.com/pd/spi-flash-solution/sf600" target="_blank" rel="external">Dediprog SF600</a> 来输出并且烧录一个 2013 款的 MacBook SPI 闪存芯片，或者移除一个固件密码</strong></p>
<p>可参考 <a href="https://support.apple.com/en-au/HT204455" target="_blank" rel="external">HT204455</a>, <a href="https://github.com/LongSoft/UEFITool" target="_blank" rel="external">LongSoft/UEFITool</a> 或者 <a href="https://github.com/chipsec/chipsec" target="_blank" rel="external">chipsec/chipsec</a> 了解更多信息。</p>
<h2 id="准备和安装-macOS"><a href="#准备和安装-macOS" class="headerlink" title="准备和安装 macOS"></a>准备和安装 macOS</h2><p>有很多种方式来安装一个全新的 macOS 副本。</p>
<p>最简单的方式是在启动过程中按住 <code>Command</code> 和 <code>R</code> 键进入 <a href="https://support.apple.com/en-us/HT201314" target="_blank" rel="external">Recovery Mode / 恢复模式</a>。系统镜像文件能够直接从 <code>Apple</code> 官网上下载并且使用。然而，这样的方式会以明文形式直接在网络上暴露出你的机器识别码和其它的识别信息。</p>
<p><img width="500" alt="PII is transmitted to Apple in plaintext when using macOS Recovery" src="https://cloud.githubusercontent.com/assets/12475110/20312189/8987c958-ab20-11e6-90fa-7fd7c8c1169e.png"></p>
<p><strong>在 macOS 恢复过程中，捕获到未加密的 HTTP 会话包</strong></p>
<p>另一种方式是，从 <a href="https://itunes.apple.com/us/app/macos-sierra/id1127487414" target="_blank" rel="external">App Store</a> 或者其他地方下载 <strong>macOS Sierra</strong> 安装程序，之后创建一个自定义可安装的系统镜像。</p>
<p>这个 macOS Sierra 安装应用程序是经过<a href="https://developer.apple.com/library/mac/documentation/Security/Conceptual/CodeSigningGuide/Procedures/Procedures.html#//apple_ref/doc/uid/TP40005929-CH4-SW6" target="_blank" rel="external">代码签名的</a>，它可以使用 <code>code sign</code> 命令来验证并确保你接收到的是一个正版文件的拷贝。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ codesign -dvv /Applications/Install\ macOS\ Sierra.app</div><div class="line">Executable=/Applications/Install macOS Sierra.app/Contents/MacOS/InstallAssistant</div><div class="line">Identifier=com.apple.InstallAssistant.Sierra</div><div class="line">Format=app bundle with Mach-O thin (x86_64)</div><div class="line">CodeDirectory v=20200 size=297 flags=0x200(kill) hashes=5+5 location=embedded</div><div class="line">Signature size=4167</div><div class="line">Authority=Apple Mac OS Application Signing</div><div class="line">Authority=Apple Worldwide Developer Relations Certification Authority</div><div class="line">Authority=Apple Root CA</div><div class="line">Info.plist entries=30</div><div class="line">TeamIdentifier=K36BKF7T3D</div><div class="line">Sealed Resources version=2 rules=7 files=137</div><div class="line">Internal requirements count=1 size=124</div></pre></td></tr></table></figure>
<p>macOS 安装程序也可以由 <code>createinstallmedia</code> 工具制作，它在 <code>Install macOS Sierra.app/Contents/Resources/</code> 文件路径中。请参考<a href="https://support.apple.com/en-us/HT201372" target="_blank" rel="external">为 macOS 制作一个启动安装程序</a>，或者直接运行这个命令（不需要输入任何参数），看看它是如何工作的。</p>
<p><strong>注意</strong> Apple 的安装程序<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/120" target="_blank" rel="external">并不能跨版本工作</a>。如果你想要创造一个 10.12 的镜像，例如，以下指令也必须要在 10.12 的机器上运行!</p>
<p>为了创建一个 <strong>macOS USB 启动安装程序</strong>，需要挂载一个 USB 驱动器，清空它的内容、进行重新分区，之后使用 <code>createinstallmedia</code> 工具:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ diskutil list</div><div class="line">[Find disk matching correct size, usually &quot;disk2&quot;]</div><div class="line"></div><div class="line">$ diskutil unmountDisk /dev/disk2</div><div class="line"></div><div class="line">$ diskutil partitionDisk /dev/disk2 1 JHFS+ Installer 100%</div><div class="line"></div><div class="line">$ cd /Applications/Install\ macOS\ Sierra.app</div><div class="line"></div><div class="line">$ sudo ./Contents/Resources/createinstallmedia --volume /Volumes/Installer --applicationpath /Applications/Install\ macOS\ Sierra.app --nointeraction</div><div class="line">Erasing Disk: 0%... 10%... 20%... 30%... 100%...</div><div class="line">Copying installer files to disk...</div><div class="line">Copy complete.</div><div class="line">Making disk bootable...</div><div class="line">Copying boot files...</div><div class="line">Copy complete.</div><div class="line">Done.</div></pre></td></tr></table></figure>
<p>为了创建一个自定义、可安装的镜像，能用它恢复一台 Mac 电脑，你需要找到 <code>InstallESD.dmg</code>，这个文件也包含在 <code>Install macOS Sierra.app</code> 中。</p>
<p>通过 <code>Finder</code> 找到，并在这个应用程序图标上点击鼠标右键，选择 <strong>Show Package Contents / 显示包内容</strong>，之后从 <strong>Contents / 内容</strong> 进入到 <strong>SharedSupport / 共享支持</strong>，找到 <code>InstallESD.dmg</code> 文件。</p>
<p>你能通过 <code>openssl sha1 InstallESD.dmg</code> 、<code>shasum -a 1 InstallESD.dmg</code> 或者 <code>shasum -a 256 InstallESD.dmg</code> 得到的加密过的哈希值<a href="https://support.apple.com/en-us/HT201259" target="_blank" rel="external">验证</a>来确保你得到的是同一份正版拷贝（在 Finder 中，你能把文件直接拷贝到终端中，它能提供这个文件的完整路径地址）。</p>
<p>可以参考 <a href="https://support.apple.com/en-us/HT204319" target="_blank" rel="external">HT204319</a>，它能确定你最初采购来的计算机使用了哪个版本的 macOS，或者哪个版本适合你的计算机。</p>
<p>可以参考 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/blob/master/InstallESD_Hashes.csv" target="_blank" rel="external">InstallESD_Hashes.csv</a> 这个在我代码仓库中的文件，它是现在和之前该版本文件的哈希值。你也可以使用 Google 搜索这些加密的哈希值，确保这个文件是正版且没有被修改过的。</p>
<p>可以使用 <a href="https://github.com/MagerValp/AutoDMG" target="_blank" rel="external">MagerValp/AutoDMG</a> 来创建这个镜像文件，或者手动创建、挂载和安装这个操作系统到一个临时镜像中:</p>
<pre><code>$ hdiutil attach -mountpoint /tmp/install_esd ./InstallESD.dmg

$ hdiutil create -size 32g -type SPARSE -fs HFS+J -volname &quot;macOS&quot; -uid 0 -gid 80 -mode 1775 /tmp/output.sparseimage

$ hdiutil attach -mountpoint /tmp/os -owners on /tmp/output.sparseimage

$ sudo installer -pkg /tmp/install_esd/Packages/OSInstall.mpkg -tgt /tmp/os -verbose
</code></pre><p>这一步需要花费一些时间，请耐心等待。你能使用 <code>tail -F /var/log/install.log</code> 命令在另一个终端的窗口内查看进度。</p>
<p><strong>（可选项）</strong> 安装额外的软件，例如，<a href="https://www.wireshark.org/download.html" target="_blank" rel="external">Wireshark</a>:</p>
<pre><code>$ hdiutil attach Wireshark\ 2.2.0\ Intel\ 64.dmg

$ sudo installer -pkg /Volumes/Wireshark/Wireshark\ 2.2.0\ Intel\ 64.pkg -tgt /tmp/os

$ hdiutil unmount /Volumes/Wireshark
</code></pre><p>遇到安装错误时，请参考 <a href="https://github.com/MagerValp/AutoDMG/wiki/Packages-Suitable-for-Deployment" target="_blank" rel="external">MagerValp/AutoDMG/wiki/Packages-Suitable-for-Deployment</a>，使用 <a href="https://github.com/chilcote/outset" target="_blank" rel="external">chilcote/outset</a> 来替代解决首次启动时候的包和脚本。</p>
<p>当你完成的时候，分离、转换并且验证这个镜像:</p>
<pre><code>$ hdiutil detach /tmp/os

$ hdiutil detach /tmp/install_esd

$ hdiutil convert -format UDZO /tmp/output.sparseimage -o ~/sierra.dmg

$ asr imagescan --source ~/sierra.dmg
</code></pre><p>现在，<code>sierra.dmg</code> 已经可以被用在一个或者多个 Mac 电脑上了。它能继续自定义化这个镜像，比如包含预先定义的用户、应用程序、预置参数等。</p>
<p>这个镜像能使用另一个在 <a href="https://support.apple.com/en-us/HT201462" target="_blank" rel="external">Target Disk Mode / 目标磁盘模式</a> 下的 Mac 进行安装，或者从 USB 启动安装盘安装。</p>
<p>为了使用 <strong>Target Disk Mode / 目标磁盘模式</strong>，按住 <code>T</code> 键的同时启动 Mac 电脑，并且通过 <code>Firewire</code> 接口，<code>Thunderbolt</code> 接口或者 <code>USB-C</code> 线连接另外一台 Mac 电脑。</p>
<p>如果你没有其它 Mac 电脑，通过启动的时候，按住 <strong>Option</strong> 键用 USB 安装盘启动，把 <code>sierra.dmg</code> 和其它需要的文件拷贝到里面。</p>
<p>执行 <code>diskutil list</code> 来识别连接着的 Mac 磁盘，通常是 <code>/dev/disk2</code></p>
<p><strong>（可选项）</strong> 一次性<a href="https://www.backblaze.com/blog/securely-erase-mac-ssd/" target="_blank" rel="external">安全清除</a>磁盘（如果之前通过 FileVault 加密，该磁盘必须先要解锁，并且装载在 <code>/dev/disk3s2</code>）:</p>
<pre><code>$ sudo diskutil secureErase freespace 1 /dev/disk3s2
</code></pre><p>把磁盘分区改成 <code>Journaled HFS+</code> 格式:</p>
<pre><code>$ sudo diskutil unmountDisk /dev/disk2

$ sudo diskutil partitionDisk /dev/disk2 1 JHFS+ macOS 100%
</code></pre><p>把该镜像还原到新的卷中:</p>
<pre><code>$ sudo asr restore --source ~/sierra.dmg --target /Volumes/macOS --erase --buffersize 4m
</code></pre><p>你也能使用 <strong>Disk Utility / 磁盘工具</strong> 应用程序来清除连接着的 Mac 磁盘，之后将 <code>sierra.dmg</code> 还原到新创建的分区中。</p>
<p>如果你正确按照这些步骤执行，该目标 Mac 电脑应该安装了新的 macOS Sierra 了。</p>
<p>如果你想传送一些文件，把它们拷贝到一个共享文件夹，例如在挂载磁盘的镜像中， <code>/Users/Shared</code>，例如，<code>cp Xcode_8.0.dmg /Volumes/macOS/Users/Shared</code></p>
<p><img width="1280" alt="Finished restore install from USB recovery boot" src="https://cloud.githubusercontent.com/assets/12475110/14804078/f27293c8-0b2d-11e6-8e1f-0fb0ac2f1a4d.png"></p>
<p><strong>完成从 USB 启动的还原安装</strong></p>
<p>这里还没有大功告成！除非你使用 <a href="https://github.com/MagerValp/AutoDMG" target="_blank" rel="external">AutoDMG</a> 创建了镜像，或者把 macOS 安装在你 Mac 上的其它分区内，你需要创建一块还原分区（为了使用对整个磁盘加密的功能）。你能使用 <a href="https://github.com/MagerValp/Create-Recovery-Partition-Installer" target="_blank" rel="external">MagerValp/Create-Recovery-Partition-Installer</a> 或者按照以下步骤:</p>
<p>请下载 <a href="https://support.apple.com/downloads/DL1464/en_US/RecoveryHDUpdate.dmg" target="_blank" rel="external">RecoveryHDUpdate.dmg</a> 这个文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RecoveryHDUpdate.dmg</div><div class="line">SHA-256: f6a4f8ac25eaa6163aa33ac46d40f223f40e58ec0b6b9bf6ad96bdbfc771e12c</div><div class="line">SHA-1:   1ac3b7059ae0fcb2877d22375121d4e6920ae5ba</div></pre></td></tr></table></figure>
<p>添加并且扩展这个安装程序，之后执行以下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ hdiutil attach RecoveryHDUpdate.dmg</div><div class="line"></div><div class="line">$ pkgutil --expand /Volumes/Mac\ OS\ X\ Lion\ Recovery\ HD\ Update/RecoveryHDUpdate.pkg /tmp/recovery</div><div class="line"></div><div class="line">$ hdiutil attach /tmp/recovery/RecoveryHDUpdate.pkg/RecoveryHDMeta.dmg</div><div class="line"></div><div class="line">$ /tmp/recovery/RecoveryHDUpdate.pkg/Scripts/Tools/dmtest ensureRecoveryPartition /Volumes/macOS/ /Volumes/Recovery\ HD\ Update/BaseSystem.dmg 0 0 /Volumes/Recovery\ HD\ Update/BaseSystem.chunklist</div></pre></td></tr></table></figure>
<p>必要的时候把 <code>/Volumes/macOS</code> 替换成以目标磁盘启动的 Mac 的路径。</p>
<p>这个步骤需要花几分钟才能完成。再次执行 <code>diskutil list</code> 来确保 <strong>Recovery HD</strong> 已经存在 <code>/dev/disk2</code> 或者相似的路径下。</p>
<p>一旦你完成了这些，执行 <code>hdituil unmount /Volumes/macOS</code> 命令弹出磁盘，之后关闭以目标磁盘模式启动的 Mac 电脑。</p>
<h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h3><p>在虚拟机内安装 macOS，可以使用 <a href="https://www.vmware.com/products/fusion.html" target="_blank" rel="external">VMware Fusion</a> 工具，按照上文中的说明来创建一个镜像。你<strong>不需要</strong>再下载，也不需要手动创建还原分区。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">VMware-Fusion-8.5.2-4635224.dmg</div><div class="line">SHA-256: f6c54b98c9788d1df94d470661eedff3e5d24ca4fb8962fac5eb5dc56de63b77</div><div class="line">SHA-1:   37ec465673ab802a3f62388d119399cb94b05408</div></pre></td></tr></table></figure>
<p>选择 <strong>Install OS X from the recovery parition</strong> 这个安装方法。可自定义配置任意的内存和 CPU，之后完成设置。默认情况下，这个虚拟机应该进入 <a href="https://support.apple.com/en-us/HT201314" target="_blank" rel="external">Recovery Mode / 还原模式</a>。</p>
<p>在还原模式中，选择一个语言，之后在菜单条中由 Utilities 打开 Terminal。</p>
<p>在虚拟机内，输入 <code>ifconfig | grep inet</code> — 你应该能看到一个私有地址，比如 <code>172.16.34.129</code></p>
<p>在 Mac 宿主机内，输入 <code>ifconfig | grep inet</code> — 你应该能看到一个私有地址，比如 <code>172.16.34.1</code></p>
<p>通过修改 Mac 宿主机内的文件让可安装镜像对虚拟器起作用，比如，修改 <code>/etc/apache2/htpd.conf</code> 并且在该文件最上部增加以下内容：(使用网关分配给 Mac 宿主机的地址和端口号 80):</p>
<pre><code>Listen 172.16.34.1:80
</code></pre><p>在 Mac 宿主机上，把镜像链接到 Apache 网络服务器目录:</p>
<pre><code>$ sudo ln ~/sierra.dmg /Library/WebServer/Documents
</code></pre><p>在 Mac 宿主机的前台运行 Apache:</p>
<pre><code>$ sudo httpd -X
</code></pre><p>在虚拟机上通过本地网络命令 <code>asr</code>，安装镜像文件到卷分区内:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-bash-3.2# asr restore --source http://172.16.34.1/sierra.dmg --target /Volumes/Macintosh\ HD/ --erase --buffersize 4m</div><div class="line">    Validating target...done</div><div class="line">    Validating source...done</div><div class="line">    Erase contents of /dev/disk0s2 (/Volumes/Macintosh HD)? [ny]: y</div><div class="line">    Retrieving scan information...done</div><div class="line">    Validating sizes...done</div><div class="line">    Restoring  ....10....20....30....40....50....60....70....80....90....100</div><div class="line">    Verifying  ....10....20....30....40....50....60....70....80....90....100</div><div class="line">    Remounting target volume...done</div></pre></td></tr></table></figure>
<p>完成后，在 <code>sudo httpd -X</code> 窗口内通过 <code>Control</code> 和 <code>C</code> 组合键停止在宿主机 Mac 上运行的  Apache 网络服务器服务，并且通过命令 <code>sudo rm /Library/WebServer/Documents/sierra.dmg</code> 删除镜像备份文件。</p>
<p>在虚拟机内，在左上角 Apple 菜单中选择 <strong>Startup Disk</strong>，选择硬件驱动器并重启你的电脑。你可能想在初始化虚拟机启动的时候禁用网络适配器。</p>
<p>例如，在访问某些有风险的网站之前保存虚拟机的快照，并在之后用它还原该虚拟机。或者使用一个虚拟机来安装和使用有潜在问题的软件。</p>
<h2 id="首次启动"><a href="#首次启动" class="headerlink" title="首次启动"></a>首次启动</h2><p><strong>注意</strong> 在设置 macOS 之前，请先断开网络连接并且配置一个防火墙。然而，装备有触摸条（<code>Touch Bar</code>）的 <a href="https://www.ifixit.com/Device/MacBook_Pro_15%22_Late_2016_Touch_Bar" target="_blank" rel="external">2016 最新款 MacBook</a>，它<a href="https://onemoreadmin.wordpress.com/2016/11/27/the-untouchables-apples-new-os-activation-for-touch-bar-macbook-pros/" target="_blank" rel="external">需要在线激活系统</a>.</p>
<p>在首次启动时，按住 <code>Command</code> <code>Option</code> <code>P</code> <code>R</code> 键位组合，它用于<a href="https://support.apple.com/en-us/HT204063" target="_blank" rel="external">清除 NVRAM</a>。</p>
<p>当 macOS 首次启动时，你会看到 <strong>Setup Assistant / 设置助手</strong> 的欢迎画面。</p>
<p>请在创建你个人账户的时候，使用一个没有任何提示的<a href="http://www.explainxkcd.com/wiki/index.php/936:_Password_Strength" target="_blank" rel="external">高安全性密码</a>。</p>
<p>如果你在设置账户的过程中使用了真实的名字，你得意识到，你的<a href="https://support.apple.com/kb/PH18720" target="_blank" rel="external">计算机的名字和局域网的主机名</a>将会因为这个名字而泄露 (例如，<strong>John Applesseed’s MacBook</strong>)，所以这个名字会显示在局域网络和一些配置文件中。这两个名字都能在 <strong>System Preferences / 系统配置 &gt; Sharing / 共享</strong> 菜单中或者以下命令来改变:</p>
<pre><code>$ sudo scutil --set ComputerName your_computer_name

$ sudo scutil --set LocalHostName your_hostname
</code></pre><h2 id="管理员和普通用户账号"><a href="#管理员和普通用户账号" class="headerlink" title="管理员和普通用户账号"></a>管理员和普通用户账号</h2><p>管理员账户始终是第一个账户。管理员账户是管理组中的成员并且有访问 <code>sudo</code> 的能力，允许它们修改其它账户，特别是 <code>root</code>，赋予它们对系统更高效的控制权。管理员执行的任何程序也有可能获得一样的权限，这就造成了一个安全风险。类似于 <code>sudo</code> 这样的工具<a href="https://bogner.sh/2014/03/another-mac-os-x-sudo-password-bypass/" target="_blank" rel="external">都有一些能被利用的弱点</a>，例如在默认管理员账户运行的情况下，并行打开的程序或者很多系统的设定都是<a href="http://csrc.nist.gov/publications/drafts/800-179/sp800_179_draft.pdf" target="_blank" rel="external">处于解锁的状态</a> [p. 61–62]。<a href="https://help.apple.com/machelp/mac/10.12/index.html#/mh11389" target="_blank" rel="external">Apple</a> 提供了一个最佳实践和<a href="http://csrc.nist.gov/publications/drafts/800-179/sp800_179_draft.pdf" target="_blank" rel="external">其它一些方案</a> [p. 41–42]，例如，为每天基本的工作建立一个单独的账号，使用管理员账号仅为了安装软件和配置系统。</p>
<p>每一次都通过 macOS 登录界面进入管理员帐号并不是必须的。系统会在需要认证许可的时候弹出提示框，之后交给终端就行了。为了达到这个目的，Apple 为隐藏管理员账户和它的根目录提供了一些<a href="https://support.apple.com/HT203998" target="_blank" rel="external">建议</a>。这对避免显示一个可见的 <code>影子</code> 账户来说是一个好办法。管理员账户也能<a href="http://apple.stackexchange.com/a/94373" target="_blank" rel="external">从 FileVault 里移除</a>。</p>
<h4 id="错误警告"><a href="#错误警告" class="headerlink" title="错误警告"></a>错误警告</h4><ol>
<li><p>只有管理员账户才能把应用程序安装在 <code>/Applications</code> 路径下 （本地目录）。Finder 和安装程序将为普通用户弹出一个许可对话框。然而，许多应用程序都能安装在 <code>~/Applications</code> （该目录能被手动创建） 路径下。经验之谈： 那些不需要管理员权限的应用程序 — 或者在不在 <code>/Applications</code> 目录下都没关系的应用程序 — 都应该安装在用户目录内，其它的应安装在本地目录。Mac App Store 上的应用程序仍然会安装在 <code>/Applications</code> 并且不需要额外的管理员认证。</p>
</li>
<li><p><code>sudo</code> 无法在普通用户的 shell 内使用，它需要使用 <code>su</code> 或者 <code>login</code> 在 shell 内输入一个管理员账户。这需要很多技巧和一些命令行界面操作的经验。</p>
</li>
<li><p>系统配置和一些系统工具 （比如 Wi-Fi 诊断器） 为了所有的功能都能执行，它会需要 root 权限。在系统配置界面中的一些面板都是上锁的，所以需要单独的解锁按钮。一些应用程序在打开的时候会提示认证对话框，其它一些则需要通过一个管理员账号直接打开才能获得全部功能的权限。（例如 Console）</p>
</li>
<li><p>有些第三方应用程序无法正确运行，因为它们假设当前的用户是管理员账户。这些程序只能在登录管理员账户的情况下才能被执行，或者使用 <code>open</code> 工具。</p>
</li>
</ol>
<h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><p>账户能在系统设置中创建和管理。在一个已经建立的系统中，通常很容易就能创建第二个管理员账号并且把之前的管理员帐号降级。这就避免了数据迁移的问题。新安装的系统都能增加普通账号。对一个账号降级能通过新建立的管理员帐号中的系统设置 — 当然那个管理员账号必须已经注销 — 或者执行这些命令（这两个指令可能没有必要都执行，可以参考<a href="https://github.com/drduh/macOS-Security-and-Privacy-Guide/issues/179" target="_blank" rel="external">issue #179</a>）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo dscl . -delete /Groups/admin GroupMembership &lt;username&gt;</div><div class="line"></div><div class="line">$ sudo dscl . -delete /Groups/admin GroupMembers &lt;GeneratedUID&gt;</div></pre></td></tr></table></figure>
<p>通过以下指令，你就能发现你账号的 “GeneratedUID”:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ dscl . -read /Users/&lt;username&gt; GeneratedUID</div></pre></td></tr></table></figure>
<p>也可以参考<a href="https://superuser.com/a/395738" target="_blank" rel="external">这篇文章</a>，它能带给你有关更多 macOS 是如何确定组成员的内容。</p>
<h2 id="对整个磁盘进行数据加密"><a href="#对整个磁盘进行数据加密" class="headerlink" title="对整个磁盘进行数据加密"></a>对整个磁盘进行数据加密</h2><p><a href="https://en.wikipedia.org/wiki/FileVault" target="_blank" rel="external">FileVault</a> 提供了在 macOS 上对整个磁盘加密的能力（技术上来说，是<strong>整个卷宗</strong>。）</p>
<p>FileVault 加密将在休眠的时候保护数据，并且阻止其它人通过物理访问形式偷取数据或者使用你的 Mac 修改数据。</p>
<p>因为大部分的加密操作都<a href="https://software.intel.com/en-us/articles/intel-advanced-encryption-standard-aes-instructions-set/" target="_blank" rel="external">高效地运作在硬件上</a>，性能上的损失对 FireVault 来说并不凸显。</p>
<p>FileVault 的安全性依赖于伪随机数生成器 (PRNG)。</p>
<blockquote>
<p>这个随机设备实现了 Yarrow 伪随机数生成器算法并且维护着它自己的熵池。额外的熵值通常由守护进程 SecurityServer 提供，它由内核测算得到的随机抖动决定。</p>
<p>SecurityServer 也常常负责定期保存一些熵值到磁盘，并且在启动的时候重新加载它们，把这些熵值提供给早期的系统使用。</p>
</blockquote>
<p>参考 <code>man 4 random</code> 获得更多信息。</p>
<p>在开启 FileVault 之前，PRNG 也能通过写入 /dev/random 文件手动提供熵的种子。也就是说，在激活 FileVault 之前，我们能用这种方式撑一段时间。</p>
<p>在启用 FileVault <strong>之前</strong>，手动配置种子熵:</p>
<pre><code>$ cat &gt; /dev/random
[Type random letters for a long while, then press Control-D]
</code></pre><p>通过 <code>sudo fdsetup enable</code> 启用 FileVault 或者通过 <strong>System Preferences</strong> &gt; <strong>Security &amp; Privacy</strong> 之后重启电脑。</p>
<p>如果你能记住你的密码，那就没有理由不保存一个<strong>还原秘钥</strong>。然而，如果你忘记了密码或者还原秘钥，那意味着你加密的数据将永久丢失了。</p>
<p>如果你想深入了解 FileVault 是如何工作得， 可以参考这篇论文 <a href="https://eprint.iacr.org/2012/374.pdf" target="_blank" rel="external">Infiltrate the Vault: Security Analysis and Decryption of Lion Full Disk Encryption</a> (pdf) 和这篇相关的<a href="http://www.cl.cam.ac.uk/~osc22/docs/slides_fv2_ifip_2013.pdf" target="_blank" rel="external">演讲文稿</a> (pdf)。也可以参阅 <a href="http://libeccio.di.unisa.it/Crypto14/Lab/p1619.pdf" target="_blank" rel="external">IEEE Std 1619-2007 “The XTS-AES Tweakable Block Cipher”</a> (pdf).</p>
<p>你可能希望强制开启<strong>休眠</strong>并且从内存中删除 FileVault 的秘钥，而非一般情况下系统休眠对内存操作的处理方式:</p>
<pre><code>$ sudo pmset -a destroyfvkeyonstandby 1
$ sudo pmset -a hibernatemode 25
</code></pre><blockquote>
<p>所有计算机都有 EFI 或 BIOS 这类的固件，它们帮助发现其它硬件，最终使用所需的操作系统实例把计算机正确启动起来。以 Apple 硬件和 EFI 的使用来说，Apple 把有关的信息保存在 EFI 内，它辅助 macOS 的功能正确运行。举例来说，FileVault 的秘钥保存在 EFI 内，在待机模式的时候出现。</p>
<p>那些容易被高频攻击的部件，或者那些待机模式下，容易被暴露给所有设备访问的设备，它们都应该销毁在固件中的 FileVault 秘钥来减少这个风险。这么干并不会影响 FileVault 的正常使用，但是系统需要用户在每次跳出待机模式的时候输入这个密码。</p>
</blockquote>
<p>如果你选择在待机模式下删除 FileVault 秘钥，你也应该修改待机模式的设置。否则，你的机器可能无法正常进入待机模式，会因为缺少 FileVault 秘钥而关机。参考 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/124" target="_blank" rel="external">issue #124</a> 获得更多信息。可以通过以下命令修改这些设置:</p>
<pre><code>$ sudo pmset -a powernap 0
$ sudo pmset -a standby 0
$ sudo pmset -a standbydelay 0
$ sudo pmset -a autopoweroff 0
</code></pre><p>如果你想了解更多， 请参考 <a href="http://training.apple.com/pdf/WP_FileVault2.pdf" target="_blank" rel="external">Best Practices for Deploying FileVault 2</a> (pdf) 和这篇论文 <a href="https://www.usenix.org/legacy/event/sec08/tech/full_papers/halderman/halderman.pdf" target="_blank" rel="external">Lest We Remember: Cold Boot Attacks on Encryption Keys</a> (pdf)</p>
<h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><p>在准备连接进入互联网之前，最好是先配置一个防火墙。</p>
<p>在 macOS 上有好几种防火墙。</p>
<h4 id="应用程序层的防火墙"><a href="#应用程序层的防火墙" class="headerlink" title="应用程序层的防火墙"></a>应用程序层的防火墙</h4><p>系统自带的那个基本的防火墙，它只阻止<strong>对内</strong>的连接。</p>
<p>注意，这个防火墙没有监控的能力，也没有阻止<strong>对外</strong>连接的能力。</p>
<p>它能在 <strong>System Preferences</strong> 中 <strong>Security &amp; Privacy</strong> 标签中的 <strong>Firewall</strong> 控制，或者使用以下的命令。</p>
<p>开启防火墙:</p>
<pre><code>$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
</code></pre><p>开启日志:</p>
<pre><code>$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setloggingmode on
</code></pre><p>你可能还想开启私密模式:</p>
<pre><code>$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on
</code></pre><blockquote>
<p>计算机黑客会扫描网络，所以它们能标记计算机并且实施网络攻击。你能使用<strong>私密模式</strong>，避免你的计算机响应一些这样的恶意扫描。当开启了防火墙的私密模式后，你的计算机就不会响应 ICMP 请求，并且不响应那些已关闭的 TCP 或 UDP 端口的连接。这会让那些网络攻击者们很难发现你的计算机。</p>
</blockquote>
<p>最后，你可能会想阻止<strong>系统自带的软件</strong>和<strong>经过代码签名，下载过的软件自动加入白名单:</strong></p>
<pre><code>$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setallowsigned off

$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setallowsignedapp off
</code></pre><blockquote>
<p>那些经过一个认证签名的应用程序会自动允许加入列表，而不是提示用户再对它们进行认证。包含在 OS X 内的应用程序都被 Apple 代码签名，并且都允许接对内的连接，当这个配置开启了。举例来说，因为 iTunes 已经被 Apple 代码签名，所以它能自动允许防火墙接收对内的连接。</p>
<p>如果你执行一个未签名的应用程序，它也没有被纳入防火墙白名单，此时一个带允许或者拒绝该连接选项的对话框会出现。如果你选择“允许连接”，macOS 对这个应用程序签名并且自动把它增加进防火墙的白名单。如果你选择“拒绝连接”，macOS 也会把它加入名单中，但是会拒绝对这个应用程序的对内连接。</p>
</blockquote>
<p>在使用完 <code>socketfilterfw</code> 之后，你需要重新启动（或者结束）这个进程:</p>
<pre><code>$ sudo pkill -HUP socketfilterfw
</code></pre><h4 id="第三方防火墙"><a href="#第三方防火墙" class="headerlink" title="第三方防火墙"></a>第三方防火墙</h4><p>例如 <a href="https://www.obdev.at/products/littlesnitch/index.html" target="_blank" rel="external">Little Snitch</a>, <a href="https://www.oneperiodic.com/products/handsoff/" target="_blank" rel="external">Hands Off</a>, <a href="http://radiosilenceapp.com/" target="_blank" rel="external">Radio Silence</a> 和 <a href="https://pirate.github.io/security-growler/" target="_blank" rel="external">Security Growler</a> 这样的程序都提供了一个方便、易用且安全的防火墙。</p>
<p><img width="349" alt="Example of Little Snitch monitored session" src="https://cloud.githubusercontent.com/assets/12475110/10596588/c0eed3c0-76b3-11e5-95b8-9ce7d51b3d82.png"></p>
<p><strong>以下是一段 Little Snitch 监控会话的例子</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">LittleSnitch-3.7.1.dmg</div><div class="line">SHA-256: e6332ee70385f459d9803b0a582d5344bb9dab28bcd56e247ae69866cc321802</div><div class="line">SHA-1:   d5d602c0f76cd73051792dff0ac334bbdc66ae32</div></pre></td></tr></table></figure>
<p>这些程序都具备有监控和阻拦<strong>对内</strong>和<strong>对外</strong>网络连接的能力。然而，它们可能会需要使用一个闭源的<a href="https://developer.apple.com/library/mac/documentation/Darwin/Conceptual/KernelProgramming/Extend/Extend.html" target="_blank" rel="external">内核扩展</a>。</p>
<p>如果过多的允许或者阻拦网络连接的选择让你不堪重负，使用配置过白名单的<strong>静谧模式</strong>，之后定期检查你设定项，来了解这么多应用程序都在干什么。</p>
<p>需要指出的是，这些防火墙都会被以 <strong>root</strong> 权限运行的程序绕过，或者通过 <a href="https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf" target="_blank" rel="external">OS vulnerabilities</a> (pdf)，但是它们还是值得拥有的 — 只是不要期待完全的保护。然而，一些恶意软件实际上能<a href="https://www.cnet.com/how-to/how-to-remove-the-flashback-malware-from-os-x/" target="_blank" rel="external">自我删除</a>，如果发现 <code>Little Snitch</code> 或者其他一些安全软件已经安装，它就根本不启动。</p>
<p>若想了解更多有关 Little Snitch 是如何工作的，可参考以下两篇文章：<a href="https://developer.apple.com/library/mac/documentation/Darwin/Conceptual/NKEConceptual/socket_nke/socket_nke.html#//apple_ref/doc/uid/TP40001858-CH228-SW1" target="_blank" rel="external">Network Kernel Extensions Programming Guide</a> 和 <a href="https://reverse.put.as/2016/07/22/shut-up-snitch-reverse-engineering-and-exploiting-a-critical-little-snitch-vulnerability/" target="_blank" rel="external">Shut up snitch! – reverse engineering and exploiting a critical Little Snitch vulnerability</a>.</p>
<h4 id="内核级的数据包过滤"><a href="#内核级的数据包过滤" class="headerlink" title="内核级的数据包过滤"></a>内核级的数据包过滤</h4><p>有一个高度可定制化、功能强大，但的确也是最复杂的防火墙存在内核中。它能通过 <code>pfctl</code> 或者很多配置文件控制。</p>
<p>pf 也能通过一个 GUI 应用程序控制，例如 <a href="http://www.hanynet.com/icefloor/" target="_blank" rel="external">IceFloor</a> 或者 <a href="http://www.murusfirewall.com/" target="_blank" rel="external">Murus</a>。</p>
<p>有很多书和文章介绍 pf 防火墙。这里，我们只介绍一个有关通过 IP 地址阻拦访问的例子。</p>
<p>将以下内容增加到 <code>pf.rules</code> 文件中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">set block-policy drop</div><div class="line">set fingerprints &quot;/etc/pf.os&quot;</div><div class="line">set ruleset-optimization basic</div><div class="line">set skip on lo0</div><div class="line">scrub in all no-df</div><div class="line">table &lt;blocklist&gt; persist</div><div class="line">block in log</div><div class="line">block in log quick from no-route to any</div><div class="line">pass out proto tcp from any to any keep state</div><div class="line">pass out proto udp from any to any keep state</div><div class="line">block log on en0 from &#123;&lt;blocklist&gt;&#125; to any</div></pre></td></tr></table></figure>
<p>使用以下命令:</p>
<ul>
<li><code>sudo pfctl -e -f pf.rules</code> — 开启防火墙</li>
<li><code>sudo pfctl -d</code> — 禁用防火墙</li>
<li><code>sudo pfctl -t blocklist -T add 1.2.3.4</code> — 把某个主机加入阻止清单中</li>
<li><code>sudo pfctl -t blocklist -T show</code> — 查看阻止清单</li>
<li><code>sudo ifconfig pflog0 create</code> — 为某个接口创建日志</li>
<li><code>sudo tcpdump -ni pflog0</code> — 输出打印数据包</li>
</ul>
<p>我不建议你花大量时间在如何配置 pf 上，除非你对数据包过滤器非常熟悉。比如说，如果你的 Mac 计算机连接在一个 <a href="https://www.grc.com/nat/nat.htm" target="_blank" rel="external">NAT</a> 后面，它存在于一个安全的家庭网络中，那以上操作是完全没有必要的。</p>
<p>可以参考 <a href="https://github.com/fix-macosx/net-monitor" target="_blank" rel="external">fix-macosx/net-monitor</a> 来了解如何使用 pf 监控用户和系统级别对“背景连接通讯”的使用。</p>
<h2 id="系统服务"><a href="#系统服务" class="headerlink" title="系统服务"></a>系统服务</h2><p>在你连接到互联网之前，你不妨禁用一些系统服务，它们会使用一些资源或者后台连接通讯到 Apple。</p>
<p>可参考这三个代码仓库获得更多建议，<a href="https://github.com/fix-macosx/yosemite-phone-home" target="_blank" rel="external">fix-macosx/yosemite-phone-home</a>, <a href="https://github.com/l1k/osxparanoia" target="_blank" rel="external">l1k/osxparanoia</a> 和 <a href="https://github.com/karek314/macOS-home-call-drop" target="_blank" rel="external">karek314/macOS-home-call-drop</a>。</p>
<p>在 macOS 上的系统服务都由 <strong>launchd</strong> 管理。可参考 <a href="http://launchd.info/" target="_blank" rel="external">launchd.info</a>，也可以参考以下两个材料，<a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html" target="_blank" rel="external">Apple’s Daemons and Services Programming Guide</a> 和 <a href="https://developer.apple.com/library/mac/technotes/tn2083/_index.html" target="_blank" rel="external">Technical Note TN2083</a>。</p>
<p>你也可以运行 <a href="https://github.com/synack/knockknock" target="_blank" rel="external">KnockKnock</a>，它能展示出更多有关启动项的内容。</p>
<ul>
<li>使用 <code>launchctl list</code> 查看正在运行的用户代理</li>
<li>使用 <code>sudo launchctl list</code> 查看正在运行的系统守护进程</li>
<li>通过指定服务名称查看，例如，<code>launchctl list com.apple.Maps.mapspushd</code></li>
<li>使用 <code>defaults read</code> 来检查在 <code>/System/Library/LaunchDaemons</code> 和 <code>/System/Library/LaunchAgents</code> 工作中的 plist</li>
<li>使用 <code>man</code>，<code>strings</code> 和 Google 来学习运行中的代理和守护进程是什么</li>
</ul>
<p>举例来说，想要知道某个系统启动的守护进程或者代理干了什么，可以输入以下指令:</p>
<pre><code>$ defaults read /System/Library/LaunchDaemons/com.apple.apsd.plist
</code></pre><p>看一看 <code>Program</code> 或者 <code>ProgramArguments</code> 这两个部分的内容，你就知道哪个二进制文件在运行，此处是 <code>apsd</code>。可以通过 <code>man apsd</code> 查看更多有关它的信息。</p>
<p>再举一个例子，如果你对 <code>Apple Push Nofitications</code> 不感兴趣，可以禁止这个服务:</p>
<pre><code>$ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.apsd.plist
</code></pre><p><strong>注意</strong> 卸载某些服务可能造成某些应用程序无法使用。首先，请阅读手册或者使用 Google 检索确保你明白自己在干什么。</p>
<p>禁用那些你不理解的系统进程的时候一定要万分小心，因为它可能会让你的系统瘫痪无法启动。如果你弄坏了你的 Mac，可以使用<a href="https://support.apple.com/en-us/HT201573" target="_blank" rel="external">单一用户模式</a>来修复。</p>
<p>如果你觉得 Mac 持续升温，感觉卡顿或者常常表现出诡异的行为，可以使用 <a href="https://en.wikipedia.org/wiki/Console_(OS_X" target="_blank" rel="external">Console</a>) 和 <a href="https://support.apple.com/en-us/HT201464" target="_blank" rel="external">Activity Monitor</a> 这两个应用程序，因为这可能是你不小心操作造成的。</p>
<p>以下指令可以查看现在已经禁用的服务:</p>
<pre><code>$ find /var/db/com.apple.xpc.launchd/ -type f -print -exec defaults read {} \; 2&gt;/dev/null
</code></pre><p>有详细注释的启动系统守护进程和代理的列表，各自运行的程序和程序的哈希校验值都包含在这个代码仓库中了。</p>
<p><strong>（可选项）</strong> 运行 <code>read_launch_plists.py</code> 脚本，使用 <code>diff</code> 输出和你系统对比后产生的差异，例如:</p>
<pre><code>$ diff &lt;(python read_launch_plists.py) &lt;(cat 16A323_launchd.csv)
</code></pre><p>你可以参考这篇 <a href="http://cirrusj.github.io/Yosemite-Stop-Launch/" target="_blank" rel="external">cirrusj.github.io/Yosemite-Stop-Launch</a>，它对具体服务进行了一些解释， 也可以看看这篇 <a href="https://vilimpoc.org/blog/2014/01/15/provisioning-os-x-and-disabling-unnecessary-services/" target="_blank" rel="external">Provisioning OS X and Disabling Unnecessary Services</a>，这篇是其它一些解释。</p>
<h2 id="Spotlight-建议"><a href="#Spotlight-建议" class="headerlink" title="Spotlight 建议"></a>Spotlight 建议</h2><p>在 Spotlight 偏好设置面板和 Safari 的搜索偏好设置中都禁用 <strong>Spotlight 建议</strong>，来避免你的搜索查询项会发送给 Apple。</p>
<p>在 Spotlight 偏好设置面板中也禁用<strong>必应 Web 搜索</strong>来避免你的搜索查询项会发送给 Microsoft。</p>
<p>查看 <a href="https://fix-macosx.com/" target="_blank" rel="external">fix-macosx.com</a> 获得更详细的信息。</p>
<blockquote>
<p>如果你已经更新到 Mac OS X Yosemite(10.10)并且在用默认的设置，每一次你开始在 Spotlight （去打开一个应用或在你的电脑中搜索一个文件）中打字，你本地的搜索词和位置会被发送给 Apple 和第三方（包括 Microsoft ）。</p>
</blockquote>
<p> <strong>注意</strong> 这个网站和它的指导说明已不再适用于 macOS Sierra — 参考<a href="https://github.com/drduh/macOS-Security-and-Privacy-Guide/issues/164" target="_blank" rel="external">issue 164</a>.</p>
<p>下载，查看并应用他们建议的补丁：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ curl -O https://fix-macosx.com/fix-macosx.py</div><div class="line"></div><div class="line">$ less fix-macosx.py</div><div class="line"></div><div class="line">$ python fix-macosx.py</div><div class="line">All done. Make sure to log out (and back in) for the changes to take effect.</div></pre></td></tr></table></figure>
<p>谈到 Microsoft，你可能还想看看 <a href="https://fix10.isleaked.com/" target="_blank" rel="external">https://fix10.isleaked.com/</a>，挺有意思的。</p>
<h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>考虑使用 <a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a> 来安装软件和更新用户工具（查看 <a href="http://meta.ath0.com/2012/02/05/apples-great-gpl-purge/" target="_blank" rel="external">Apple’s great GPL purge</a>），这样更简单些。<br><strong>注意</strong>如果你还没安装 Xcode 或命令行工具，可以用 <code>xcode-select --install</code> 来从 Apple 下载、安装。</p>
<p>要<a href="https://github.com/Homebrew/brew/blob/master/docs/Installation.md#installation" target="_blank" rel="external">安装 Homebrew</a>:</p>
<pre><code>$ mkdir homebrew &amp;&amp; curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew
</code></pre><p>在你的脚本或 rc 文件中编辑 <code>PATH</code> 来使用 <code>~/homebrew/bin</code> 和 <code>~/homebrew/sbin</code>。例如，先 <code>echo &#39;PATH=$PATH:~/homebrew/sbin:~/homebrew/bin&#39; &gt;&gt; .zshrc</code>，然后用 <code>chsh -s /bin/zsh</code> 把登录脚本改为 Z shell，打开一个新的终端窗口并运行 <code>brew update</code>。</p>
<p>Homebrew 使用 SSL/TLS 与 GitHub 通信并验证下载包的校验，所以它是<a href="https://github.com/Homebrew/homebrew/issues/18036" target="_blank" rel="external">相当安全的</a>。</p>
<p>记得定期在可信任的、安全的网络上运行 <code>brew update</code> 和 <code>brew upgrade</code> 来下载、安装软件更新。想在安装前得到关于一个包的信息，运行 <code>brew info &lt;package&gt;</code> 在线查看。</p>
<p>依据 <a href="https://github.com/Homebrew/brew/blob/master/docs/Analytics.md" target="_blank" rel="external">Homebrew 匿名汇总用户行为分析</a>，Homebrew 获取匿名的汇总的用户行为分析数据并把它们报告给 Google Analytics。</p>
<p>你可以在你的（shell）环境或 rc 文件中设置 <code>export HOMEBREW_NO_ANALYTICS=1</code>，或使用 <code>brew analytics off</code> 来退出 Homebrew 的分析。</p>
<p>可能你还希望启用<a href="https://github.com/drduh/macOS-Security-and-Privacy-Guide/issues/138" target="_blank" rel="external">额外的安全选项</a>，例如 <code>HOMEBREW_NO_INSECURE_REDIRECT=1</code> 和 <code>HOMEBREW_CASK_OPTS=--require-sha</code>。</p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><h4 id="Hosts-文件"><a href="#Hosts-文件" class="headerlink" title="Hosts 文件"></a>Hosts 文件</h4><p>使用 <a href="https://en.wikipedia.org/wiki/Hosts_(file" target="_blank" rel="external">Hosts 文件</a>) 来屏蔽蔽已知的恶意软件、广告或那些不想访问的域名。</p>
<p>用 root 用户编辑 hosts 文件，例如用 <code>sudo vi /etc/hosts</code>。hosts 文件也能用可视化的应用 <a href="https://github.com/2ndalpha/gasmask" target="_blank" rel="external">2ndalpha/gasmask</a> 管理。</p>
<p>要屏蔽一个域名，在 <code>/etc/hosts</code> 中加上 <code>0 example.com</code> 或 <code>0.0.0.0 example.com</code> 或 <code>127.0.0.1 example.com</code>。</p>
<p>网上有很多可用的域名列表，你可以直接复制过来，要确保每一行以 <code>0</code>, <code>0.0.0.0</code>, <code>127.0.0.1</code> 开始，并且 <code>127.0.0.1 localhost</code> 这一行包含在内。</p>
<p>对于这些主机列表，可以查看 <a href="http://someonewhocares.org/hosts/zero/hosts" target="_blank" rel="external">someonewhocares.org</a>、<a href="https://github.com/l1k/osxparanoia/blob/master/hosts" target="_blank" rel="external">l1k/osxparanoia/blob/master/hosts</a>、<a href="https://github.com/StevenBlack/hosts" target="_blank" rel="external">StevenBlack/hosts</a> 和 <a href="https://github.com/gorhill/uMatrix/blob/master/assets/umatrix/hosts-files.json" target="_blank" rel="external">gorhill/uMatrix/hosts-files.json</a>。</p>
<p>要添加一个新的列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ curl &quot;https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts&quot; | sudo tee -a /etc/hosts</div><div class="line"></div><div class="line">$ wc -l /etc/hosts</div><div class="line">31998</div><div class="line"></div><div class="line">$ egrep -ve &quot;^#|^255.255.255|^0.0.0.0|^127.0.0.0|^0 &quot; /etc/hosts</div><div class="line">::1 localhost</div><div class="line">fe80::1%lo0 localhost</div><div class="line">[should not return any other IP addresses]</div></pre></td></tr></table></figure>
<p>更多信息请查看 <code>man hosts</code> 和 <a href="https://www.freebsd.org/doc/handbook/configtuning-configfiles.html" target="_blank" rel="external">FreeBSD 配置文件</a>。</p>
<h4 id="Dnsmasq"><a href="#Dnsmasq" class="headerlink" title="Dnsmasq"></a>Dnsmasq</h4><p>与其他特性相比，<a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="external">dnsmasq</a> 能缓存请求，避免无资格名单中的查询数据上传和屏蔽所有的顶级域名。</p>
<p>另外，和 DNSCrypt 一起使用来加密输出的 DNS 流量。</p>
<p>如果你不想使用 DNSCrypt，再怎么滴也不要用 <a href="http://hackercodex.com/guide/how-to-stop-isp-dns-server-hijacking" target="_blank" rel="external">ISP</a> <a href="http://bcn.boulder.co.us/~neal/ietf/verisign-abuse.html" target="_blank" rel="external">提供</a> 的 DNS。两个流行的选择是 <a href="https://developers.google.com/speed/public-dns/" target="_blank" rel="external">Google DNS</a> 和 <a href="https://www.opendns.com/home-internet-security/" target="_blank" rel="external">OpenDNS</a>。</p>
<p><strong>(可选)</strong> <a href="https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions" target="_blank" rel="external">DNSSEC</a> 是一系列 DNS 的扩展，为 DNS 客户端提供 DNS 数据的来源验证、否定存在验证和数据完整性检验。所有来自 DNSSEC 保护区域的应答都是数字签名的。签名的记录通过一个信任链授权，以一系列验证过的 DNS 根区域的公钥开头。当前的根区域信任锚点可能下载下来<a href="https://www.iana.org/dnssec/files" target="_blank" rel="external">从 IANA 网站</a>。关于 DNSSEC 有很多的资源，可能最好的一个是 <a href="http://www.dnssec.net" target="_blank" rel="external">dnssec.net 网站</a>。</p>
<p>安装 Dnsmasq (DNSSEC 是可选的)：</p>
<pre><code>$ brew install dnsmasq --with-dnssec

$ cp ~/homebrew/opt/dnsmasq/dnsmasq.conf.example ~/homebrew/etc/dnsmasq.conf
</code></pre><p>编辑配置项：</p>
<pre><code>$ vim ~/homebrew/etc/dnsmasq.conf
</code></pre><p>检查所有的选项。这有一些推荐启用的设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"># Forward queries to DNSCrypt on localhost port 5355</div><div class="line">server=127.0.0.1#5355</div><div class="line"></div><div class="line"># Uncomment to forward queries to Google Public DNS</div><div class="line">#server=8.8.8.8</div><div class="line"></div><div class="line"># Never forward plain names</div><div class="line">domain-needed</div><div class="line"></div><div class="line"># Examples of blocking TLDs or subdomains</div><div class="line">address=/.onion/0.0.0.0</div><div class="line">address=/.local/0.0.0.0</div><div class="line">address=/.mycoolnetwork/0.0.0.0</div><div class="line">address=/.facebook.com/0.0.0.0</div><div class="line"></div><div class="line"># Never forward addresses in the non-routed address spaces</div><div class="line">bogus-priv</div><div class="line"></div><div class="line"># Reject private addresses from upstream nameservers</div><div class="line">stop-dns-rebind</div><div class="line"></div><div class="line"># Query servers in order</div><div class="line">strict-order</div><div class="line"></div><div class="line"># Set the size of the cache</div><div class="line"># The default is to keep 150 hostnames</div><div class="line">cache-size=8192</div><div class="line"></div><div class="line"># Optional logging directives</div><div class="line">log-async</div><div class="line">log-dhcp</div><div class="line">log-facility=/var/log/dnsmasq.log</div><div class="line"></div><div class="line"># Uncomment to log all queries</div><div class="line">#log-queries</div><div class="line"></div><div class="line"># Uncomment to enable DNSSEC</div><div class="line">#dnssec</div><div class="line">#trust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5</div><div class="line">#dnssec-check-unsigned</div></pre></td></tr></table></figure>
<p>安装并启动程序（<code>sudo</code> 需要绑定在 <a href="https://unix.stackexchange.com/questions/16564/why-are-the-first-1024-ports-restricted-to-the-root-user-only" target="_blank" rel="external">53 特权端口</a>）：</p>
<pre><code>$ sudo brew services start dnsmasq
</code></pre><p>要设置 Dnsmasq 为本地的 DNS 服务器，打开<strong>系统偏好设置</strong> &gt; <strong>网络</strong>并选择“高级”（译者注：原文为 ‘active interface’，实际上‘高级’），接着切换到 <strong>DNS</strong> 选项卡，选择 <strong>+</strong> 并 添加 <code>127.0.0.1</code>, 或使用：</p>
<pre><code>$ sudo networksetup -setdnsservers &quot;Wi-Fi&quot; 127.0.0.1
</code></pre><p>确保 Dnsmasq 正确配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ scutil --dns</div><div class="line">DNS configuration</div><div class="line"></div><div class="line">resolver #1</div><div class="line">  search domain[0] : whatever</div><div class="line">  nameserver[0] : 127.0.0.1</div><div class="line">  flags    : Request A records, Request AAAA records</div><div class="line">  reach    : Reachable, Local Address, Directly Reachable Address</div><div class="line"></div><div class="line">$ networksetup -getdnsservers &quot;Wi-Fi&quot;</div><div class="line">127.0.0.1</div></pre></td></tr></table></figure>
<p><strong>注意</strong> 一些 VPN 软件一链接会覆盖 DNS 设置。更多信息查看 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/24" target="_blank" rel="external">issue #24</a>。</p>
<h4 id="检测-DNSSEC-验证"><a href="#检测-DNSSEC-验证" class="headerlink" title="检测 DNSSEC 验证"></a>检测 DNSSEC 验证</h4><p>测试已签名区域的 DNSSEC（域名系统安全扩展协议）验证是否成功：</p>
<pre><code>$ dig +dnssec icann.org
</code></pre><p>应答应该有<code>NOERROR</code>状态并包含<code>ad</code>。例如：</p>
<pre><code>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 47039
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
</code></pre><p>不恰当签名的区域会导致检测 DNSSEC 验证的失败：</p>
<pre><code>$ dig www.dnssec-failed.org
</code></pre><p>应答应该包含<code>SERVFAIL</code>状态。例如：</p>
<pre><code>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 15190
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
</code></pre><h4 id="dnscrypt"><a href="#dnscrypt" class="headerlink" title="dnscrypt"></a>dnscrypt</h4><p>使用 <a href="https://dnscrypt.org/" target="_blank" rel="external">dnscrypt</a> 在可选的范围内加密 DNS 流量（译者注：原文为 ‘the provider of choice’）。</p>
<p>如果你更喜欢一个 GUI 应用程序，看这里 <a href="https://github.com/alterstep/dnscrypt-osxclient" target="_blank" rel="external">alterstep/dnscrypt-osxclient</a>。</p>
<p>从 Homebrew 安装 DNSCrypt：</p>
<pre><code>$ brew install dnscrypt-proxy
</code></pre><p>如果要和 Dnsmasq 一起使用，找到这个文件<code>homebrew.mxcl.dnscrypt-proxy.plist</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ find ~/homebrew -name homebrew.mxcl.dnscrypt-proxy.plist</div><div class="line">/Users/drduh/homebrew/Cellar/dnscrypt-proxy/1.7.0/homebrew.mxcl.dnscrypt-proxy.plist</div></pre></td></tr></table></figure>
<p>将下面一行编辑进去：</p>
<pre><code>&lt;string&gt;--local-address=127.0.0.1:5355&lt;/string&gt;
</code></pre><p>接着写：</p>
<pre><code>&lt;string&gt;/usr/local/opt/dnscrypt-proxy/sbin/dnscrypt-proxy&lt;/string&gt;
</code></pre><p><img width="1015" alt="dnscrypt" src="https://cloud.githubusercontent.com/assets/12475110/19222914/8e6f853e-8e31-11e6-8dd6-27c33cbfaea5.png"></p>
<p><strong>添加一行本地地址来使用 DNScrypt，使用 53 以外的端口，比如 5355</strong></p>
<p>用 Homebrew 也能实现上述过程，安装 <code>gnu-sed</code> 并使用<code>gsed</code> 命令行：</p>
<pre><code>$ sudo gsed -i &quot;/sbin\\/dnscrypt-proxy&lt;\\/string&gt;/a&lt;string&gt;--local-address=127.0.0.1:5355&lt;\\/string&gt;\n&quot; $(find ~/homebrew -name homebrew.mxcl.dnscrypt-proxy.plist)
</code></pre><p>默认情况下，<code>resolvers-list</code> 将会指向 dnscrypt 版本特定的 resolvers 文件。当更新了 dnscrypt，这一版本将不再存在，若它存在，可能指向一个过期的文件。在 <code>/Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist</code> 中把 resolvers 文件改为 <code>/usr/local/share</code> 中的符号链接的版本，能解决上述问题：</p>
<pre><code>&lt;string&gt;--resolvers-list=/usr/local/share/dnscrypt-proxy/dnscrypt-resolvers.csv&lt;/string&gt;
</code></pre><p>启用 DNSCrypt：</p>
<pre><code>$ brew services start dnscrypt-proxy
</code></pre><p>确保 DNSCrypt 在运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ sudo lsof -Pni UDP:5355</div><div class="line">COMMAND   PID   USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">dnscrypt-  83 nobody    7u  IPv4 0x1773f85ff9f8bbef      0t0  UDP 127.0.0.1:5355</div><div class="line"></div><div class="line">$ ps A | grep &apos;[d]nscrypt&apos;</div><div class="line">   83   ??  Ss     0:00.27 /Users/drduh/homebrew/opt/dnscrypt-proxy/sbin/dnscrypt-proxy --local-address=127.0.0.1:5355 --ephemeral-keys --resolvers-list=/Users/drduh/homebrew/opt/dnscrypt-proxy/share/dnscrypt-proxy/dnscrypt-resolvers.csv --resolver-name=dnscrypt.eu-dk --user=nobody</div></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下，dnscrypt-proxy 运行在本地 (127.0.0.1) ，53 端口，并且 “nobody” 身份使用dnscrypt.eu-dk DNSCrypt-enabled<br>resolver。如果你想改变这些设置，你得编辑 plist 文件 (例如, –resolver-address, –provider-name, –provider-key, 等。)</p>
</blockquote>
<p>通过编辑 <code>homebrew.mxcl.dnscrypt-proxy.plist</code> 也能完成</p>
<p>你能从一个信任的位置或使用 <a href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv" target="_blank" rel="external">public servers</a> 中的一个运行你自己的 <a href="https://github.com/Cofyc/dnscrypt-wrapper" target="_blank" rel="external">dnscrypt server</a>（也可以参考 <a href="https://github.com/drduh/Debian-Privacy-Server-Guide#dnscrypt" target="_blank" rel="external">drduh/Debian-Privacy-Server-Guide#dnscrypt</a>）</p>
<p>确保输出的 DNS 流量已加密：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ sudo tcpdump -qtni en0</div><div class="line">IP 10.8.8.8.59636 &gt; 77.66.84.233.443: UDP, length 512</div><div class="line">IP 77.66.84.233.443 &gt; 10.8.8.8.59636: UDP, length 368</div><div class="line"></div><div class="line">$ dig +short -x 77.66.84.233</div><div class="line">resolver2.dnscrypt.eu</div></pre></td></tr></table></figure>
<p>你也可以阅读 <a href="https://dnsleaktest.com/what-is-a-dns-leak.html" target="_blank" rel="external">What is a DNS leak</a>，<a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man8/mDNSResponder.8.html" target="_blank" rel="external">mDNSResponder manual page</a> 和 <a href="http://ipv6-test.com/" target="_blank" rel="external">ipv6-test.com</a>。</p>
<h2 id="Captive-portal"><a href="#Captive-portal" class="headerlink" title="Captive portal"></a>Captive portal</h2><p>当 macOS 连接到新的网络，它会<strong>检测</strong>网络，如果连接没有被接通，则会启动 Captive Portal assistant 功能。</p>
<p>一个攻击者能触发这一功能，无需用户交互就将一台电脑定向到有恶意软件的网站，最好禁用这个功能并用你经常用的浏览器登录 captive portals， 前提是你必须首先禁用了任何的客户端 / 代理设置。</p>
<pre><code>$ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.captive.control Active -bool false
</code></pre><p>也可以看看 <a href="https://www.securestate.com/blog/2011/10/07/apple-os-x-lion-captive-portal-hijacking-attack" target="_blank" rel="external">Apple OS X Lion Security: Captive Portal Hijacking Attack</a>，<a href="http://blog.erratasec.com/2010/09/apples-secret-wispr-request.html" target="_blank" rel="external">Apple’s secret “wispr” request</a>，<a href="https://web.archive.org/web/20130407200745/http://www.divertednetworks.net/apple-captiveportal.html" target="_blank" rel="external">How to disable the captive portal window in Mac OS Lion</a>，和 <a href="https://grpugh.wordpress.com/2014/10/29/an-undocumented-change-to-captive-network-assistant-settings-in-os-x-10-10-yosemite/" target="_blank" rel="external">An undocumented change to Captive Network Assistant settings in OS X 10.10 Yosemite</a>。</p>
<h2 id="证书授权"><a href="#证书授权" class="headerlink" title="证书授权"></a>证书授权</h2><p>macOS 上有从像 Apple、Verisign、Thawte、Digicert 这样的营利性公司和来自中国、日本、荷兰、美国等等的政府机关安装的<a href="https://support.apple.com/en-us/HT202858" target="_blank" rel="external">超过 200</a> 个可信任的根证书。这些证书授权(CAs)能够针对任一域名处理 SSL/TLS 认证，代码签名证书等等。</p>
<p>想要了解更多，可以看看 <a href="https://github.com/kirei/catt" target="_blank" rel="external">Certification Authority Trust Tracker</a>、<a href="http://conferences.sigcomm.org/imc/2013/papers/imc257-durumericAemb.pdf" target="_blank" rel="external">Analysis of the HTTPS certificate ecosystem</a>(pdf) 和 <a href="http://www.ifca.ai/fc14/papers/fc14_submission_100.pdf" target="_blank" rel="external">You Won’t Be Needing These Any More: On Removing Unused Certificates From Trust Stores</a>(pdf)。</p>
<p>你可以在<strong>钥匙串访问</strong>中的<strong>系统根证书</strong>选项卡下检查系统根证书，或者使用 <code>security</code> 命令行工具和 <code>/System/Library/Keychains/SystemRootCertificates.keychain</code> 文件。</p>
<p>你可以通过钥匙串访问将它们标记为<strong>永不信任</strong>禁用证书授权并关闭窗口：</p>
<p><img width="450" alt="A certificate authority certificate" src="https://cloud.githubusercontent.com/assets/12475110/19222972/6b7aabac-8e32-11e6-8efe-5d3219575a98.png"></p>
<p>被你的系统信任的被迫或妥协的证书授权产生一个假的 / 欺骗的 SSL 证书，这样的一个<a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="external">中间人攻击</a>的风险很低，但仍然是<a href="https://en.wikipedia.org/wiki/DigiNotar#Issuance_of_fraudulent_certificates" target="_blank" rel="external">可能的</a>。</p>
<h2 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p>在 Sierra 中 OpenSSL 的版本是<code>0.9.8zh</code>，这<a href="https://apple.stackexchange.com/questions/200582/why-is-apple-using-an-older-version-of-openssl" target="_blank" rel="external">不是最新的</a>。它不支持 TLS 1.1 或新的版本，elliptic curve ciphers，<a href="https://stackoverflow.com/questions/27502215/difference-between-openssl-09-8z-and-1-0-1" target="_blank" rel="external">还有更多</a>。</p>
<p>Apple 在他们的 <a href="https://developer.apple.com/library/mac/documentation/Security/Conceptual/cryptoservices/GeneralPurposeCrypto/GeneralPurposeCrypto.html" target="_blank" rel="external">Cryptographic Services 指南</a>文档中宣布<strong>弃用</strong> OpenSSL。他们的版本也有补丁，可能会<a href="https://hynek.me/articles/apple-openssl-verification-surprises/" target="_blank" rel="external">带来惊喜喔</a>。</p>
<p>如果你要在你的 Mac 上用 OpenSSL，用 <code>brew install openssl</code> 下载并安装一个 OpenSSL 最近的版本。注意，brew 已经链接了 <code>/usr/bin/openssl</code> ，可能和构建软件冲突。查看 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/39" target="_blank" rel="external">issue #39</a>。</p>
<p>在 homebrew 版本和 OpenSSL 系统版本之间比较 TLS 协议和密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ ~/homebrew/bin/openssl version; echo | ~/homebrew/bin openssl s_client -connect github.com:443 2&gt;&amp;1 | grep -A2 SSL-Session</div><div class="line">OpenSSL 1.0.2j  26 Sep 2016</div><div class="line">SSL-Session:</div><div class="line">    Protocol  : TLSv1.2</div><div class="line">    Cipher    : ECDHE-RSA-AES128-GCM-SHA256</div><div class="line"></div><div class="line">$ /usr/bin/openssl version; echo | /usr/bin/openssl s_client -connect github.com:443 2&gt;&amp;1 | grep -A2 SSL-Session</div><div class="line">OpenSSL 0.9.8zh 14 Jan 2016</div><div class="line">SSL-Session:</div><div class="line">    Protocol  : TLSv1</div><div class="line">    Cipher    : AES128-SHA</div></pre></td></tr></table></figure>
<p>阅读 <a href="https://en.wikipedia.org/wiki/Comparison_of_TLS_implementations" target="_blank" rel="external">Comparison of TLS implementations</a>，<a href="https://www.howsmyssl.com/" target="_blank" rel="external">How’s My SSL</a>，<a href="https://www.ssllabs.com/projects/" target="_blank" rel="external">Qualys SSL Labs Tools</a> 了解更多，查看更详细的解释和最新的漏洞测试请看 <a href="http://ssl-checker.online-domain-tools.com" target="_blank" rel="external">ssl-checker.online-domain-tools.com</a>。</p>
<h2 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h2><p>macOS 中 Curl 的版本针对 SSL/TLS 验证使用<a href="https://developer.apple.com/library/mac/documentation/Security/Reference/secureTransportRef/" target="_blank" rel="external">安全传输</a>。</p>
<p>如果你更愿意使用 OpenSSL，用 <code>brew install curl --with-openssl</code> 安装并通过 <code>brew link --force curl</code> 确保它是默认的。</p>
<p>这里推荐几个向 <code>~/.curlrc</code> 中添加的<a href="http://curl.haxx.se/docs/manpage.html" target="_blank" rel="external">可选项</a>（更多请查看 <code>man curl</code>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">user-agent = &quot;Mozilla/5.0 (Windows NT 6.1; rv:45.0) Gecko/20100101 Firefox/45.0&quot;</div><div class="line">referer = &quot;;auto&quot;</div><div class="line">connect-timeout = 10</div><div class="line">progress-bar</div><div class="line">max-time = 90</div><div class="line">verbose</div><div class="line">show-error</div><div class="line">remote-time</div><div class="line">ipv4</div></pre></td></tr></table></figure>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p>考虑使用 <a href="http://www.privoxy.org/" target="_blank" rel="external">Privoxy</a> 作为本地代理来过滤网络浏览内容。</p>
<p>一个已签名的 privoxy 安装包能从 <a href="http://silvester.org.uk/privoxy/OSX/" target="_blank" rel="external">silvester.org.uk</a> 或 <a href="http://sourceforge.net/projects/ijbswa/files/Macintosh%20%28OS%20X%29/" target="_blank" rel="external">Sourceforge</a> 下载。签过名的包比 Homebrew 版本<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/65" target="_blank" rel="external">更安全</a>，而且能得到 Privoxy 项目全面的支持。</p>
<p>另外，用 Homebrew 安装、启动 privoxy：</p>
<pre><code>$ brew install privoxy

$ brew services start privoxy
</code></pre><p>默认情况下，privoxy 监听本地的 8118 端口。</p>
<p>为你的网络接口设置系统 <strong>http</strong> 代理为<code>127.0.0.1</code> 和 <code>8118</code>（可以通过 <strong>系统偏好设置 &gt; 网络 &gt; 高级 &gt; 代理</strong>）：</p>
<pre><code>$ sudo networksetup -setwebproxy &quot;Wi-Fi&quot; 127.0.0.1 8118
</code></pre><p><strong>(可选)</strong> 用下述方法设置系统 <strong>https</strong> 代理，这仍提供了域名过滤功能：</p>
<pre><code>$ sudo networksetup -setsecurewebproxy &quot;Wi-Fi&quot; 127.0.0.1 8118
</code></pre><p>确保代理设置好了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ scutil --proxy</div><div class="line">&lt;dictionary&gt; &#123;</div><div class="line">  ExceptionsList : &lt;array&gt; &#123;</div><div class="line">    0 : *.local</div><div class="line">    1 : 169.254/16</div><div class="line">  &#125;</div><div class="line">  FTPPassive : 1</div><div class="line">  HTTPEnable : 1</div><div class="line">  HTTPPort : 8118</div><div class="line">  HTTPProxy : 127.0.0.1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在一个浏览器里访问 <a href="http://p.p/" target="_blank" rel="external">http://p.p/</a>，或用 Curl 访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ALL_PROXY=127.0.0.1:8118 curl -I http://p.p/</div><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Length: 2401</div><div class="line">Content-Type: text/html</div><div class="line">Cache-Control: no-cache</div></pre></td></tr></table></figure>
<p>代理已经有很多好的规则，你也能自己定义。</p>
<p>编辑 <code>~/homebrew/etc/privoxy/user.action</code> 用域名或正则表达式来过滤。</p>
<p>示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123; +block&#123;social networking&#125; &#125;</div><div class="line">www.facebook.com/(extern|plugins)/(login_status|like(box)?|activity|fan)\.php</div><div class="line">.facebook.com</div><div class="line"></div><div class="line">&#123; +block&#123;unwanted images&#125; +handle-as-image &#125;</div><div class="line">.com/ads/</div><div class="line">/.*1x1.gif</div><div class="line">/.*fb-icon.[jpg|gif|png]</div><div class="line">/assets/social-.*</div><div class="line">/cleardot.gif</div><div class="line">/img/social.*</div><div class="line">ads.*.co.*/</div><div class="line">ads.*.com/</div><div class="line"></div><div class="line">&#123; +redirect&#123;s@http://@https://@&#125; &#125;</div><div class="line">.google.com</div><div class="line">.wikipedia.org</div><div class="line">code.jquery.com</div><div class="line">imgur.com</div></pre></td></tr></table></figure>
<p>验证 Privoxy 能够拦截和重定向：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ ALL_PROXY=127.0.0.1:8118 curl ads.foo.com/ -IL</div><div class="line">HTTP/1.1 403 Request blocked by Privoxy</div><div class="line">Content-Type: image/gif</div><div class="line">Content-Length: 64</div><div class="line">Cache-Control: no-cache</div><div class="line"></div><div class="line">$ ALL_PROXY=127.0.0.1:8118 curl imgur.com/ -IL</div><div class="line">HTTP/1.1 302 Local Redirect from Privoxy</div><div class="line">Location: https://imgur.com/</div><div class="line">Content-Length: 0</div><div class="line">Date: Sun, 09 Oct 2016 18:48:19 GMT</div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/html; charset=utf-8</div></pre></td></tr></table></figure>
<p>你能用小猫的图片来代替广告图片，例如，通过启动一个本地的 Web 服务器然后<a href="https://www.privoxy.org/user-manual/actions-file.html#SET-IMAGE-BLOCKER" target="_blank" rel="external">重定向屏蔽的请求</a>到本地。</p>
<h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p>Web 浏览器引发最大的安全和隐私风险，因为它基本的工作是从因特网上下载和运行未信任的代码。</p>
<p>对于你的大部分浏览请使用 <a href="https://www.google.com/chrome/browser/desktop/" target="_blank" rel="external">Google Chrome</a>。它提供了<a href="https://www.chromium.org/user-experience/multi-profiles" target="_blank" rel="external">独立的配置文件</a>，<a href="https://www.chromium.org/developers/design-documents/sandbox" target="_blank" rel="external">好的沙盒处理</a>，<a href="http://googlechromereleases.blogspot.com/" target="_blank" rel="external">经常更新</a>（包括 Flash，尽管你应该禁用它 —— 原因看下面），并且<a href="https://www.chromium.org/Home/chromium-security/brag-sheet" target="_blank" rel="external">自带牛哄哄的资格证书</a>。</p>
<p>Chrome 也有一个很好的 <a href="http://0xdabbad00.com/2013/01/13/most-secure-pdf-viewer-chrome-pdf-viewer/" target="_blank" rel="external">PDF 阅读器</a>。</p>
<p>如果你不想用 Chrome，<a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank" rel="external">Firefox</a> 也是一个很好的浏览器。或两个都用。看这里的讨论 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/2" target="_blank" rel="external">#2</a>，<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/90" target="_blank" rel="external">#90</a>。</p>
<p>如果用 Firefox，查看 <a href="https://github.com/TheCreeper/PrivacyFox" target="_blank" rel="external">TheCreeper/PrivacyFox</a> 里推荐的隐私偏好设置。也要确保为基于 Mozilla 的浏览器检查 <a href="https://noscript.net/" target="_blank" rel="external">NoScript</a>，它允许基于白名单预先阻止脚本。</p>
<p>创建至少三个配置文件，一个用来浏览<strong>可信任的</strong>网站 (邮箱，银行)，另一个为了<strong>大部分是可信的</strong> 网站（聚合类，新闻类站点），第三个是针对完全<strong>无 cookie</strong> 和<strong>无脚本</strong>的网站浏览。</p>
<ul>
<li><p>一个启用了 <strong>无 cookies 和 Javascript</strong>（例如, 在 <code>chrome://settings/content</code>中被关掉）的配置文件就应该用来访问未信任的网站。然而，如果不启用 Javascript，很多页面根本不会加载。</p>
</li>
<li><p>一个有 <a href="https://github.com/gorhill/uMatrix" target="_blank" rel="external">uMatrix</a> 或 <a href="https://github.com/gorhill/uBlock" target="_blank" rel="external">uBlock Origin</a>（或两个都有）的配置文件。用这个文件来访问<strong>大部分是可信的</strong>网站。花时间了解防火墙扩展程序是怎么工作的。其他经常被推荐的扩展程序是 <a href="https://www.eff.org/privacybadger" target="_blank" rel="external">Privacy Badger</a>、<a href="https://www.eff.org/https-everywhere" target="_blank" rel="external">HTTPSEverywhere</a> 和 <a href="http://patrol.psyced.org/" target="_blank" rel="external">CertPatrol</a>（仅限 Firefox）。</p>
</li>
<li><p>一个或更多的配置文件用来满足安全和可信任的浏览需求，例如仅限于银行和邮件。</p>
</li>
</ul>
<p>想法是分隔并划分数据，那么如果一个“会话”出现漏洞或泄露隐私并不一定会影响其它数据。</p>
<p>在每一个文件里，访问 <code>chrome://plugins/</code> 并禁用 <strong>Adobe Flash Player</strong>。如果你一定要用 Flash，访问 <code>chrome://settings/contents</code>，在插件部分，启用在<strong>让我自行选择何时运行插件内容</strong>（也叫做 <em>click-to-play</em>）。</p>
<p>花时间阅读 <a href="https://www.chromium.org/Home/chromium-security" target="_blank" rel="external">Chromium 安全</a>和 <a href="https://www.chromium.org/Home/chromium-privacy" target="_blank" rel="external">Chromium 隐私</a>。</p>
<p>例如你可能希望禁用 <a href="https://www.chromium.org/developers/design-documents/dns-prefetching" target="_blank" rel="external">DNS prefetching</a>（也可以阅读 <a href="https://www.usenix.org/legacy/event/leet10/tech/full_papers/Krishnan.pdf" target="_blank" rel="external">DNS Prefetching and Its Privacy Implications</a>）。</p>
<p>你也应该知道 <a href="https://en.wikipedia.org/wiki/WebRTC#Concerns" target="_blank" rel="external">WebRTC</a>，它能获取你本地或外网的（如果连到 VPN）IP 地址。这可以用诸如 <a href="https://github.com/gorhill/uBlock/wiki/Prevent-WebRTC-from-leaking-local-IP-address" target="_blank" rel="external">uBlock Origin</a> 和 <a href="https://github.com/rentamob/WebRTC-Leak-Prevent" target="_blank" rel="external">rentamob/WebRTC-Leak-Prevent</a> 这样的扩展程序禁用掉。</p>
<p>很多源于 Chromium 的浏览器本文是不推荐的。它们通常<a href="http://yro.slashdot.org/comments.pl?sid=4176879&amp;cid=44774943" target="_blank" rel="external">不开源</a>，<a href="https://plus.google.com/+JustinSchuh/posts/69qw9wZVH8z" target="_blank" rel="external">维护性差</a>，<a href="https://code.google.com/p/google-security-research/issues/detail?id=679" target="_blank" rel="external">有很多 bug</a>，而且对保护隐私有可疑的声明。阅读 <a href="http://thesimplecomputer.info/the-private-life-of-chromium-browsers" target="_blank" rel="external">The Private Life of Chromium Browsers</a>。</p>
<p>也不推荐 Safari。代码一团糟而且<a href="https://nakedsecurity.sophos.com/2014/02/24/anatomy-of-a-goto-fail-apples-ssl-bug-explained-plus-an-unofficial-patch/" target="_blank" rel="external">安全问题</a><a href="https://vimeo.com/144872861" target="_blank" rel="external">漏洞</a>经常发生，并且打补丁很慢（阅读 <a href="https://news.ycombinator.com/item?id=10150038" target="_blank" rel="external">Hacker News 上的讨论</a>）。安全<a href="https://discussions.apple.com/thread/5128209" target="_blank" rel="external">并不是</a> Safari 的一个优点。如果你硬要使用它，至少在偏好设置里<a href="https://thoughtsviewsopinions.wordpress.com/2013/04/26/how-to-stop-downloaded-files-opening-automatically/" target="_blank" rel="external">禁用</a><strong>下载后打开”安全的文件</strong>，也要了解其他的<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/93" target="_blank" rel="external">隐私差别</a>。</p>
<p>其他乱七八糟的浏览器，例如 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/94" target="_blank" rel="external">Brave</a>，在这个指南里没有评估，所以既不推荐也不反对使用。</p>
<p>想浏览更多安全方面的问题，请阅读 <a href="https://gist.github.com/atcuno/3425484ac5cce5298932" target="_blank" rel="external">HowTo: Privacy &amp; Security Conscious Browsing</a>，<a href="https://www.browserleaks.com/" target="_blank" rel="external">browserleaks.com</a> 和 <a href="https://panopticlick.eff.org/" target="_blank" rel="external">EFF Panopticlick</a>。</p>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p><strong>Adobe Flash</strong>, <strong>Oracle Java</strong>, <strong>Adobe Reader</strong>, <strong>Microsoft Silverlight</strong>（Netflix 现在使用了 <a href="https://help.netflix.com/en/node/23742" target="_blank" rel="external">HTML5</a>） 和其他的插件有<a href="https://news.ycombinator.com/item?id=9901480" target="_blank" rel="external">安全风险</a>，不应该安装。</p>
<p>如果它们是必须的，只在一个虚拟机里安装它们并且订阅安全通知以便确保你总能及时修补漏洞。</p>
<p>阅读 <a href="http://blog.trendmicro.com/trendlabs-security-intelligence/hacking-team-flash-zero-day-integrated-into-exploit-kits/" target="_blank" rel="external">Hacking Team Flash Zero-Day</a>、<a href="https://en.wikipedia.org/wiki/Trojan_BackDoor.Flashback" target="_blank" rel="external">Java Trojan BackDoor.Flashback</a>、<a href="http://www.cvedetails.com/vulnerability-list/vendor_id-53/product_id-497/Adobe-Acrobat-Reader.html" target="_blank" rel="external">Acrobat Reader: Security Vulnerabilities</a> 和 <a href="https://blogs.cisco.com/security/angling-for-silverlight-exploits" target="_blank" rel="external">Angling for Silverlight Exploits</a>。</p>
<h2 id="PGP-GPG"><a href="#PGP-GPG" class="headerlink" title="PGP/GPG"></a>PGP/GPG</h2><p>PGP 是一个端对端邮件加密标准。这意味着只是选中的接收者能解密一条消息，不像通常的邮件被提供者永久阅读和保存。</p>
<p><strong>GPG</strong> 或 <strong>GNU Privacy Guard</strong>，是一个符合标准的 GPL 协议项目。</p>
<p><strong>GPG</strong> 被用来验证你下载和安装的软件签名，既可以<a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm" target="_blank" rel="external">对称</a>也可以<a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="external">非对称</a>的加密文件和文本。</p>
<p>从 Homebrew 上用 <code>brew install gnupg2</code> 安装。</p>
<p>如果你更喜欢图形化的应用，下载安装 <a href="https://gpgtools.org/" target="_blank" rel="external">GPG Suite</a>。</p>
<p>这有几个往 <code>~/.gnupg/gpg.conf</code> 中添加的<a href="https://github.com/drduh/config/blob/master/gpg.conf" target="_blank" rel="external">推荐选项</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">auto-key-locate keyserver</div><div class="line">keyserver hkps://hkps.pool.sks-keyservers.net</div><div class="line">keyserver-options no-honor-keyserver-url</div><div class="line">keyserver-options ca-cert-file=/etc/sks-keyservers.netCA.pem</div><div class="line">keyserver-options no-honor-keyserver-url</div><div class="line">keyserver-options debug</div><div class="line">keyserver-options verbose</div><div class="line">personal-cipher-preferences AES256 AES192 AES CAST5</div><div class="line">personal-digest-preferences SHA512 SHA384 SHA256 SHA224</div><div class="line">default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</div><div class="line">cert-digest-algo SHA512</div><div class="line">s2k-digest-algo SHA512</div><div class="line">s2k-cipher-algo AES256</div><div class="line">charset utf-8</div><div class="line">fixed-list-mode</div><div class="line">no-comments</div><div class="line">no-emit-version</div><div class="line">keyid-format 0xlong</div><div class="line">list-options show-uid-validity</div><div class="line">verify-options show-uid-validity</div><div class="line">with-fingerprint</div></pre></td></tr></table></figure>
<p>安装 keyservers <a href="https://sks-keyservers.net/verify_tls.php" target="_blank" rel="external">CA 认证</a>：</p>
<pre><code>$ curl -O https://sks-keyservers.net/sks-keyservers.netCA.pem

$ sudo mv sks-keyservers.netCA.pem /etc
</code></pre><p>这些设置将配置 GnuPG 在获取新密钥和想用强加密原语时使用 SSL。</p>
<p>请阅读 <a href="https://github.com/ioerror/duraconf/blob/master/configs/gnupg/gpg.conf" target="_blank" rel="external">ioerror/duraconf/configs/gnupg/gpg.conf</a>。你也应该花时间读读 <a href="https://help.riseup.net/en/security/message-security/openpgp/best-practices" target="_blank" rel="external">OpenPGP Best Practices</a>。</p>
<p>如果你没有一个密钥对，可以用 <code>gpg --gen-key</code> 创建一个。也可以阅读 <a href="https://github.com/drduh/YubiKey-Guide" target="_blank" rel="external">drduh/YubiKey-Guide</a>。</p>
<p>读<a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/" target="_blank" rel="external">在线的</a><a href="https://security.stackexchange.com/questions/31594/what-is-a-good-general-purpose-gnupg-key-setup" target="_blank" rel="external">指南</a>并练习给你自己和朋友们加密解密邮件。让他们也对这篇文章感兴趣吧！</p>
<h2 id="OTR"><a href="#OTR" class="headerlink" title="OTR"></a>OTR</h2><p>OTR 代表 <strong>off-the-record</strong> 并且是一个针对即时消息对话加密和授权的密码协议。</p>
<p>你能在任何一个已存在的 <a href="https://xmpp.org/about" target="_blank" rel="external">XMPP</a> 聊天服务中使用 OTR，甚至是 Google Hangouts（它只在使用 TLS 的用户和服务器之间加密对话）。</p>
<p>你和某人第一次开始一段对话，你将被要求去验证他们的公钥指纹。确保是本人亲自操作或通过其它一些安全的方式(例如 GPG 加密过的邮件)。<br>针对 XMPP 和其他的聊天协议，有一个流行的 macOS GUI 客户端是 <a href="https://adium.im/" target="_blank" rel="external">Adium</a>。</p>
<p>考虑下载一个 <a href="https://beta.adium.im/" target="_blank" rel="external">beta 版本</a>，使用 OAuth2 验证，确保登录谷歌账号<a href="https://adium.im/blog/2015/04/" target="_blank" rel="external">更</a><a href="https://trac.adium.im/ticket/16161" target="_blank" rel="external">安全</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Adium_1.5.11b3.dmg</div><div class="line">SHA-256: 999e1931a52dc327b3a6e8492ffa9df724a837c88ad9637a501be2e3b6710078</div><div class="line">SHA-1:   ca804389412f9aeb7971ade6812f33ac739140e6</div></pre></td></tr></table></figure>
<p>记住对于 Adium 的 OTR 聊天<a href="https://trac.adium.im/ticket/15722" target="_blank" rel="external">禁用登录</a>。</p>
<p>一个好的基于控制台的 XMPP 客户端是 <a href="http://www.profanity.im/" target="_blank" rel="external">profanity</a>，它能用 <code>brew install profanity</code> 安装。</p>
<p>想增加匿名性的话，查看 <a href="https://blog.torproject.org/blog/tor-messenger-beta-chat-over-tor-easily" target="_blank" rel="external">Tor Messenger</a>，尽管它还在测试中，<a href="https://ricochet.im/" target="_blank" rel="external">Ricochet</a>（它最近接受了一个彻底的<a href="https://ricochet.im/files/ricochet-ncc-audit-2016-01.pdf" target="_blank" rel="external">安全审查</a>）也是，这两个都使用 Tor 网络而不是依赖于消息服务器。</p>
<p>如果你想了解 OTR 是如何工作的，可以阅读这篇论文 <a href="https://otr.cypherpunks.ca/otr-wpes.pdf" target="_blank" rel="external">Off-the-Record Communication, or, Why Not To Use PGP</a></p>
<h2 id="Tor"><a href="#Tor" class="headerlink" title="Tor"></a>Tor</h2><p>Tor 是一个用来浏览网页的匿名代理。</p>
<p>从<a href="https://www.torproject.org/projects/torbrowser.html" target="_blank" rel="external">官方 Tor 项目网站</a>下载 Tor 浏览器。</p>
<p><strong>不要</strong>尝试配置其他的浏览器或应用程序来使用 Tor，因为你可能会导致一个错误，危及你的匿名信息。</p>
<p>下载 <code>dmg</code> 和 <code>asc</code> 签名文件，然后验证已经被 Tor 开发者签过名的磁盘镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$ cd Downloads</div><div class="line"></div><div class="line">$ file Tor*</div><div class="line">TorBrowser-6.0.5-osx64_en-US.dmg:     bzip2 compressed data, block size = 900k</div><div class="line">TorBrowser-6.0.5-osx64_en-US.dmg.asc: PGP signature Signature (old)</div><div class="line"></div><div class="line">$ gpg Tor*asc</div><div class="line">gpg: assuming signed data in `TorBrowser-6.0.5-osx64_en-US.dmg&apos;</div><div class="line">gpg: Signature made Fri Sep 16 07:51:52 2016 EDT using RSA key ID D40814E0</div><div class="line">gpg: Can&apos;t check signature: public key not found</div><div class="line"></div><div class="line">$ gpg --recv 0xD40814E0</div><div class="line">gpg: requesting key D40814E0 from hkp server keys.gnupg.net</div><div class="line">gpg: key 93298290: public key &quot;Tor Browser Developers (signing key) &lt;torbrowser@torproject.org&gt;&quot; imported</div><div class="line">gpg: no ultimately trusted keys found</div><div class="line">gpg: Total number processed: 1</div><div class="line">gpg:               imported: 1  (RSA: 1)</div><div class="line"></div><div class="line">$ gpg Tor*asc</div><div class="line">gpg: assuming signed data in &apos;TorBrowser-6.0.5-osx64_en-US.dmg&apos;</div><div class="line">gpg: Signature made Fri Sep 16 07:51:52 2016 EDT using RSA key ID D40814E0</div><div class="line">gpg: Good signature from &quot;Tor Browser Developers (signing key) &lt;torbrowser@torproject.org&gt;&quot; [unknown]</div><div class="line">gpg: WARNING: This key is not certified with a trusted signature!</div><div class="line">gpg:          There is no indication that the signature belongs to the owner.</div><div class="line">Primary key fingerprint: EF6E 286D DA85 EA2A 4BA7  DE68 4E2C 6E87 9329 8290</div><div class="line">     Subkey fingerprint: BA1E E421 BBB4 5263 180E  1FC7 2E1A C68E D408 14E0</div></pre></td></tr></table></figure>
<p>确保 <code>Good signature from &quot;Tor Browser Developers (signing key) &lt;torbrowser@torproject.org&gt;&quot;</code>出现在输出结果中。关于密钥没被认证的警告没有危害的，因为它还没被手动分配信任。</p>
<p>看 <a href="https://www.torproject.org/docs/verifying-signatures.html" target="_blank" rel="external">How to verify signatures for packages</a> 获得更多信息。</p>
<p>要完成安装 Tor 浏览器，打开磁盘镜像，拖动它到应用文件夹里，或者这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hdiutil mount TorBrowser-6.0.5-osx64_en-US.dmg</div><div class="line"></div><div class="line">$ cp -rv /Volumes/Tor\ Browser/TorBrowser.app /Applications</div></pre></td></tr></table></figure>
<p>也可以验证是否这个 Tor 应用程序是由名为 <strong>MADPSAYN6T</strong> 的 Apple 开发者账号进行签名编译的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ codesign -dvv /Applications/TorBrowser.app</div><div class="line">Executable=/Applications/TorBrowser.app/Contents/MacOS/firefox</div><div class="line">Identifier=org.mozilla.tor browser</div><div class="line">Format=app bundle with Mach-O thin (x86_64)</div><div class="line">CodeDirectory v=20200 size=247 flags=0x0(none) hashes=5+3 location=embedded</div><div class="line">Library validation warning=OS X SDK version before 10.9 does not support Library Validation</div><div class="line">Signature size=4247</div><div class="line">Authority=Developer ID Application: The Tor Project, Inc (MADPSAYN6T)</div><div class="line">Authority=Developer ID Certification Authority</div><div class="line">Authority=Apple Root CA</div><div class="line">Signed Time=Nov 30, 2016, 10:40:34 AM</div><div class="line">Info.plist entries=21</div><div class="line">TeamIdentifier=MADPSAYN6T</div><div class="line">Sealed Resources version=2 rules=12 files=130</div><div class="line">Internal requirements count=1 size=184</div></pre></td></tr></table></figure>
<p>为了查看证书的详细内容，可以使用 <code>codesign</code> 提取并且使用 <code>openssl</code> 对它进行解码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ codesign -d --extract-certificates /Applications/TorBrowser.app</div><div class="line">Executable=/Applications/TorBrowser.app/Contents/MacOS/firefox</div><div class="line"></div><div class="line">$ file codesign*</div><div class="line">codesign0: data</div><div class="line">codesign1: data</div><div class="line">codesign2: data</div><div class="line"></div><div class="line">$ openssl x509 -inform der -in codesign0 -subject -issuer -startdate -enddate -noout</div><div class="line">subject= /UID=MADPSAYN6T/CN=Developer ID Application: The Tor Project, Inc (MADPSAYN6T)/OU=MADPSAYN6T/O=The Tor Project, Inc/C=US</div><div class="line">issuer= /CN=Developer ID Certification Authority/OU=Apple Certification Authority/O=Apple Inc./C=US</div><div class="line">notBefore=Apr 12 22:40:13 2016 GMT</div><div class="line">notAfter=Apr 13 22:40:13 2021 GMT</div><div class="line"></div><div class="line">$ openssl x509 -inform der -in codesign0  -fingerprint -noout</div><div class="line">SHA1 Fingerprint=95:80:54:F1:54:66:F3:9C:C2:D8:27:7A:29:21:D9:61:11:93:B3:E8</div><div class="line"></div><div class="line">$ openssl x509 -inform der -in codesign0 -fingerprint -sha256 -noout</div><div class="line">SHA256 Fingerprint=B5:0D:47:F0:3E:CB:42:B6:68:1C:6F:38:06:2B:C2:9F:41:FA:D6:54:F1:29:D3:E4:DD:9C:C7:49:35:FF:F5:D9</div></pre></td></tr></table></figure>
<p>Tor 流量对于<a href="https://en.wikipedia.org/wiki/Tor_anonymity_network#Exit_node_eavesdropping" target="_blank" rel="external">出口节点</a>（不能被一个网络窃听者读取）是<strong>加密的</strong>， Tor 是<strong>可以</strong>被发现的- 例如，TLS 握手“主机名”将会以明文显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo tcpdump -An &quot;tcp&quot; | grep &quot;www&quot;</div><div class="line">listening on pktap, link-type PKTAP (Apple DLT_PKTAP), capture size 262144 bytes</div><div class="line">.............&quot;. ...www.odezz26nvv7jeqz1xghzs.com.........</div><div class="line">.............#.!...www.bxbko3qi7vacgwyk4ggulh.com.........</div><div class="line">.6....m.....&gt;...:.........|../*	Z....W....X=..6...C../....................................0...0..0.......&apos;....F./0..	*.H........0%1#0!..U....www.b6zazzahl3h3faf4x2.com0...160402000000Z..170317000000Z0&apos;1%0#..U....www.tm3ddrghe22wgqna5u8g.net0..0..</div></pre></td></tr></table></figure>
<p>查看 <a href="https://gitweb.torproject.org/torspec.git/tree/tor-spec.txt" target="_blank" rel="external">Tor Protocol Specification</a> 和 <a href="https://trac.torproject.org/projects/tor/wiki/org/projects/Tor/TLSHistory" target="_blank" rel="external">Tor/TLSHistory</a> 获得更多信息。</p>
<p>另外，你可能也希望使用一个 <a href="https://www.torproject.org/docs/pluggable-transports.html" target="_blank" rel="external">pluggable transport</a>，例如 <a href="https://github.com/Yawning/obfs4" target="_blank" rel="external">Yawning/obfs4proxy</a> 或 <a href="https://github.com/SRI-CSL/stegotorus" target="_blank" rel="external">SRI-CSL/stegotorus</a> 来混淆 Tor 流量。</p>
<p>这能通过建立你自己的 <a href="https://www.torproject.org/docs/tor-relay-debian.html" target="_blank" rel="external">Tor relay</a> 或找到一个已存在的私有或公用的 <a href="https://www.torproject.org/docs/bridges.html.en#RunningABridge" target="_blank" rel="external">bridge</a> 来作为一个混淆入口节点来实现。</p>
<p>对于额外的安全性，在 <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">VirtualBox</a> 或 <a href="https://www.vmware.com/products/fusion" target="_blank" rel="external">VMware</a>，可视化的 <a href="http://www.brianlinkletter.com/installing-debian-linux-in-a-virtualbox-virtual-machine/" target="_blank" rel="external">GNU/Linux</a> 或 <a href="http://www.openbsd.org/faq/faq4.html" target="_blank" rel="external">BSD</a> 机器里用 Tor。</p>
<p>最后，记得 Tor 网络提供了<a href="https://www.privateinternetaccess.com/blog/2013/10/how-does-privacy-differ-from-anonymity-and-why-are-both-important/" target="_blank" rel="external">匿名</a>，这并不等于隐私。Tor 网络不一定能防止一个全球的窃听者能获得流量统计和<a href="https://blog.torproject.org/category/tags/traffic-correlation" target="_blank" rel="external">相关性</a>。你也可以阅读 <a href="http://bford.info/pub/net/panopticon-cacm.pdf" target="_blank" rel="external">Seeking Anonymity in an Internet Panopticon</a> 和 <a href="http://www.ohmygodel.com/publications/usersrouted-ccs13.pdf" target="_blank" rel="external">Traffic Correlation on Tor by Realistic Adversaries</a>。</p>
<p>阅读 <a href="https://geti2p.net/en/about/intro" target="_blank" rel="external">Invisible Internet Project (I2P)</a> 和它的 <a href="https://geti2p.net/en/comparison/tor" target="_blank" rel="external">Tor 对比</a>。</p>
<h2 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h2><p>如果你在未信任的网络使用 Mac - 机场，咖啡厅等 - 你的网络流量会被监控并可能被篡改。</p>
<p>用一个 VPN 是个好想法，它能用一个你信任的提供商加密<strong>所有</strong>输出的网络流量。举例说如何建立并拥有自己的 VPN，阅读 <a href="https://github.com/drduh/Debian-Privacy-Server-Guide" target="_blank" rel="external">drduh/Debian-Privacy-Server-Guide</a>。</p>
<p>不要盲目地还没理解整个流程和流量将如何被传输就为一个 VPN 服务签名。如果你不理解 VPN 是怎样工作的或不熟悉软件的使用，你就最好别用它。</p>
<p>当选择一个 VPN 服务或建立你自己的服务时，确保研究过协议，密钥交换算法，认证机制和使用的加密类型。诸如 <a href="https://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol#Security" target="_blank" rel="external">PPTP</a> 这样的一些协议，应该避免支持 <a href="https://en.wikipedia.org/wiki/OpenVPN" target="_blank" rel="external">OpenVPN</a>。</p>
<p>当 VPN 被中断或失去连接时，一些客户端可能通过下一个可用的接口发送流量。查看 <a href="https://gist.github.com/scy/8122924" target="_blank" rel="external">scy/8122924</a> 研究下如何允许流量只通过 VPN。</p>
<p>另一些脚本会关闭系统，所以只能通过 VPN 访问网络，这就是 the Voodoo Privacy project - <a href="https://github.com/sarfata/voodooprivacy" target="_blank" rel="external">sarfata/voodooprivacy</a> 的一部分，有一个更新的指南用来在一个虚拟机上（<a href="https://github.com/hwdsl2/setup-ipsec-vpn" target="_blank" rel="external">hwdsl2/setup-ipsec-vpn</a>）或一个 docker 容器（<a href="https://github.com/hwdsl2/docker-ipsec-vpn-server" target="_blank" rel="external">hwdsl2/docker-ipsec-vpn-server</a>）上建立一个 IPSec VPN。</p>
<h2 id="病毒和恶意软件"><a href="#病毒和恶意软件" class="headerlink" title="病毒和恶意软件"></a>病毒和恶意软件</h2><p>面对<a href="https://www.documentcloud.org/documents/2459197-bit9-carbon-black-threat-research-report-2015.html" target="_blank" rel="external">日益增长</a>的恶意软件，Mac 还无法很好的防御这些病毒和恶意软件！</p>
<p>一些恶意软件捆绑在正版软件上，比如 <a href="http://www.zdnet.com/article/oracle-extends-its-adware-bundling-to-include-java-for-macs/" target="_blank" rel="external">Java bundling Ask Toolbar</a>，还有 <a href="https://docs.google.com/document/d/1YOfXRUQJgMjJSLBSoLiUaSZfiaS_vU3aG4Bvjmz6Dxs/edit?pli=1" target="_blank" rel="external">Mac.BackDoor.iWorm</a> 这种和盗版软件捆绑到一块的。 <a href="https://www.malwarebytes.com/antimalware/mac/" target="_blank" rel="external">Malwarebytes Anti-Malware for Mac</a> 是一款超棒的应用，它可以帮你摆脱种类繁多的垃圾软件和其他恶意程序的困扰。</p>
<p>看看<a href="https://www.virusbtn.com/pdf/conference/vb2014/VB2014-Wardle.pdf" target="_blank" rel="external">恶意软件驻留在 Mac OS X 的方法</a> (pdf) 和<a href="https://www.rsaconference.com/events/us15/agenda/sessions/1591/malware-persistence-on-os-x-yosemite" target="_blank" rel="external">恶意软件在 OS X Yosemite 后台运行</a>了解各种恶意软件的功能和危害。</p>
<p>你可以定期运行 <a href="https://github.com/synack/knockknock" target="_blank" rel="external">Knock Knock</a> 这样的工具来检查在持续运行的应用(比如脚本，二进制程序)。但这种方法可能已经过时了。<a href="https://objective-see.com/products/blockblock.html" target="_blank" rel="external">Block Block</a> 和 <a href="https://objective-see.com/products/ostiarius.html" target="_blank" rel="external">Ostiarius</a> 这样的应用可能还有些帮助。可以在 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/90" target="_blank" rel="external">issue #90</a> 中查看相关警告。除此之外，使用 <a href="https://www.littleflocker.com/" target="_blank" rel="external">Little Flocker</a> 也能保护部分文件系统免遭非法写入，类似 Little Snitch 保护网络 (注意，该软件目前是 beat 版本，<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/pull/128" target="_blank" rel="external">谨慎使用</a>)。</p>
<p><strong>反病毒</strong>软件是把双刃剑 – 对于<strong>高级</strong>用户没什么用，却可能面临更多复杂攻击的威胁。然而对于 Mac <strong>新手</strong>用户可能是有用的，可以检测到“各种”恶意软件。不过也要考到额外的处理开销。</p>
<p>看看 <a href="https://lock.cmpxchg8b.com/sophailv2.pdf" target="_blank" rel="external">Sophail: Applied attacks against Antivirus</a> (pdf), <a href="http://googleprojectzero.blogspot.ro/2015/06/analysis-and-exploitation-of-eset.html" target="_blank" rel="external">Analysis and Exploitation of an ESET Vulnerability</a>, <a href="https://code.google.com/p/google-security-research/issues/detail?id=546" target="_blank" rel="external">a trivial Avast RCE</a>, <a href="https://theintercept.com/2015/06/22/nsa-gchq-targeted-kaspersky/" target="_blank" rel="external">Popular Security Software Came Under Relentless NSA and GCHQ Attacks</a>, 和 <a href="https://code.google.com/p/google-security-research/issues/detail?id=675" target="_blank" rel="external">AVG: “Web TuneUP” extension multiple critical vulnerabilities</a>.</p>
<p>因此，最好的防病毒方式是日常地防范。看看 <a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/44" target="_blank" rel="external">issue #44</a> 中的讨论。</p>
<p>macOS 上有很多本地提权漏洞，所以要小心那些从第三方网站或 HTTP(<a href="http://arstechnica.com/security/2015/08/0-day-bug-in-fully-patched-os-x-comes-under-active-exploit-to-hijack-macs/" target="_blank" rel="external">案例</a>)下载且运行受信或不受信的程序。</p>
<p>看看 <a href="http://www.thesafemac.com/" target="_blank" rel="external">The Safe Mac</a> 上过去和目前的 Mac 安全新闻。</p>
<p>也检查下 <a href="https://www.schneier.com/blog/archives/2015/07/hacking_team_is.html" target="_blank" rel="external">Hacking Team</a> 为 Mac OS 开发的恶意软件：<a href="https://github.com/hackedteam/vector-macos-root" target="_blank" rel="external">root installation for MacOS</a>、 <a href="https://github.com/hackedteam/driver-macos" target="_blank" rel="external">Support driver for Mac Agent</a> 和 <a href="https://github.com/hackedteam/core-macos" target="_blank" rel="external">RCS Agent for Mac</a>，这是一个很好的示例，一些高级的恶意程序是如何在<strong>用户空间</strong>隐藏自己的(例如 <code>ps</code>、<code>ls</code>)。想了解更多的话，看看 <a href="https://objective-see.com/blog/blog_0x0D.html" target="_blank" rel="external">A Brief Analysis of an RCS Implant Installer</a> 和 <a href="https://reverse.put.as/2016/02/29/the-italian-morons-are-back-what-are-they-up-to-this-time/" target="_blank" rel="external">reverse.put.as</a>。</p>
<h2 id="系统完整性保护"><a href="#系统完整性保护" class="headerlink" title="系统完整性保护"></a>系统完整性保护</h2><p><a href="https://support.apple.com/en-us/HT204899" target="_blank" rel="external">System Integrity Protection</a> (SIP) 这个安全特性源于 OS X 10.11 “El Capitan”。默认是开启的，不过<a href="https://derflounder.wordpress.com/2015/10/01/system-integrity-protection-adding-another-layer-to-apples-security-model/" target="_blank" rel="external">可以禁用</a>，这可能需要更改某些系统设置，如删除根证书颁发机构或卸载某些启动守护进程。保持这项功能默认开启状态。</p>
<p>摘取自 <a href="https://developer.apple.com/library/prerelease/mac/releasenotes/MacOSX/WhatsNewInOSX/Articles/MacOSX10_11.html" target="_blank" rel="external">OS X 10.11 新增功能</a>:</p>
<blockquote>
<p>一项新的安全政策，应用于每个正在运行的进程，包括特权代码和非沙盒中运行的代码。该策略对磁盘上和运行时的组件增加了额外的保护，只允许系统安装程序和软件更新修改系统二进制文件。不再允许代码注入和运行时附加系统二进制文件。</p>
</blockquote>
<p>阅读 <a href="https://apple.stackexchange.com/questions/193368/what-is-the-rootless-feature-in-el-capitan-really" target="_blank" rel="external">What is the “rootless” feature in El Capitan, really?</a></p>
<p><a href="http://appleinsider.com/articles/16/11/17/system-integrity-protection-disabled-by-default-on-some-touch-bar-macbook-pros" target="_blank" rel="external">禁用 SIP</a> 的一些 MacBook 已经售出。要验证 SIP 是否已启用，请使用命令 <code>csrutil status</code>，该命令应返回：<code>System Integrity Protection status: enabled.</code>。否则，通过恢复模式<a href="https://developer.apple.com/library/content/documentation/Security/Conceptual/System_Integrity_Protection_Guide/ConfiguringSystemIntegrityProtection/ConfiguringSystemIntegrityProtection.html" target="_blank" rel="external">启用 SIP</a>。</p>
<h2 id="Gatekeeper-和-XProtect"><a href="#Gatekeeper-和-XProtect" class="headerlink" title="Gatekeeper 和 XProtect"></a>Gatekeeper 和 XProtect</h2><p><strong>Gatekeeper</strong> 和 <strong>quarantine</strong> 系统试图阻止运行（打开）未签名或恶意程序及文件。</p>
<p><strong>XProtect</strong> 防止执行已知的坏文件和过时的版本插件，但并不能清除或停止现有的恶意软件。</p>
<p>两者都提供了对常见风险的一些保护，默认设置就好。</p>
<p>你也可以阅读 <a href="http://www.thesafemac.com/mmg-builtin/" target="_blank" rel="external">Mac Malware Guide : How does Mac OS X protect me?</a> 和 <a href="http://ilostmynotes.blogspot.com/2012/06/gatekeeper-xprotect-and-quarantine.html" target="_blank" rel="external">Gatekeeper, XProtect and the Quarantine attribute</a>。</p>
<p><strong>注意</strong> Quarantine 会将下载的文件信息存储在 <code>~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2</code>，这可能会造成隐私泄露的风险。简单的使用 <code>strings</code> 或下面的命令来检查文件:</p>
<pre><code>$ echo &apos;SELECT datetime(LSQuarantineTimeStamp + 978307200, &quot;unixepoch&quot;) as LSQuarantineTimeStamp, LSQuarantineAgentName, LSQuarantineOriginURLString, LSQuarantineDataURLString from LSQuarantineEvent;&apos; | sqlite3 /Users/$USER/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2
</code></pre><p>阅读<a href="http://www.zoharbabin.com/hey-mac-i-dont-appreciate-you-spying-on-me-hidden-downloads-log-in-os-x/" target="_blank" rel="external">这篇文章</a>了解更多信息。</p>
<p>想永久禁用此项功能，<a href="https://superuser.com/questions/90008/how-to-clear-the-contents-of-a-file-from-the-command-line" target="_blank" rel="external">清除文件</a>和<a href="http://hints.macworld.com/article.php?story=20031017061722471" target="_blank" rel="external">让它不可更改</a>：</p>
<pre><code>$ :&gt;~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2

$ sudo chflags schg ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2
</code></pre><p>此外，macOS 附加元数据（<a href="https://en.wikipedia.org/wiki/Extended_file_attributes#OS_X" target="_blank" rel="external">HFS+ extended attributes</a>）来下载文件，能通过 <code>mdls</code> 和 <code>xattr</code> 指令来观察：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">$ ls -l@ ~/Downloads/TorBrowser-6.0.8-osx64_en-US.dmg</div><div class="line">-rw-r--r--@ 1 drduh  staff  59322237 Dec  1 12:00 TorBrowser-6.0.8-osx64_en-US.dmg</div><div class="line">com.apple.metadata:kMDItemWhereFroms	     186</div><div class="line">com.apple.quarantine	      68</div><div class="line"></div><div class="line">$ mdls ~/Downloads/TorBrowser-6.0.8-osx64_en-US.dmg</div><div class="line">_kMDItemOwnerUserID            = 501</div><div class="line">kMDItemContentCreationDate     = 2016-12-01 12:00:00 +0000</div><div class="line">kMDItemContentModificationDate = 2016-12-01 12:00:00 +0000</div><div class="line">kMDItemContentType             = &quot;com.apple.disk-image-udif&quot;</div><div class="line">kMDItemContentTypeTree         = (</div><div class="line">    &quot;public.archive&quot;,</div><div class="line">    &quot;public.item&quot;,</div><div class="line">    &quot;public.data&quot;,</div><div class="line">    &quot;public.disk-image&quot;,</div><div class="line">    &quot;com.apple.disk-image&quot;,</div><div class="line">    &quot;com.apple.disk-image-udif&quot;</div><div class="line">)</div><div class="line">kMDItemDateAdded               = 2016-12-01 12:00:00 +0000</div><div class="line">kMDItemDisplayName             = &quot;TorBrowser-6.0.8-osx64_en-US.dmg&quot;</div><div class="line">kMDItemFSContentChangeDate     = 2016-12-01 12:00:00 +0000</div><div class="line">kMDItemFSCreationDate          = 2016-12-01 12:00:00 +0000</div><div class="line">kMDItemFSCreatorCode           = &quot;&quot;</div><div class="line">kMDItemFSFinderFlags           = 0</div><div class="line">kMDItemFSHasCustomIcon         = (null)</div><div class="line">kMDItemFSInvisible             = 0</div><div class="line">kMDItemFSIsExtensionHidden     = 0</div><div class="line">kMDItemFSIsStationery          = (null)</div><div class="line">kMDItemFSLabel                 = 0</div><div class="line">kMDItemFSName                  = &quot;TorBrowser-6.0.8-osx64_en-US.dmg&quot;</div><div class="line">kMDItemFSNodeCount             = (null)</div><div class="line">kMDItemFSOwnerGroupID          = 5000</div><div class="line">kMDItemFSOwnerUserID           = 501</div><div class="line">kMDItemFSSize                  = 60273898</div><div class="line">kMDItemFSTypeCode              = &quot;&quot;</div><div class="line">kMDItemKind                    = &quot;Disk Image&quot;</div><div class="line">kMDItemLogicalSize             = 60273898</div><div class="line">kMDItemPhysicalSize            = 60276736</div><div class="line">kMDItemWhereFroms              = (</div><div class="line">    &quot;https://dist.torproject.org/torbrowser/6.0.8/TorBrowser-6.0.8-osx64_en-US.dmg&quot;,</div><div class="line">    &quot;https://www.torproject.org/projects/torbrowser.html.en&quot;</div><div class="line">)</div><div class="line"></div><div class="line">$ xattr -l TorBrowser-6.0.8-osx64_en-US.dmg</div><div class="line">com.apple.metadata:kMDItemWhereFroms:</div><div class="line">00000000  62 70 6C 69 73 74 30 30 A2 01 02 5F 10 4D 68 74  |bplist00..._.Mht|</div><div class="line">00000010  74 70 73 3A 2F 2F 64 69 73 74 2E 74 6F 72 70 72  |tps://dist.torpr|</div><div class="line">00000020  6F 6A 65 63 74 2E 6F 72 67 2F 74 6F 72 62 72 6F  |oject.org/torbro|</div><div class="line">00000030  77 73 65 72 2F 36 2E 30 2E 38 2F 54 6F 72 42 72  |wser/6.0.8/TorBr|</div><div class="line">00000040  6F 77 73 65 72 2D 36 2E 30 2E 38 2D 6F 73 78 36  |owser-6.0.8-osx6|</div><div class="line">00000050  34 5F 65 6E 2D 55 53 2E 64 6D 67 5F 10 36 68 74  |4_en-US.dmg_.6ht|</div><div class="line">00000060  74 70 73 3A 2F 2F 77 77 77 2E 74 6F 72 70 72 6F  |tps://www.torpro|</div><div class="line">00000070  6A 65 63 74 2E 6F 72 67 2F 70 72 6F 6A 65 63 74  |ject.org/project|</div><div class="line">00000080  73 2F 74 6F 72 62 72 6F 77 73 65 72 2E 68 74 6D  |s/torbrowser.htm|</div><div class="line">00000090  6C 2E 65 6E 08 0B 5B 00 00 00 00 00 00 01 01 00  |l.en..[.........|</div><div class="line">000000A0  00 00 00 00 00 00 03 00 00 00 00 00 00 00 00 00  |................|</div><div class="line">000000B0  00 00 00 00 00 00 94                             |.......|</div><div class="line">000000b7</div><div class="line">com.apple.quarantine: 0081;58519ffa;Google Chrome.app;1F032CAB-F5A1-4D92-84EB-CBECA971B7BC</div></pre></td></tr></table></figure>
<p>可以使用 <code>-d</code> 指令标志移除原数据属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ xattr -d com.apple.metadata:kMDItemWhereFroms ~/Downloads/TorBrowser-6.0.5-osx64_en-US.dmg</div><div class="line"></div><div class="line">$ xattr -d com.apple.quarantine ~/Downloads/TorBrowser-6.0.5-osx64_en-US.dmg</div><div class="line"></div><div class="line">$ xattr -l ~/Downloads/TorBrowser-6.0.5-osx64_en-US.dmg</div><div class="line">[No output after removal.]</div></pre></td></tr></table></figure>
<h2 id="密码"><a href="#密码" class="headerlink" title="密码"></a>密码</h2><p>你可以使用 OpenSSL 生成强密码：</p>
<pre><code>$ openssl rand -base64 30
LK9xkjUEAemc1gV2Ux5xqku+PDmMmCbSTmwfiMRI
</code></pre><p>或者 GPG：</p>
<pre><code>$ gpg --gen-random -a 0 30
4/bGZL+yUEe8fOqQhF5V01HpGwFSpUPwFcU3aOWQ
</code></pre><p>或 <code>/dev/urandom</code> 输出：</p>
<pre><code>$ dd if=/dev/urandom bs=1 count=30 2&gt;/dev/null | base64
CbRGKASFI4eTa96NMrgyamj8dLZdFYBaqtWUSxKe
</code></pre><p>还可以控制字符集：</p>
<pre><code>$ LANG=C tr -dc &apos;a-zA-Z0-9&apos; &lt; /dev/urandom | fold -w 40 | head -n 1
jm0iKn7ngQST8I0mMMCbbi6SKPcoUWwCb5lWEjxK

$ LANG=C tr -dc &apos;DrDuh0-9&apos; &lt; /dev/urandom | fold -w 40 | head -n 1
686672u2Dh7r754209uD312hhh23uD7u41h3875D
</code></pre><p>你也可以用 <strong>Keychain Access（钥匙串访问）</strong>生成一个令人难忘的密码，或者用 <a href="https://github.com/anders/pwgen" target="_blank" rel="external">anders/pwgen</a> 这样的命令行生成。</p>
<p>钥匙串使用 <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="external">PBKDF2 派生密钥</a>加密，是个<strong>非常安全</strong>存储凭据的地方。看看 <a href="http://juusosalonen.com/post/30923743427/breaking-into-the-os-x-keychain" target="_blank" rel="external">Breaking into the OS X keychain</a>。还要注意钥匙串<a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/118" target="_blank" rel="external">不加密</a>的密码对应密码输入的名称。</p>
<p>或者，可以自己用 GnuPG (基于 <a href="https://github.com/drduh/pwd.sh" target="_blank" rel="external">drduh/pwd.sh</a> 密码管理脚本的一个插件)管理一个加密的密码文件。</p>
<p>除密码外，确保像 GitHub、 Google 账号、银行账户这些网上的账户，开启<a href="https://en.wikipedia.org/wiki/Two-factor_authentication" target="_blank" rel="external">两步验证</a>。</p>
<p>看看 <a href="https://www.yubico.com/products/yubikey-hardware/yubikey-neo/" target="_blank" rel="external">Yubikey</a> 的两因素和私钥(如：ssh、gpg)硬件令牌。 阅读 <a href="https://github.com/drduh/YubiKey-Guide" target="_blank" rel="external">drduh/YubiKey-Guide</a> 和 <a href="https://trmm.net/Yubikey" target="_blank" rel="external">trmm.net/Yubikey</a>。两个 Yubikey 的插槽之一可以通过编程来生成一个长的静态密码（例如可以与短的，记住的密码结合使用）。</p>
<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>备份到外部介质或在线服务之前，总是先对本地文件进行加密。</p>
<p>一种方法是使用 GPG 对称加密，你选择一个密码。</p>
<p>加密一个文件夹:</p>
<pre><code>$ tar zcvf - ~/Downloads | gpg -c &gt; ~/Desktop/backup-$(date +%F-%H%M).tar.gz.gpg
</code></pre><p>解密文档:</p>
<pre><code>$ gpg -o ~/Desktop/decrypted-backup.tar.gz -d ~/Desktop/backup-2015-01-01-0000.tar.gz.gpg &amp;&amp; \
  tar zxvf ~/Desktop/decrypted-backup.tar.gz
</code></pre><p>你也可以用 <strong>Disk Utility</strong> 或 <code>hdiutil</code> 创建加密卷：</p>
<pre><code>$ hdiutil create ~/Desktop/encrypted.dmg -encryption -size 1g -volname &quot;Name&quot; -fs JHFS+
</code></pre><p>也可以考虑使用下面的应用和服务：<a href="https://spideroak.com/" target="_blank" rel="external">SpiderOak</a>、<a href="https://www.arqbackup.com/" target="_blank" rel="external">Arq</a>、<a href="https://www.espionageapp.com/" target="_blank" rel="external">Espionage</a> 和 <a href="https://restic.github.io/" target="_blank" rel="external">restic</a>。</p>
<h2 id="Wi-Fi"><a href="#Wi-Fi" class="headerlink" title="Wi-Fi"></a>Wi-Fi</h2><p>macOS 会记住它连接过的接入点。比如所有无线设备，每次搜寻网络的时候，Mac 将会显示所有它记住的接入点名称（如 <em>MyHomeNetwork</em>） ，比如每次从休眠状态唤醒设备的时候。</p>
<p>这就有泄漏隐私的风险，所以当不再需要的时候最好从列表中移除这些连接过的网络， 在 <strong>System Preferences</strong> &gt; <strong>Network</strong> &gt; <strong>Advanced</strong> 。</p>
<p>看看 <a href="http://conferences.sigcomm.org/imc/2013/papers/imc148-barberaSP106.pdf" target="_blank" rel="external">Signals from the Crowd: Uncovering Social Relationships through Smartphone Probes</a> (pdf) 和 <a href="http://confiance-numerique.clermont-universite.fr/Slides/M-Cunche-2014.pdf" target="_blank" rel="external">Wi-Fi told me everything about you</a> (pdf)。</p>
<p>保存的 Wi-Fi 信息 (SSID、最后一次连接等)可以在 <code>/Library/Preferences/SystemConfiguration/com.apple.airport.preferences.plist</code> 中找到。</p>
<p>你可能希望在连接到新的和不可信的无线网络之前<a href="https://en.wikipedia.org/wiki/MAC_spoofing" target="_blank" rel="external">伪造网卡 MAC 地址</a>，以减少被动特征探测：</p>
<pre><code>$ sudo ifconfig en0 ether $(openssl rand -hex 6 | sed &apos;s%\(..\)%\1:%g; s%.$%%&apos;)
</code></pre><p><strong>注意</strong>每次启动，MAC 地址将重置为硬件默认地址。</p>
<p>了解下 <a href="https://github.com/feross/SpoofMAC" target="_blank" rel="external">feross/SpoofMAC</a>.</p>
<p>最后，WEP 保护在无线网络是<a href="http://www.howtogeek.com/167783/htg-explains-the-difference-between-wep-wpa-and-wpa2-wireless-encryption-and-why-it-matters/" target="_blank" rel="external">不安全</a>的，你应该尽量选择连接 <strong>WPA2</strong> 保护网络，可以减少被窃听的风险。</p>
<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>对于向外的 ssh 连接，使用硬件或密码保护的秘钥，<a href="http://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/" target="_blank" rel="external">设置</a>远程 hosts 并考虑对它们进行<a href="http://nms.csail.mit.edu/projects/ssh/" target="_blank" rel="external">哈希</a>，以增强安全性。</p>
<p>将这几个<a href="https://www.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5" target="_blank" rel="external">配置项</a>加到 <code>~/.ssh/config</code>:</p>
<pre><code>Host *
  PasswordAuthentication no
  ChallengeResponseAuthentication no
  HashKnownHosts yes
</code></pre><p><strong>注意</strong> <a href="https://openradar.appspot.com/28394826" target="_blank" rel="external">macOS Sierra 默认永久记住 SSH 秘钥密码</a>。添加配置 <code>UseKeyChain no</code> 来关闭这项功能。</p>
<p>你也可以用 ssh 创建一个<a href="http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html" target="_blank" rel="external">加密隧道</a>来发送数据，这有点类似于 VPN。</p>
<p>例如，在一个远程主机上使用 Privoxy：</p>
<pre><code>$ ssh -C -L 5555:127.0.0.1:8118 you@remote-host.tld

$ sudo networksetup -setwebproxy &quot;Wi-Fi&quot; 127.0.0.1 5555

$ sudo networksetup -setsecurewebproxy &quot;Wi-Fi&quot; 127.0.0.1 5555
</code></pre><p>或者使用 ssh 连接作为 <a href="https://www.mikeash.com/ssh_socks.html" target="_blank" rel="external">SOCKS 代理</a>：</p>
<pre><code>$ ssh -NCD 3000 you@remote-host.tld
</code></pre><p>默认情况下， macOS <strong>没有</strong> sshd ，也不允许<strong>远程登陆</strong>。</p>
<p>启用 sshd 且允许进入的 ssh 连接：</p>
<pre><code>$ sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
</code></pre><p>或者设置 <strong>System Preferences</strong> &gt; <strong>Sharing</strong> 菜单。</p>
<p>如果你准备使用 sshd，至少禁用密码身份验证并考虑进一步<a href="https://stribika.github.io/2015/01/04/secure-secure-shell.html" target="_blank" rel="external">强化</a>配置。</p>
<p>找到 <code>/etc/sshd_config</code>，添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PasswordAuthentication no</div><div class="line">ChallengeResponseAuthentication no</div><div class="line">UsePAM no</div></pre></td></tr></table></figure>
<p>确认 sshd 是否启用:</p>
<pre><code>$ sudo lsof -Pni TCP:22
</code></pre><h2 id="物理访问"><a href="#物理访问" class="headerlink" title="物理访问"></a>物理访问</h2><p>时刻保证 Mac 物理安全。不要将 Mac 留在无人照看的酒店之类的地方。</p>
<p>有一种攻击就是通过物理访问，通过注入引导 ROM 来安装键盘记录器，偷走你的密码。看看这个案例 <a href="https://trmm.net/Thunderstrike" target="_blank" rel="external">Thunderstrike</a>。</p>
<p>有个工具 <a href="https://github.com/hephaest0s/usbkill" target="_blank" rel="external">usbkill</a> 可以帮助你，这是<strong>“一个反监视断路开关，一旦发现 USB 端口发生改变就会关闭你的计算机”</strong>。</p>
<p>考虑购买屏幕<a href="https://www.amazon.com/s/ref=nb_sb_noss_2?url=node%3D15782001&amp;field-keywords=macbook" target="_blank" rel="external">隐私过滤器</a>防止别人偷瞄。</p>
<h2 id="系统监控"><a href="#系统监控" class="headerlink" title="系统监控"></a>系统监控</h2><h4 id="OpenBSM-监测"><a href="#OpenBSM-监测" class="headerlink" title="OpenBSM 监测"></a>OpenBSM 监测</h4><p>macOS 具有强大的 OpenBSM 审计功能。你可以使用它来监视进程执行、网络活动等等。</p>
<p>跟踪监测日志，使用 <code>praudit</code> 工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo praudit -l /dev/auditpipe</div><div class="line">header,201,11,execve(2),0,Thu Sep  1 12:00:00 2015, + 195 msec,exec arg,/Applications/.evilapp/rootkit,path,/Applications/.evilapp/rootkit,path,/Applications/.evilapp/rootkit,attribute,100755,root,wheel,16777220,986535,0,subject,drduh,root,wheel,root,wheel,412,100005,50511731,0.0.0.0,return,success,0,trailer,201,</div><div class="line">header,88,11,connect(2),0,Thu Sep  1 12:00:00 2015, + 238 msec,argument,1,0x5,fd,socket-inet,2,443,173.194.74.104,subject,drduh,root,wheel,root,wheel,326,100005,50331650,0.0.0.0,return,failure : Operation now in progress,4354967105,trailer,88</div><div class="line">header,111,11,OpenSSH login,0,Thu Sep  1 12:00:00 2015, + 16 msec,subject_ex,drduh,drduh,staff,drduh,staff,404,404,49271,::1,text,successful login drduh,return,success,0,trailer,111,</div></pre></td></tr></table></figure>
<p>看看 <code>audit</code>、<code>praudit</code>、<code>audit_control</code> 的操作手册，其它文件在 <code>/etc/security</code>目录下。</p>
<p><strong>注意</strong>虽然 <code>audit 手册</code> 上说 <code>-s</code> 标签会立即同步到配置中，实际上需要重启才能生效。</p>
<p>更多信息请看 <a href="http://ilostmynotes.blogspot.com/2013/10/openbsm-auditd-on-os-x-these-are-logs.html" target="_blank" rel="external">ilostmynotes.blogspot.com</a> 和 <a href="https://derflounder.wordpress.com/2012/01/30/openbsm-auditing-on-mac-os-x/" target="_blank" rel="external">derflounder.wordpress.com</a> 上的文章。</p>
<h4 id="DTrace"><a href="#DTrace" class="headerlink" title="DTrace"></a>DTrace</h4><p><code>iosnoop</code> 监控磁盘 I/O</p>
<p><code>opensnoop</code> 监控文件打开</p>
<p><code>execsnoop</code> 监控进程执行</p>
<p><code>errinfo</code> 监控失败的系统调用</p>
<p><code>dtruss</code> 监控所有系统调用</p>
<p>运行命令 <code>man -k dtrace</code> 去了解更多信息。</p>
<p><strong>注意</strong><a href="https://github.com/drduh/OS-X-Security-and-Privacy-Guide#system-integrity-protection" target="_blank" rel="external">系统完整性保护</a>和 DTrace <a href="http://internals.exposed/blog/dtrace-vs-sip.html" target="_blank" rel="external">冲突</a>，所以这些工具可能用不上了。</p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p><code>ps -ef</code> 列出所有正在运行的进程。</p>
<p>你也可以通过<strong>活动监视器</strong>来查看进程。</p>
<p><code>launchctl list</code> 和 <code>sudo launchctl list</code> 分别列出用户运行和加载的程序、系统启动守护程序和代理。</p>
<h4 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h4><p>列出公开网络文件：</p>
<pre><code>$ sudo lsof -Pni
</code></pre><p>列出各种网络相关的数据结构的内容：</p>
<pre><code>$ sudo netstat -atln
</code></pre><p>你也可以通过命令行使用 <a href="https://www.wireshark.org/" target="_blank" rel="external">Wireshark</a>。</p>
<p>监控 DNS 查询和响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ tshark -Y &quot;dns.flags.response == 1&quot; -Tfields \</div><div class="line">  -e frame.time_delta \</div><div class="line">  -e dns.qry.name \</div><div class="line">  -e dns.a \</div><div class="line">  -Eseparator=,</div></pre></td></tr></table></figure>
<p>监控 HTTP 请求和响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ tshark -Y &quot;http.request or http.response&quot; -Tfields \</div><div class="line">  -e ip.dst \</div><div class="line">  -e http.request.full_uri \</div><div class="line">  -e http.request.method \</div><div class="line">  -e http.response.code \</div><div class="line">  -e http.response.phrase \</div><div class="line">  -Eseparator=/s</div></pre></td></tr></table></figure>
<p>监控 x509 证书：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ tshark -Y &quot;ssl.handshake.certificate&quot; -Tfields \</div><div class="line">  -e ip.src \</div><div class="line">  -e x509sat.uTF8String \</div><div class="line">  -e x509sat.printableString \</div><div class="line">  -e x509sat.universalString \</div><div class="line">  -e x509sat.IA5String \</div><div class="line">  -e x509sat.teletexString \</div><div class="line">  -Eseparator=/s -Equote=d</div></pre></td></tr></table></figure>
<p>也可以考虑简单的网络监控程序 <a href="https://github.com/BonzaiThePenguin/Loading" target="_blank" rel="external">BonzaiThePenguin/Loading</a>。</p>
<h2 id="二进制白名单"><a href="#二进制白名单" class="headerlink" title="二进制白名单"></a>二进制白名单</h2><p><a href="https://github.com/google/santa/" target="_blank" rel="external">google/santa</a> 是一款为 Google 公司 Macintosh 团队开发的一款安全软件，而且是开源的。</p>
<blockquote>
<p>Santa 是 macOS 上一个二进制白名单/黑名单系统。它由多个部分组成，一个是监控执行程序的内核扩展，基于 SQLite 数据库内容进行执行决策的用户级守护进程，决定拦截的情况下通知用户的一个 GUI 代理，以及用于管理系统和数据库同步服务的命令行实用程序。</p>
</blockquote>
<p>Santa 使用<a href="https://developer.apple.com/library/content/technotes/tn2127/_index.html" target="_blank" rel="external">内核授权 API</a> 来监视和允许/禁止在内核中执行二进制文件。二进制文件可以是经过唯一哈希或开发者证书签名的白/黑名单。Santa 可以用来只允许执行可信代码，或者阻止黑名单中已知恶意软件在 Mac 上运行，和 Windows 软件 Bit9 类似。</p>
<p><strong>注意</strong> Santa 目前还没有管理规则的用户图形界面。下面的教程是为高级用户准备的！</p>
<p>安装 Santa，先访问<a href="https://github.com/google/santa/releases" target="_blank" rel="external">发布</a>页面，下载最新的磁盘镜像，挂载然后安装相关软件包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hdiutil mount ~/Downloads/santa-0.9.14.dmg</div><div class="line"></div><div class="line">$ sudo installer -pkg /Volumes/santa-0.9.14/santa-0.9.14.pkg -tgt /</div></pre></td></tr></table></figure>
<p>Santa 默认安装为 “Monitor” 模式 (不拦截，只记录)，有两个规则：一条是为了 Apple 二进制，另一条是为了 Santa 软件本身。</p>
<p>验证 Santa 是否在运行，内核模块是否加载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ santactl status</div><div class="line">&gt;&gt;&gt; Daemon Info</div><div class="line">  Mode                   | Monitor</div><div class="line">  File Logging           | No</div><div class="line">  Watchdog CPU Events    | 0  (Peak: 0.00%)</div><div class="line">  Watchdog RAM Events    | 0  (Peak: 0.00MB)</div><div class="line">&gt;&gt;&gt; Kernel Info</div><div class="line">  Kernel cache count     | 0</div><div class="line">&gt;&gt;&gt; Database Info</div><div class="line">  Binary Rules           | 0</div><div class="line">  Certificate Rules      | 2</div><div class="line">  Events Pending Upload  | 0</div><div class="line"></div><div class="line">$ ps -ef | grep &quot;[s]anta&quot;</div><div class="line">    0   786     1   0 10:01AM ??         0:00.39 /Library/Extensions/santa-driver.kext/Contents/MacOS/santad --syslog</div><div class="line"></div><div class="line">$ kextstat | grep santa</div><div class="line">  119    0 0xffffff7f822ff000 0x6000     0x6000     com.google.santa-driver (0.9.14) 693D8E4D-3161-30E0-B83D-66A273CAE026 &lt;5 4 3 1&gt;</div></pre></td></tr></table></figure>
<p>创建一个黑名单规则来阻止 iTunes 运行：</p>
<pre><code>$ sudo santactl rule --blacklist --path /Applications/iTunes.app/
Added rule for SHA-256: e1365b51d2cb2c8562e7f1de36bfb3d5248de586f40b23a2ed641af2072225b3.
</code></pre><p>试试打开 iTunes ，它会被阻止运行。</p>
<pre><code>$ open /Applications/iTunes.app/
LSOpenURLsWithRole() failed with error -10810 for the file /Applications/iTunes.app.
</code></pre><p><img width="450" alt="Santa block dialog when attempting to run a blacklisted program" src="https://cloud.githubusercontent.com/assets/12475110/21062284/14ddde88-be1e-11e6-8e9b-32f8a44c0cf6.png"></p>
<p>移除规则：</p>
<pre><code>$ sudo santactl rule --remove --path /Applications/iTunes.app/
Removed rule for SHA-256: e1365b51d2cb2c8562e7f1de36bfb3d5248de586f40b23a2ed641af2072225b3.
</code></pre><p>打开 iTunes：</p>
<pre><code>$ open /Applications/iTunes.app/
[iTunes will open successfully]
</code></pre><p>创建一个新的 C 语言小程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cat &lt;&lt;EOF &gt; foo.c</div><div class="line">&gt; #include &lt;stdio.h&gt;</div><div class="line">&gt; main() &#123; printf(&quot;Hello World\n”); &#125;</div><div class="line">&gt; EOF</div></pre></td></tr></table></figure>
<p>用 GCC 编译该程序（需要安装 Xcode 或者命令行工具）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ gcc -o foo foo.c</div><div class="line"></div><div class="line">$ file foo</div><div class="line">foo: Mach-O 64-bit executable x86_64</div><div class="line"></div><div class="line">$ codesign -d foo</div><div class="line">foo: code object is not signed at all</div></pre></td></tr></table></figure>
<p>运行它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ./foo</div><div class="line">Hello World</div></pre></td></tr></table></figure>
<p>将 Santa 切换为 “Lockdown” 模式，这种情况下只允许白名单内二进制程序运行：</p>
<pre><code>$ sudo defaults write /var/db/santa/config.plist ClientMode -int 2
</code></pre><p>试试运行未签名的二进制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ ./foo</div><div class="line">bash: ./foo: Operation not permitted</div><div class="line"></div><div class="line">Santa</div><div class="line"></div><div class="line">The following application has been blocked from executing</div><div class="line">because its trustworthiness cannot be determined.</div><div class="line"></div><div class="line">Path:       /Users/demouser/foo</div><div class="line">Identifier: 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed</div><div class="line">Parent:     bash (701)</div></pre></td></tr></table></figure>
<p>想要在白名单中添加一个指定的二进制，确定其 SHA-256 值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ santactl fileinfo /Users/demouser/foo</div><div class="line">Path                 : /Users/demouser/foo</div><div class="line">SHA-256              : 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed</div><div class="line">SHA-1                : 4506f3a8c0a5abe4cacb98e6267549a4d8734d82</div><div class="line">Type                 : Executable (x86-64)</div><div class="line">Code-signed          : No</div><div class="line">Rule                 : Blacklisted (Unknown)</div></pre></td></tr></table></figure>
<p>增加一条白名单规则：</p>
<pre><code>$ sudo santactl rule --whitelist --sha256 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed
Added rule for SHA-256: 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed.
</code></pre><p>运行它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ./foo</div><div class="line">Hello World</div></pre></td></tr></table></figure>
<p>小程序没有被阻止，它成功的运行了。</p>
<p>应用程序也可以通过开发者签名来加到白名单中（这样每次更新应用程序的时候，新版本的二进制文件就不用手动加到白名单中了）。例如，下载运行 Google Chrome ，  在 “Lockdown” 模式下 Santa 会阻止它运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ curl -sO https://dl.google.com/chrome/mac/stable/GGRO/googlechrome.dmg</div><div class="line"></div><div class="line">$ hdiutil mount googlechrome.dmg</div><div class="line"></div><div class="line">$ cp -r /Volumes/Google\ Chrome/Google\ Chrome.app /Applications/</div><div class="line"></div><div class="line">$ open /Applications/Google\ Chrome.app/</div><div class="line">LSOpenURLsWithRole() failed with error -10810 for the file /Applications/Google Chrome.app.</div></pre></td></tr></table></figure>
<p>通过它自己的开发者签名将应用加到白名单中（Signing Chain 中第一项）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">$ santactl fileinfo /Applications/Google\ Chrome.app/</div><div class="line">Path                 : /Applications/Google Chrome.app/Contents/MacOS/Google Chrome</div><div class="line">SHA-256              : 0eb08224d427fb1d87d2276d911bbb6c4326ec9f74448a4d9a3cfce0c3413810</div><div class="line">SHA-1                : 9213cbc7dfaaf7580f3936a915faa56d40479f6a</div><div class="line">Bundle Name          : Google Chrome</div><div class="line">Bundle Version       : 2883.87</div><div class="line">Bundle Version Str   : 55.0.2883.87</div><div class="line">Type                 : Executable (x86-64)</div><div class="line">Code-signed          : Yes</div><div class="line">Rule                 : Blacklisted (Unknown)</div><div class="line">Signing Chain:</div><div class="line">     1. SHA-256             : 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153</div><div class="line">        SHA-1               : 85cee8254216185620ddc8851c7a9fc4dfe120ef</div><div class="line">        Common Name         : Developer ID Application: Google Inc.</div><div class="line">        Organization        : Google Inc.</div><div class="line">        Organizational Unit : EQHXZ8M8AV</div><div class="line">        Valid From          : 2012/04/26 07:10:10 -0700</div><div class="line">        Valid Until         : 2017/04/27 07:10:10 -0700</div><div class="line"></div><div class="line">     2. SHA-256             : 7afc9d01a62f03a2de9637936d4afe68090d2de18d03f29c88cfb0b1ba63587f</div><div class="line">        SHA-1               : 3b166c3b7dc4b751c9fe2afab9135641e388e186</div><div class="line">        Common Name         : Developer ID Certification Authority</div><div class="line">        Organization        : Apple Inc.</div><div class="line">        Organizational Unit : Apple Certification Authority</div><div class="line">        Valid From          : 2012/02/01 14:12:15 -0800</div><div class="line">        Valid Until         : 2027/02/01 14:12:15 -0800</div><div class="line"></div><div class="line">     3. SHA-256             : b0b1730ecbc7ff4505142c49f1295e6eda6bcaed7e2c68c5be91b5a11001f024</div><div class="line">        SHA-1               : 611e5b662c593a08ff58d14ae22452d198df6c60</div><div class="line">        Common Name         : Apple Root CA</div><div class="line">        Organization        : Apple Inc.</div><div class="line">        Organizational Unit : Apple Certification Authority</div><div class="line">        Valid From          : 2006/04/25 14:40:36 -0700</div><div class="line">        Valid Until         : 2035/02/09 13:40:36 -0800</div></pre></td></tr></table></figure>
<p>这个例子中， <code>15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153</code> 是 Google’s Apple 开发者证书的 SHA-256 (team ID EQHXZ8M8AV)。 将它加到白名单中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo santactl rule --whitelist --certificate --sha256 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153</div><div class="line">Added rule for SHA-256: 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153.</div></pre></td></tr></table></figure>
<p>Google Chrome 现在应该可以启动了，以后的更新也不会被阻止，除非签名证书修改了或过期了。</p>
<p>关闭 “Lockdown” 模式：</p>
<pre><code>$ sudo defaults delete /var/db/santa/config.plist ClientMode
</code></pre><p>在 <code>/var/log/santa.log</code> 可以查看监控器<strong>允许</strong>和<strong>拒绝</strong>执行的决策记录。</p>
<p><strong>注意</strong> Python、Bash 和其它解释性语言是在白名单中的（因为它们是由苹果开发者证书签名的），所以 Santa 不会阻止这些脚本的运行。因此，要注意到 Santa 可能无法有效的拦截非二进制程序运行（这不算漏洞，因为它本身就这么设计的）。</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>如果你想的话，禁用<a href="https://github.com/fix-macosx/fix-macosx/wiki/Diagnostics-&amp;-Usage-Data" target="_blank" rel="external">诊断与用量</a>.</p>
<p>如果你想播放<strong>音乐</strong>或看<strong>视频</strong>，使用 <a href="https://www.videolan.org/vlc/index.html" target="_blank" rel="external">VLC 播放器</a>，这是免费且开源的。</p>
<p>如果你想用 <strong>torrents</strong>， 使用免费、开源的 <a href="http://www.transmissionbt.com/download/" target="_blank" rel="external">Transmission</a>（注意：所有软件都一样，即使是开源项目，<a href="http://researchcenter.paloaltonetworks.com/2016/03/new-os-x-ransomware-keranger-infected-transmission-bittorrent-client-installer/" target="_blank" rel="external">恶意软件还是可能找到破解的方式</a>）。你可能希望使用一个块列表来避免和那些已知的坏主机配对，了解下 <a href="https://giuliomac.wordpress.com/2014/02/19/best-blocklist-for-transmission/" target="_blank" rel="external">Transmission 上最好的块列表</a> 和 <a href="https://gist.github.com/johntyree/3331662" target="_blank" rel="external">johntyree/3331662</a>。</p>
<p>用 <a href="http://duti.org/" target="_blank" rel="external">duti</a> 管理默认文件处理，可以通过 <code>brew install duti</code> 来安装。管理扩展的原因之一是为了防止远程文件系统在 Finder 中自动挂载。 (<a href="https://www.taoeffect.com/blog/2016/02/apologies-sky-kinda-falling-protecting-yourself-from-sparklegate/" target="_blank" rel="external">保护自己免受 Sparkle 后门影响</a>)。这里有几个推荐的管理指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ duti -s com.apple.Safari afp</div><div class="line"></div><div class="line">$ duti -s com.apple.Safari ftp</div><div class="line"></div><div class="line">$ duti -s com.apple.Safari nfs</div><div class="line"></div><div class="line">$ duti -s com.apple.Safari smb</div></pre></td></tr></table></figure>
<p>使用<strong>控制台</strong>应用程序来监控系统日志，也可以用 <code>syslog -w</code> 或 <code>log stream</code> 命令。</p>
<p>在 macOS Sierra (10.12) 之前的系统，在 <code>/etc/sudoers</code>启用 <a href="https://derflounder.wordpress.com/2016/09/21/tty_tickets-option-now-on-by-default-for-macos-sierras-sudo-tool/" target="_blank" rel="external">tty_tickets flag</a> 来阻止 sudo 会话在其它终端生效。使用命令 <code>sudo visudo</code> 然后添加一行 <code>Defaults    tty_tickets</code> 就可以了。</p>
<p>设置进入休眠状态时马上启动屏幕保护程序：</p>
<pre><code>$ defaults write com.apple.screensaver askForPassword -int 1

$ defaults write com.apple.screensaver askForPasswordDelay -int 0
</code></pre><p>在 Finder 中显示隐藏文件和文件夹：</p>
<pre><code>$ defaults write com.apple.finder AppleShowAllFiles -bool true

$ chflags nohidden ~/Library
</code></pre><p>显示所有文件扩展名（这样 “Evil.jpg.app” 就无法轻易伪装了）。</p>
<pre><code>$ defaults write NSGlobalDomain AppleShowAllExtensions -bool true
</code></pre><p>不要默认将文档保存到 iCloud：</p>
<pre><code>$ defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false
</code></pre><p>在终端启用<a href="https://security.stackexchange.com/questions/47749/how-secure-is-secure-keyboard-entry-in-mac-os-xs-terminal" target="_blank" rel="external">安全键盘输入</a>（除非你用 <a href="https://mig5.net/content/secure-keyboard-entry-os-x-blocks-interaction-yubikeys" target="_blank" rel="external">YubiKey</a> 或者像 <a href="https://smilesoftware.com/textexpander/secureinput" target="_blank" rel="external">TextExpander</a> 这样的程序）。</p>
<p>禁用崩溃报告（就是那个在程序崩溃后，会出现提示将问题报告给苹果的提示框）：</p>
<pre><code>$ defaults write com.apple.CrashReporter DialogType none
</code></pre><p>禁用 Bonjour <a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/mDNS---Telling-the-world-about-you-(and-your-device" target="_blank" rel="external">多播广告</a>/):</p>
<pre><code>$ sudo defaults write /Library/Preferences/com.apple.mDNSResponder.plist NoMulticastAdvertisements -bool YES
</code></pre><p>如果用不上的话，<a href="https://apple.stackexchange.com/questions/151481/why-is-my-macbook-visibile-on-bluetooth-after-yosemite-install" target="_blank" rel="external">禁用 Handoff</a> 和蓝牙功能。</p>
<p>考虑 <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/sandbox-exec.1.html" target="_blank" rel="external">sandboxing</a> 你的应用程序。 了解下 <a href="https://reverse.put.as/wp-content/uploads/2011/09/Apple-Sandbox-Guide-v0.1.pdf" target="_blank" rel="external">fG! Sandbox Guide</a> (pdf) 和 <a href="https://github.com/s7ephen/OSX-Sandbox--Seatbelt--Profiles" target="_blank" rel="external">s7ephen/OSX-Sandbox–Seatbelt–Profiles</a>。</p>
<p>你知道苹果公司自 <a href="http://osxbook.com/book/bonus/chapter10/tpm/" target="_blank" rel="external">2006</a> 后就不再出售带 TPM 的电脑了吗？</p>
<h2 id="相关软件"><a href="#相关软件" class="headerlink" title="相关软件"></a>相关软件</h2><p><a href="https://github.com/google/santa/" target="_blank" rel="external">Santa</a> - macOS 上一个带二进制白名单/黑名单监控系统的软件。</p>
<p><a href="https://github.com/kristovatlas/osx-config-check" target="_blank" rel="external">kristovatlas/osx-config-check</a> - 检查你的 OSX 设备各种硬件配置设置。</p>
<p><a href="https://objective-see.com/products/lockdown.html" target="_blank" rel="external">Lockdown</a> - 审查和修正安全配置。</p>
<p><a href="https://objective-see.com/products/dhs.html" target="_blank" rel="external">Dylib Hijack Scanner</a> - 扫描那些容易被劫持或已经被黑的应用。</p>
<p><a href="https://www.littleflocker.com/" target="_blank" rel="external">Little Flocker</a> - “Little Snitch for files”， 防止应用程序访问文件。</p>
<p><a href="https://github.com/facebook/osquery" target="_blank" rel="external">facebook/osquery</a> - 可以检索系统底层信息。用户可以编写 SQL 来查询系统信息。</p>
<p><a href="https://github.com/google/grr" target="_blank" rel="external">google/grr</a> - 事件响应框架侧重于远程现场取证。</p>
<p><a href="https://github.com/yelp/osxcollector" target="_blank" rel="external">yelp/osxcollector</a> - 证据收集 &amp; OS X 分析工具包。</p>
<p><a href="https://github.com/jipegit/OSXAuditor" target="_blank" rel="external">jipegit/OSXAuditor</a> - 分析运行系统时的部件，比如隔离的文件， Safari、 Chrome 和 Firefox 历史记录， 下载，HTML5 数据库和本地存储、社交媒体、电子邮件帐户、和 Wi-Fi 接入点的名称。</p>
<p><a href="https://github.com/libyal/libfvde" target="_blank" rel="external">libyal/libfvde</a> - 访问 FileVault Drive Encryption (FVDE) (或 FileVault2) 加密卷的库。</p>
<p><a href="https://github.com/CISOfy/lynis" target="_blank" rel="external">CISOfy/lynis</a> - 跨平台安全审计工具，并协助合规性测试和系统强化。</p>
<h2 id="其它资源"><a href="#其它资源" class="headerlink" title="其它资源"></a>其它资源</h2><p><strong>排名不分先后</strong></p>
<p><a href="http://newosxbook.com/files/moxii3/AppendixA.pdf" target="_blank" rel="external">MacOS Hardening Guide - Appendix of *OS Internals: Volume III - Security &amp; Insecurity Internals</a> (pdf)</p>
<p><a href="https://developer.apple.com/library/mac/documentation/Security/Conceptual/SecureCodingGuide/Introduction.html" target="_blank" rel="external">Mac Developer Library: Secure Coding Guide</a></p>
<p><a href="https://www.apple.com/osx/all-features/pdf/osx_elcapitan_core_technologies_overview.pdf" target="_blank" rel="external">OS X Core Technologies Overview White Paper</a> (pdf)</p>
<p><a href="https://reverse.put.as/" target="_blank" rel="external">Reverse Engineering Mac OS X blog</a></p>
<p><a href="http://samdmarshall.com/re.html" target="_blank" rel="external">Reverse Engineering Resources</a></p>
<p><a href="https://objective-see.com/blog.html" target="_blank" rel="external">Patrick Wardle’s Objective-See blog</a></p>
<p><a href="https://www.usenix.org/conference/lisa13/managing-macs-google-scale" target="_blank" rel="external">Managing Macs at Google Scale (LISA ‘13)</a></p>
<p><a href="https://www.usenix.org/conference/lisa13/os-x-hardening-securing-large-global-mac-fleet" target="_blank" rel="external">OS X Hardening: Securing a Large Global Mac Fleet (LISA ‘13)</a></p>
<p><a href="http://iase.disa.mil/stigs/os/mac/Pages/mac-os.aspx" target="_blank" rel="external">DoD Security Technical Implementation Guides for Mac OS</a></p>
<p><a href="http://homepage.ntlworld.com/jonathan.deboynepollard/FGA/efi-boot-process.html" target="_blank" rel="external">The EFI boot process</a></p>
<p><a href="http://refit.sourceforge.net/info/boot_process.html" target="_blank" rel="external">The Intel Mac boot process</a></p>
<p><a href="https://archive.org/details/joshpitts_shmoocon2015" target="_blank" rel="external">Userland Persistence on Mac OS X</a></p>
<p><a href="http://phrack.org/issues/66/16.html#article" target="_blank" rel="external">Developing Mac OSX kernel rootkits</a></p>
<p><a href="https://code.google.com/p/google-security-research/issues/detail?id=135" target="_blank" rel="external">IOKit kernel code execution exploit</a></p>
<p><a href="https://truesecdev.wordpress.com/2015/04/09/hidden-backdoor-api-to-root-privileges-in-apple-os-x/" target="_blank" rel="external">Hidden backdoor API to root privileges in Apple OS X</a></p>
<p><a href="http://www.insinuator.net/2015/02/ipv6-hardening-guide-for-os-x/" target="_blank" rel="external">IPv6 Hardening Guide for OS X</a></p>
<p><a href="http://docs.hardentheworld.org/OS/OSX_10.11_El_Capitan/" target="_blank" rel="external">Harden the World: Mac OSX 10.11 El Capitan</a></p>
<p><a href="https://news.ycombinator.com/item?id=10148077" target="_blank" rel="external">Hacker News discussion</a></p>
<p><a href="https://news.ycombinator.com/item?id=13023823" target="_blank" rel="external">Hacker News discussion 2</a></p>
<p><a href="https://opensource.apple.com/" target="_blank" rel="external">Apple Open Source</a></p>
<p><a href="http://arstechnica.com/apple/2014/10/os-x-10-10/" target="_blank" rel="external">OS X 10.10 Yosemite: The Ars Technica Review</a></p>
<p><a href="https://benchmarks.cisecurity.org/tools2/osx/CIS_Apple_OSX_10.10_Benchmark_v1.1.0.pdf" target="_blank" rel="external">CIS Apple OSX 10.10 Benchmark</a> (pdf)</p>
<p><a href="https://taoofmac.com/space/HOWTO/Switch" target="_blank" rel="external">How to Switch to the Mac</a></p>
<p><a href="http://www.apple.com/support/security/guides/docs/SnowLeopard_Security_Config_v10.6.pdf" target="_blank" rel="external">Security Configuration For Mac OS X Version 10.6 Snow Leopard</a> (pdf)</p>
<p><a href="https://ssd.eff.org/" target="_blank" rel="external">EFF Surveillance Self-Defense Guide</a></p>
<p><a href="https://macadmins.herokuapp.com/" target="_blank" rel="external">MacAdmins on Slack</a></p>
<p><a href="http://support.apple.com/kb/HT4865" target="_blank" rel="external">iCloud security and privacy overview</a></p>
<p><a href="http://newosxbook.com/DMG.html" target="_blank" rel="external">Demystifying the DMG File Format</a></p>
<p><a href="https://vulnsec.com/2016/osx-apps-vulnerabilities/" target="_blank" rel="external">There’s a lot of vulnerable OS X applications out there (Sparkle Framework RCE)</a></p>
<p><a href="https://jscholarship.library.jhu.edu/handle/1774.2/36569" target="_blank" rel="external">iSeeYou: Disabling the MacBook Webcam Indicator LED</a></p>
<p><a href="https://www.ma.rhul.ac.uk/static/techrep/2015/RHUL-MA-2015-8.pdf" target="_blank" rel="external">Mac OS X Forensics - Technical Report</a> (pdf)</p>
<p><a href="https://cet4861.pbworks.com/w/file/fetch/71245694/mac.forensics.craiger-burke.IFIP.06.pdf" target="_blank" rel="external">Mac Forensics: Mac OS X and the HFS+ File System</a> (pdf)</p>
<p><a href="https://tribalchicken.com.au/security/extracting-filevault-2-keys-with-volatility/" target="_blank" rel="external">Extracting FileVault 2 Keys with Volatility</a></p>
<p><a href="https://googleprojectzero.blogspot.com/2015/09/revisiting-apple-ipc-1-distributed_28.html" target="_blank" rel="external">Auditing and Exploiting Apple IPC</a></p>
<p><a href="https://www.amazon.com/Mac-OS-iOS-Internals-Apples/dp/1118057651" target="_blank" rel="external">Mac OS X and iOS Internals: To the Apple’s Core by Jonathan Levin</a></p>
<p><a href="http://ramtin-amin.fr/#nvmepcie" target="_blank" rel="external">Demystifying the i-Device NVMe NAND (New storage used by Apple)</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/15/office-food/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/15/office-food/" itemprop="url">
                  上班吃什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-15T18:25:13+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/15/office-food/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/15/office-food/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="坚果"><a href="#坚果" class="headerlink" title="坚果"></a>坚果</h2><p>整天很费脑力 平时又几乎不吃小零食</p>
<p>最近用宜家的瓶子 装剥好的坚果</p>
<p>想吃就吃</p>
<p>嗯 你不喜欢吃肉 你要多吃坚果</p>
<p>准备了核桃 夏威夷果 巴旦木 碧根果 枸杞 大枣 葡萄干和黑加仑干<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/office1.jpeg" width="300px" height="300px"></p>
<p>每天中午吃完饭后 如果瓶子里快没了 就开始扒吧</p>
<p>把瓶子用多种坚果装满 很幸福<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/office2.jpeg" width="300px" height="300px"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/23/roast-fish2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/23/roast-fish2/" itemprop="url">
                  大连烤鱼片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-23T00:00:00+08:00">
                2016-10-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/23/roast-fish2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/23/roast-fish2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2016-10月下旬</p>
</blockquote>
<p>大连的现烤鱼片 挺好吃的 可是为什么口味又咸又甜啊</p>
<p>找店家又买了点 找的圆通快递 路线是大连－无锡－上海  等了好久 差评</p>
<p><span style="color: #ff6600; font-size: 18pt;">#关于快递</span></p>
<p>好不容易第三天上午开始派件 快递小哥默认周末不往公司派件</p>
<p>发了个短信说 我里面是生鲜 麻烦放配件箱里 等下我自己去拿</p>
<p>第二天早上 还是没派件</p>
<p>果断投诉</p>
<p>塞进去了</p>
<p>我去拿的时候 惊呆了</p>
<p>快递拿不出来 那个柜子很矮</p>
<p>于是我拽了五分钟后 拿出了变形的鱼干</p>
<p>第三次投诉</p>
<p>不关什么工作和职位 最起码说不会让人差评吧</p>
<p>不然 和咸鱼有什么区别（不是下面的咸鱼 人家很好吃 很尽力的遇到我 被我品尝 也值了）</p>
<p><span style="color: #ff6600; font-size: 18pt;">#下面是图</span></p>
<p>下午吃一片 精神一整天 额 不是啦 还是略咸 口味变淡很久了</p>
<p>请忽略牌子 这和牌子没关系</p>
<p>烤得焦黄焦黄的 满满的幸福啊 （咽了下口水）<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10233.jpg?imageView2/2/h/350"></p>
<p>包装可以选正常或者真空的 可是真空的一压缩会硬 影响口感<br>保质期大概一个月 反正我应该能吃完 不会坏</p>
<p><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10230.jpg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10231.jpg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10232.jpg?imageView2/2/h/350"><br><span style="color: #ff6600; font-size: 18pt;">#总结</span></p>
<p>生活很美好 需要你发现</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/23/nuts/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/23/nuts/" itemprop="url">
                  你不爱吃肉 要多吃坚果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-23T00:00:00+08:00">
                2016-10-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/23/nuts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/23/nuts/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2016-9 秋天到了</p>
</blockquote>
<p>嗯 作为辛苦搬砖的人 要多吃坚果 补补脑</p>
<p>之前买的夏威夷果巴旦木碧根果什么的 没看口味 买到了什么奶油味啊 超咸 不好吃</p>
<p>于是这次 挑了很久 和客服妹妹再三确认 我这个是原味的啊 是椒盐味的么</p>
<p><span style="color: #ff6600; font-size: 16pt;">#下面是图</span></p>
<p>碧根果超难剥 我的手啊 后来知乎了下 说是用剪刀剪</p>
<p><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/102322.jpg?imageView2/2/h/350"></p>
<p>巴旦木很好剥 又好吃啦啦啦</p>
<p><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/102323.jpg?imageView2/2/h/350"></p>
<p>嗯 弄好 装瓶 每天吃半瓶 补补脑</p>
<p><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/102324.jpg?imageView2/2/h/350"></p>
<p><span style="color: #ff6600; font-size: 18pt;">#总结</span></p>
<p>大神说过坚果的好</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/19/bootstrap-considered-harmful/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/19/bootstrap-considered-harmful/" itemprop="url">
                  【译】你考虑清楚了吗就决定用 Bootstrap ？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-19T00:00:00+08:00">
                2016-10-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/19/bootstrap-considered-harmful/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/19/bootstrap-considered-harmful/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>原文地址：<a href="https://hiddedevries.nl/en/blog/2016-08-09-bootstrap-considered-harmful" target="_blank" rel="external">Bootstrap considered harmful</a></li>
<li>原文作者：<a href="https://hiddedevries.nl/en/about-me/" target="_blank" rel="external">Hidde de Vries</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a></li>
<li>译者： <a href="https://github.com/MAYDAY1993" target="_blank" rel="external">MAYDAY1993</a></li>
<li>校对者： <a href="https://github.com/Kulbear" target="_blank" rel="external">Kulbear</a>  <a href="https://github.com/hpoenixf" target="_blank" rel="external">hpoenixf</a></li>
</ul>
<h1 id="你考虑清楚了吗就决定用-Bootstrap-？"><a href="#你考虑清楚了吗就决定用-Bootstrap-？" class="headerlink" title="你考虑清楚了吗就决定用 Bootstrap ？"></a>你考虑清楚了吗就决定用 Bootstrap ？</h1><p>近年来，在前端项目中， Bootstrap 已经成为了一个非常受欢迎的工具。 Bootstrap 的确有很多优点，然而，如果你的团队中恰好有一个专职的前端工程师。那我推荐你们不要使用 Bootstrap ，因为在某些情况下， Bootstrap 弊大于利。</p>
<h2 id="Bootstrap-对什么有好处"><a href="#Bootstrap-对什么有好处" class="headerlink" title="Bootstrap 对什么有好处"></a>Bootstrap 对什么有好处</h2><p> Bootstrap 带有栅格系统，也有针对很多组件的样式和脚本，包括表格，导航栏，进度条，分页，表单样式，模态框和提示框。在这篇文章中，谈论 ‘Bootstrap’，我的意思是包含所有组件的实践（与只选择包括一部分相反，例如， <em>只是</em>栅格）。<br>对于需要把项目输出成标记语言，并且不想操心将结果样式化的后端开发工程师来讲， Bootstrap 是一个好的工具。如果因为某些原因，比如预算或其他因素，在一个团队里没有前端开发者或设计师， Bootstrap 适合用来填坑。</p>
<p>对于设计师来讲， Bootstrap 也有一席之地：它是一个很有价值的工具，用来从设计软件快速移动到浏览器，而不需要过度担心前端代码策略。<br>甚至对于主要和数据打交道很少关注 UI 和布局的前端开发者，让一个开发者关注于搭建应用本身， Bootstrap 在这一方面也很好。</p>
<h2 id="什么时候你最好别用它"><a href="#什么时候你最好别用它" class="headerlink" title="什么时候你最好别用它"></a>什么时候你最好别用它</h2><p>然而，如果你的团队里有一个前端开发工程师，使用 Bootstrap 会潜在地浪费他们宝贵的时间，并且将他们的注意力从解决实际的问题转移。 Bootstrap 恰恰做的是前端开发者擅长的，但是它以一种很普遍的方式来实现。你的网站或应用是很具体的，所以如果你用一个普遍的系统，它有可能不会起作用。这意味着你的代码将包含全部的可能性才有可能实现具体的需求。</p>
<h3 id="当你需要很多代码来覆盖-Bootstrap-的样式"><a href="#当你需要很多代码来覆盖-Bootstrap-的样式" class="headerlink" title="当你需要很多代码来覆盖 Bootstrap 的样式"></a>当你需要很多代码来覆盖 Bootstrap 的样式</h3><p> Bootstrap 是由 Twitter 的开发者开发来系统化他们网站应用的样式。当你的网站应用的样式和他们不一样，这意味着你不得不覆盖掉他们的样式来。<br>大多数网站的样式并不像 Twitter 那样。因此，如果他们安装 Bootstrap ，他们会覆盖掉很多样式。<br>在一些我参与的网站中，我发现多达十分之九的 Bootstrap 样式会被网站自己的样式覆盖掉。很坦率的讲，这是荒谬的。</p>
<h3 id="当它让简单的事情复杂化"><a href="#当它让简单的事情复杂化" class="headerlink" title="当它让简单的事情复杂化"></a>当它让简单的事情复杂化</h3><p> CSS 用来为网页增加一系列简单的在某些条件下会被代码覆盖的样式规则。当你的网站中有 Bootstrap 的样式，几乎网站内所有的东西都已经被一系列复杂的代码规则设置好了。任何例外都会超出这个框架所设置好的规则。而大多数网站所面临的问题正是它们的样式对于 Bootstrap 来说往往是例外。<br> Bootstrap 的样式是复杂的：你会有一个带有 12 列的栅格系统，这 12 列能以你想要的任何方式组合使用，有特殊的类来基于用户的视图尺寸设置不同的偏移量和列结构。很多网站是简单的：在小屏幕上没有列，在更大的屏幕会有一到两列。</p>
<h3 id="当它产生了技术债务"><a href="#当它产生了技术债务" class="headerlink" title="当它产生了技术债务"></a>当它产生了技术债务</h3><p>一个前端代码库依赖 Bootstrap 的时间越长，纠缠的越多，并且它包含了更多只是用来覆盖掉 Bootstrap 代码的规则。这常常导致代码库陷于巨大的技术债务，尤其当前端代码以经常需要手动更新的方式整合在后端的时候。</p>
<h3 id="当它引入可能不是你的应用的命名习惯"><a href="#当它引入可能不是你的应用的命名习惯" class="headerlink" title="当它引入可能不是你的应用的命名习惯"></a>当它引入可能不是你的应用的命名习惯</h3><p>命名很难，而且想出有意义的属于你的团队和应用的命名习惯很花时间。对于组件名使用合适的名词，不要和一些名词的缩写像 ’btn’ 的类名混淆。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>在开发网站的过程中 Bootstrap 和朋友在各种各样的阶段是有好处的。然而它们不是一个能使任何事都简单的魔法：相反，会有很多能够通过让前端开发者关注于亲自开发 UI 来避免的缺点。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/19/using-a-core-data-model-in-swift-playgrounds/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/19/using-a-core-data-model-in-swift-playgrounds/" itemprop="url">
                  【译】在 Swift Playgrounds 中使用 Core Data 模型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-19T00:00:00+08:00">
                2016-10-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/19/using-a-core-data-model-in-swift-playgrounds/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/19/using-a-core-data-model-in-swift-playgrounds/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>原文链接 : <a href="https://www.andrewcbancroft.com/2016/07/10/using-a-core-data-model-in-swift-playgrounds/" target="_blank" rel="external">using-a-core-data-model-in-swift-playgrounds</a></li>
<li>原文作者 : <a href="https://www.andrewcbancroft.com/" target="_blank" rel="external">Andrew Bancroft</a></li>
<li>译文出自 : <a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a></li>
<li>译者 : <a href="https://github.com/MAYDAY1993" target="_blank" rel="external">MAYDAY1993</a></li>
<li>校对者: <a href="https://github.com/siegeout" target="_blank" rel="external">siegeout</a> [owenlyn] (<a href="https://github.com/owenlyn" target="_blank" rel="external">https://github.com/owenlyn</a>)</li>
</ul>
<h1 id="在-Swift-Playgrounds-中使用-Core-Data-模型"><a href="#在-Swift-Playgrounds-中使用-Core-Data-模型" class="headerlink" title="在 Swift Playgrounds 中使用 Core Data 模型"></a>在 Swift Playgrounds 中使用 Core Data 模型</h1><p>你能在 Xcode 的 Swift Playgrounds 中使用 Core Data 模型么？当然可以！</p>
<p>在2015年， <a href="http://www.learncoredata.com" target="_blank" rel="external">http://www.learncoredata.com</a>的作者 <a href="https://twitter.com/JCubedApps" target="_blank" rel="external">Jeremiah Jessel</a>，写了篇文章 <a href="http://www.learncoredata.com/core-data-and-playgrounds/" target="_blank" rel="external">detailing how you can use the Core Data framework inside a playground</a>。从建立 Core Data 堆栈到在代码中创建 NSManagedObjects，他向我们展示了如何处理这一过程中的所有事情。多么好的资料啊！<br>读完他的指南后，我开始思考：我很好奇你是否能拿到一个由 Xcode 的数据模型设计创建的 .xcdatamodeld 文件，并在某个背景使用这个文件…<br>简短的答案是不可以。你不能使用 .xcdatamodeld 文件（至少，我找不到可行的方法），但是你能用当你构建应用就生成的 “momd” 文件。</p>
<p>##局限性<br>当我了解这个概念的时候我遇到了至少两个局限性／或者说是需要注意的地方。</p>
<p> ##没有 NSManagedObject 子类<br>尽管你能在模型中创建实体的实例，如果你已经为实体创建了 <code>NSManagedObject</code> 的子类，在 Swift Playgrounds 中你还不能使用这些实体。你得用 <code>setValue(_: forKey:)</code> 在  <code>NSManagedObject</code> 实例中设置属性来解决这一问题。<br>但是这只是一个很小的缺陷，尤其是如果你只想稍微了解。</p>
<p>##更新模型<br>你读过 <a href="https://www.andrewcbancroft.com/2016/07/10/using-a-core-data-model-in-swift-playgrounds/#walkthrough" target="_blank" rel="external">walkthrough</a>之后，将会知道如何在背景中引入模型。<br>总的说来是这样的:如果你曾经更改了模型，你需要操作必须的步骤来在资源文件夹中重新添加一个最新编译的模型。这是因为新加的资源是复制过来的，不是引用的。<br>我并不认为这是个很糟糕的缺点，尤其是你一旦了解怎么做的时候。<br>所以你要怎么做呢？看下面过程：</p>
<p>##攻略<br>在你的项目中加入一个数据模型，我们开始啦。如果你已经进行了一个使用 Core Data 的项目，在你的项目里可能已经有了一个 .xcdatamodeld 文件。如果你没有，这个 .xcdatamodeld 文件能从文件菜单中简单添加。</p>
<p>##添加数据模型文件（除非你已经有一个）<br> File -&gt; New -&gt; File…<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/new-model.png" alt="New Data Model"></p>
<p>用冒烟测试来看以上方法是否可行，我将模型名字设置为默认的值 “Model.xcdatamodeld”。</p>
<p>##添加带属性的实体<br>将数据模型添加到项目之后，我继续添加了一个带（ 16 位的整数类型名字是 “attribute” ）属性的（名字叫 “Entity” ）实体：<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/add-entity-and-attributes.png" alt="Add an entity with an attribute."></p>
<p>##添加 playground<br>下一步，我往项目里加了一个新的 playground：<br> File -&gt; New -&gt; Playground…<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/new-playground.png" alt="Add new playground"></p>
<p>##构建项目：定位 “momd” 文件<br>有一个 playground 并且一个数据模型结构化了，我构建了项目（CMD + B），因此 .xcdatamodeld 文件能被编译成一个 “momd” 文件。就是这个 “momd” 文件需要作为一个资源被添加到 playground 中。<br>要找到 “momd” 文件，在你的项目导航栏中展开 “Products”，右击 .app，单击 “Show in Finder”：<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/show-product-in-finder.png" alt="Show product in finder"></p>
<p>##显示 .app 包的内容<br>在 finder 窗口，右击 .app 文件，然后单击 “Show package contents”:<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/show-package-contents.png" alt="Show package contents"></p>
<p>##从 finder 中把 “momd” 文件拖拽到 playground 的资源文件夹<br><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/locate-momd-file.png" alt="Locate "></p>
<p><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/drag-momd-to-resources.png" alt="Drag "></p>
<p>##写 Core Data 代码来使用模型<br>既然 “momd” 文件在 playground 的资源文件夹里，你能写代码了。你能插入 <code>NSManagedObject</code> 实例，运行 fetch requests 等等。下面是我写的一个例子：</p>
<p>Core Data Playground<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import CoreData</div><div class="line"></div><div class="line">// Core Data 堆栈存在内存中</div><div class="line">public func createMainContext() -&gt; NSManagedObjectContext &#123;</div><div class="line"></div><div class="line">    //用你自己模型的名字替换 &quot;Model&quot;</div><div class="line">    let modelUrl = NSBundle.mainBundle().URLForResource(&quot;Model&quot;, withExtension: &quot;momd&quot;)</div><div class="line">    guard let model = NSManagedObjectModel.init(contentsOfURL: modelUrl!) else &#123; fatalError(&quot;model not found&quot;) &#125;</div><div class="line"></div><div class="line">    let psc = NSPersistentStoreCoordinator(managedObjectModel: model)</div><div class="line">    try! psc.addPersistentStoreWithType(NSInMemoryStoreType, configuration: nil, URL: nil, options: nil)</div><div class="line"></div><div class="line">    let context = NSManagedObjectContext(concurrencyType: .MainQueueConcurrencyType)</div><div class="line">    context.persistentStoreCoordinator = psc</div><div class="line"></div><div class="line">    return context</div><div class="line">&#125;</div><div class="line"></div><div class="line">let context = createMainContext()</div><div class="line"></div><div class="line">//插入一个新实体</div><div class="line">let ent = NSEntityDescription.insertNewObjectForEntityForName(&quot;Entity&quot;, inManagedObjectContext: context)</div><div class="line">ent.setValue(42, forKey: &quot;attribute&quot;)</div><div class="line"></div><div class="line">try! context.save()</div><div class="line"></div><div class="line">//运行一个 fetch request</div><div class="line">let fr = NSFetchRequest(entityName: &quot;Entity&quot;)</div><div class="line">let result = try! context.executeFetchRequest(fr)</div><div class="line"></div><div class="line">print(result)</div></pre></td></tr></table></figure></p>
<p><img src="https://www.andrewcbancroft.com/wp-content/uploads/2016/07/printed-result.png" alt="Fetch request result"></p>
<p>哇哦！这很酷啊。</p>
<p><strong>别忘了</strong> :如果你更新了模块，你需要重新构建你的应用，从 playground 的资源中删掉 “momd” 文件夹，再一次重新把新编译好的 “momd”  文件拖拽到 playground 中来运行最新版本的模型。</p>
<h2 id="潜在的用处"><a href="#潜在的用处" class="headerlink" title="潜在的用处"></a>潜在的用处</h2><p>除了“我想知道这是否可能”，另一个问的重要问题是“它是多么有用？”</p>
<ul>
<li>学习。 Playgrounds 本身作为一个学习工具有意义。能够搭建你在 Xcode 设计中思考的模块，把它导入一个 Playground ，并且把它当作一个学习练习来研究它，是多么酷啊！</li>
<li>当你需要测试你的数据模块但是不想把它连到一个实际的用户交互的时候，也是有用的。在 playground 中抛掉所有用户交互复杂性，只研究数据模型！这似乎是一个比在控制台输出更优雅的解决方法</li>
<li>有可能你需要为一个 fetch request 构建半复杂性的 <code>NSPredicate</code> 实例－－为何不首先在 playground 中得到这个实例，然后把实例迁移到你的应用中呢？仅仅是个想法哦！</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/18/Empty-State-Mobile-App-“Nice-to-Have”-Essential/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/18/Empty-State-Mobile-App-“Nice-to-Have”-Essential/" itemprop="url">
                  Empty State Mobile App “Nice-to-Have” Essential
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T00:00:00+08:00">
                2016-10-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/18/Empty-State-Mobile-App-“Nice-to-Have”-Essential/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/18/Empty-State-Mobile-App-“Nice-to-Have”-Essential/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>原文链接 : <a href="https://uxplanet.org/empty-state-mobile-app-nice-to-have-essential-f11c29f01f3" target="_blank" rel="external"> Empty State: Mobile App “Nice-to-Have” Essential </a></li>
<li>原文作者 : <a href="http://babich.biz/" target="_blank" rel="external"> Nick Babich </a></li>
<li>译文出自 : <a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">掘金翻译计划</a></li>
<li>译者 :<a href="https://github.com/MAYDAY1993" target="_blank" rel="external"> MAYDAY1993 </a></li>
<li>校对者: <a href="https://github.com/jiaowoyongqi" target="_blank" rel="external">jiaowoyongqi</a> <a href="https://github.com/shixinzhang" target="_blank" rel="external">shixinzhang</a></li>
</ul>
<h1 id="在开发移动应用时你应该考虑的-「Empty-State」"><a href="#在开发移动应用时你应该考虑的-「Empty-State」" class="headerlink" title="在开发移动应用时你应该考虑的 「Empty State」"></a>在开发移动应用时你应该考虑的 「Empty State」</h1><p>普通应用在安装后的前三天会失去 77% 的日活跃用户。更为严重的是：三十天内，大约<a href="https://www.linkedin.com/pulse/losing-80-mobile-users-normal-why-best-apps-do-better-andrew-chen" target="_blank" rel="external"> 80% 的日活跃用户会流失</a>.</p>
<p>这些低留存率是因为应用做的很烂么？并不总是这个原因。</p>
<p>用户试用了很多应用并且在最初的几天决定要删掉哪些。应用成功的关键是在关键时期吸引住用户。</p>
<p>你的任务是确保用户停留足够长的时间并有很多交互操作来享受应用。 但在这些好情况发生之前他们应该享受第一次使用。</p>
<p>通常我们设计一个很受欢迎的界面，布局里的每个元素看上去都安排的很好。空白状态界面通常是你最后设计的。事实上 empty state 对于吸引用户操作充满潜力。即使 empty state 只是一个临时的阶段，我们必须认真对待它带来的与用户交流的价值。</p>
<p>什么时候用户遇到 empty state？</p>
<ul>
<li><p>第一次使用：应用第一次启动</p>
</li>
<li><p>错误：遇到一些问题</p>
</li>
<li><p>用户删除内容：当用户删掉所有的应用内容</p>
<p>empty state 的作用不仅仅是装饰的作用。除了通知用户页面上期待展示的内容， empty state 也具有优化首次使用体验的作用－－他们告诉用户需要哪些明确的操作，所以应用才会有预期的功能。当用户遇到一个问题， empty state 也是极好（或坏）的。</p>
</li>
</ul>
<p>一个成功 empty state 的完成下面三个目标：</p>
<ul>
<li><p>教育和帮助</p>
</li>
<li><p>让用户愉悦</p>
</li>
<li><p>提示用户进行操作</p>
<p>empty state 的第一个目标是教人们怎么用你的应用。如果他们不理解功能，他们会离开。所以你应该通过建立起对未知的期待，让用户体验更好。</p>
</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/800/1*Ssdl9aLaPp00aSyXk_9dfw.gif" alt=""></p>
<p><a href="https://dribbble.com/shots/2264802-Empty-states" target="_blank" rel="external"> Invoice app </a> —双色插图的空白状态页，清晰地展示了如何快速地管理数据、查看销售业绩以及掌握客户动态的所有功能。</p>
<p> empty state 应该在出错的时候起作用。你需要在 empty state  的友好和有用间找到平衡。当显示错误的时候，向用户解释为什么他看不到任何东西以及如何解决这一问题：</p>
<p><strong>不好的例子:</strong> Spotify 的 empty state 只有 ‘An error occurred’ 信息</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*flCJh0D4pHW_MvN4WRwRxw.png" alt=""></p>
<p><strong><a href="https://itunes.apple.com/us/app/spotify-music/id324684580?mt=8" target="_blank" rel="external">Spotify’s</a></strong> 的错误提示并不像它本该的那样有用。</p>
<p><strong>好的例子:</strong> Azendoo .感到迷茫和失连啦，像你在一个废弃的小岛上？听从建议，保持冷静，点把火，持续刷新就好啦。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*ydkY2tT5WIKUUH6KE6Te3w.png" alt=""></p>
<p><a href="https://itunes.apple.com/us/app/azendoo-tasks-conversations/id581907820?mt=8" target="_blank" rel="external"> Azendoo’s </a>的错误页面好玩又有用。</p>
<p>一个首次使用的好的 empty state 强调如下的时刻：</p>
<p>一个好的印象不仅仅是关于可用性，还关于个性化。如果你的第一个 empty state 页面看上去和相似的产品有一点不同，你已经向用户表明整个产品的体验也可能不同。对于 empty state 你的目标是给用户一个愉快的惊喜。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*lds5Wy3tr9ZfczCvBDQcfA.png" alt=""></p>
<p>苹果上 <strong>Dubizzle</strong> 的没有喜欢的广告。</p>
<p>你能设计一些新鲜或惊喜的么？像是一个动态的 empty state ：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*8rPDEnwRzQnReRL0CKdLzA.gif" alt=""></p>
<p><strong>Workmates</strong>  —动物在单独页面用可爱的hi和hello和你打招呼呢。</p>
<p>或者你可能编个笑话？</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*JBp1Gfz0tEyjkMsnncv-WA.png" alt=""></p>
<p><strong><a href="https://itunes.apple.com/us/app/cognito-brain-training-games/id872808619?mt=8" target="_blank" rel="external">Cognito Brain Training</a></strong> —你会吃惊于看到一只鲨鱼，不管内容。</p>
<p><a href="https://twitter.com/aarron?lang=en" target="_blank" rel="external"> Aaron Walter </a>用人类需求的等级作为一个应用有成功的用户体验的一个<a href="https://speakerdeck.com/aarron/learning-to-love-humans-emotional-interface-design" target="_blank" rel="external">解释</a>；应用除了应该是有用的，可靠的、能用的，也应该是使人欢快的。所以设计下面的页面同理：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*YkkBujuWgkAgfHzF2LhGIA.jpeg" alt=""></p>
<p>在 <strong>Line Play</strong> 里没有新闻结果。不管怎样，这体验很不好。</p>
<p>看你的手机里的首次使用页和其他应用的 empty state 体验。通过以下方法来取悦用户：</p>
<p>将一个 empty state 视为一个微型的登录页面。设计上保持微型的同时，一个成功的页面将会解释一个明确的特性并让用户有下一笔操作。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*8uoH4mJgXckTrXI00ENcsA.png" alt=""></p>
<p>为了在一个 empty state 促使用户下一步操作，你应该这样：</p>
<ul>
<li>刺激用户：用适合用户的刺激性的语言和设计例如： “Learn more” 或 “Let’s get started.”</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/800/1*vPq7xB-7dPR0lbm0yrXokg.png" alt=""></p>
<p><strong><a href="https://itunes.apple.com/us/app/dropbox/id327630330?mt=8" target="_blank" rel="external">Dropbox</a></strong> iOS 应用</p>
<ul>
<li>说服用户：提醒他们当他们使用产品后将会获取的好处</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/800/0*NJntJk_zESA2Wh9r." alt=""></p>
<p><strong><a href="https://flipboard.com/" target="_blank" rel="external">Flipboard</a></strong> 移动端应用</p>
<ul>
<li>引导用户：向他们推荐并展示开始使用应用最好的方法。提供一个提示（或箭头）的按钮来引导用户采取必要的操作来关闭 empty state ，然后得到一个更有意义的页面“</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/800/0*x9PMwcO5DYUoRmeP.png" alt=""></p>
<p>箭头在第二张图提示操作。来源：<a href="https://dribbble.com/shots/2096264-Empty-states" target="_blank" rel="external"> Dribbble </a></p>
<ul>
<li><p>深入研究 empty state 因为它不是用户体验中一个暂时的或很小的部分。让用户在使用你的应用的时候很欢快并且能将个人感觉和产品特性联系起来。向用户介绍应用的好处，用户才能知道他们为什么要在意这个产品。</p>
</li>
<li><p>视觉上保持简单的设计：通常来讲，简洁的页面，清晰的图标或插图和一个 <a href="https://en.wikipedia.org/wiki/CTA" target="_blank" rel="external"> CTA </a> 按钮足够了。</p>
</li>
<li><p>如果 empty state 是被用户的良好行为触发的，用一个愉快的信息来奖励用户。</p>
</li>
<li><p>如果 empty state 是出错后出现的，解释清楚怎样解决这个问题和返回到之前的页面</p>
<p>empty state 和其他设计组件一样重要，因为用户体验是所有能和谐地起作用的部分的总和。用户界面需要信息和操作之间精细的平衡。 empty state 将用户和设计完善的UI界面相连接起来，以此来保留用户的注意力。</p>
</li>
</ul>
<p><em>Follow UX Planet:</em> <a href="https://twitter.com/101babich" target="_blank" rel="external"><em>Twitter</em></a> <em>|</em> <a href="https://www.facebook.com/uxplanet/" target="_blank" rel="external"><em>Facebook</em></a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/15/crab/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/15/crab/" itemprop="url">
                  阳澄湖吃螃蟹
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-15T00:00:00+08:00">
                2016-10-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/15/crab/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/15/crab/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2016-10-15 多云转晴 热</p>
</blockquote>
<p>嗯 组团去吃螃蟹 天气还好 到那儿太阳就出来了 开始热了 很多人 很多车 很多蟹 哈哈哈</p>
<p><span style="color: #ff6600; font-size: 18pt;">#下面是图</span></p>
<p>啦啦啦 到啦<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/crab0.jpg?imageView2/2/h/350"></p>
<p>记得去年绕淀山湖＋阳澄湖 湖边有几条路也向下面这样 一溜儿都是卖螃蟹的</p>
<p>看到有个人牵着绳子遛螃蟹 觉得很好玩<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/crab1.jpg?imageView2/2/h/350"></p>
<p>静候<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/crab2.jpg?imageView2/2/h/350"></p>
<p>嗯 没来得及拍上桌的照片 我来的一个目的就是把吃完的壳再拼回去成完整的形状 啦啦啦 开心</p>
<p>蟹黄和膏都挺多的 都满了  很鲜 小钳子里面都是肉</p>
<p>不出意外 我又是最后一个吃完的人<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/crab3.jpg?imageView2/2/h/350"></p>
<p>嗯 战场<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/crab4.jpg?imageView2/2/h/350"></p>
<p><span style="color: #ff6600; font-size: 18pt;">#总结</span></p>
<p>希望十一月份还有机会去吃肥肥哒</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/07/concert/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/07/concert/" itemprop="url">
                  2016上海站尾场
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-07T00:00:00+08:00">
                2016-10-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/07/concert/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/07/concert/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2016-10-07 小雨 上海体育场 写于21:50</p>
</blockquote>
<p>（刚敷完面膜哦）</p>
<p><span style="color: #ff6600; font-size: 18pt;">#两个半小时的录音</span></p>
<p>今天把十五段录音用imovie合成 找了半天上传音频的网站没找着合适的<br><a href="https://pan.baidu.com/s/1i5Lkv1V" target="_blank" rel="external">点击收听或下载</a> (电脑端的话直接点 可以边听录音边看文章)<br>手机不能点 额 麻烦屈尊挪到电脑上打开听吧<br>百度云盘 链接: <a href="https://pan.baidu.com/s/1ge6LeuR" target="_blank" rel="external">https://pan.baidu.com/s/1ge6LeuR</a><br>想直接点链接的 <a href="https://pan.baidu.com/s/1ge6LeuR" target="_blank" rel="external">戳我</a> 密码: 9ga5</p>
<p>里面喊最大声唱最大声 持续尖叫的人就是我啦</p>
<p>最近事儿多  各种talking各种黄段子啊 你们自己找 下面是歌单 反正就按时间顺序来<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100716%20.jpg?imageView2/2/h/350"></p>
<p>现在我开始边听演唱会录音边码字。。。</p>
<p>昨天的事儿 今天有空记录下 毕竟这辈子就这一次</p>
<p><em><strong>＊＊＊＊＊图和录音明天传</strong></em></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 买票准备</span></span></p>
<p>跟贴吧买的票 四张 和妹子一起去看 还好不是一个人<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100715.jpeg?imageView2/2/h/350"></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 开场前一直纠结的问题</span></span><br>那就是看完咋回来啊 虽说4号和5号都十点半就结束了 可是十点半四号线也没有了啊 我还是不能坐地铁回来啊<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100710.jpeg?imageView2/2/h/350"></p>
<p>又没有顺路的 一个人</p>
<p><ul><br>     <li style="text-align: left;">打车？不敢打啊 最近打车软件出了很多事儿 我害怕</li><br>     <li style="text-align: left;">开车？女司机现在还不敢开啊</li><br>     <li style="text-align: left;">住宿？一个人住外面我还是不敢啊</li><br>     <li style="text-align: left;">算了 实在不行 就去什么网咖带到早上 坐地铁回来好了</li><br></ul><br>开场前一直纠结 毕竟2016年的假期最后一天了 余额不足了 第二天还要上班啊 要不然通宵都行啊</p>
<p>毕竟年轻</p>
<p>后来遇到个小伙伴 给的建议就是 提早走 赶地铁 不然 打车的话 司机车开不进来 周边都得绕道 有可能还会要很多钱</p>
<p>“实在不行 就提前走吧 ”，这是打底儿的准备</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 演唱会准备</span></span></p>
<p>除了正常的官方荧光棒 由于五只代言了莫斯利安 而且把广告搬到了舞台上 会在演唱会上喝酸奶干杯 所以 想 我们能不能带酸奶进去 和大爷们一起干杯呢</p>
<p>后来 怕安检很严 莫斯利安只有杯装的 让试喝一口后也没多少了  就不带了</p>
<p>于是 我买了串香蕉哈哈哈 五个 和小伙伴么分了一下</p>
<p>五只一向有在con／通告／颁奖典礼中吃香蕉的传统</p>
<p>阿信说的 香蕉代表有福同享 雨伞代表有难同当   7号这天阿信打伞了哦 开心</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 关于演唱会时长及安排</span></span></p>
<p>说是7：00开始 这三天（前两天是听闻）都是‘宇宙人’出来唱到7:30 然后五只7:30再出来</p>
<p>结束差不多10:30 那就相当于五月天只唱了三个小时 还算安可</p>
<p>三个小时 你认为能嗨翻么 能尽兴么 虽然能值回票价 可是会差很多</p>
<p>相对于北京场 6:30开始 9:40结束 这还是在鸟巢对于时间是有限制的 所以结束的早</p>
<p>能看出差别了吧</p>
<p>所以上海场相对于北京场迟了一个小时才开场</p>
<p>我也就不多说什么的 可能有什么别的因素 也正常 只是没有说嗨到某个点而已</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 观看中</span></span><br>场外<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10072.jpeg?imageView2/2/h/350"><br>每个座位都夹了一个扇子 好大的广告<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10071.jpeg?imageView2/2/h/350"><br>由于自己前两天就很紧张 真的很紧张 “wc我等了四年呢啊啊啊啊啊啊” 对 就这种心情</p>
<p>背了一天歌词 嗯 参考4号和5号的歌单 划重点哈哈哈</p>
<p>所以从开场《do you ever shine?》 开始 就很嗨 唱很大声 蹦的也很频繁 就是那种兴奋的要跳起来</p>
<p>我全场录了音 除了有几个场景需要拍照 或者温柔的时候要打电话没有录到</p>
<p>阿信一开场打招呼的时候 声音就是哑的 没办法 就这样吧 这么多年过去了 嗓子也需要休息了</p>
<p>今晚五个四十岁男人的颜值都好高啊 好帅啊 就那种妹子都要去跪西装裤子冲动</p>
<p>阿信好像又变帅了呢 穿上西装好帅啊啊啊啊啊</p>
<p>果然怪兽最爱赤膊</p>
<p>知足最后一句 阿信还是没唱上去 哎 老了啊</p>
<p>少年 你能不能唱上去么 我嗓子都准备好呢</p>
<p>打招呼的时候 石头说今晚人变密了 阿信接下对观众说 “你们变密（便秘）了 需要疏通” 自己想啊  都笑喷了 后来 又解释说 “是人和人之间变密了 不是人自己” 怪兽接，“哦 不是人自己变紧了” 啊啊啊 什么鬼 不开黄腔就不能值回票价么啊喂</p>
<p>某次阿信又建议说 “不要总把荧光棒左右摇晃嘛 来 大家上下摆动看看”  额 反应了好久 大家都做出那个动作了 才反应过来说  阿信好污啊</p>
<p>说好的延伸台呢  之前的座位图有延伸台啊 骗纸</p>
<p>我们在16看台2层 偏角有点大 再远一点其实视野正好 因为看不到冠佑打鼓 只能通过大屏幕看</p>
<p>妹子说 看到了阿信打鼓 玛莎拉大提琴 如果今晚阿信再弹吉他 她今晚就死在这儿 事实证明 额 阿信最后真弹吉他了<br>后面 唱啥来着 不记得了 大信信换了件衣服 真是可爱的不要不要的 把妹子都迷倒了<br>图凑合着看吧<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100711.jpeg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100712.jpeg?imageView2/2/h/350"></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 12pt;">## 最爱玛甜甜</span></span></p>
<p>说下玛甜甜 头发好像又长了 百分之九十最先入镜的是他低着头飘逸的长发遮住脸 被风吹拂  在跳舞 画面太美<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10075.jpeg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10076.jpeg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100713.jpeg?imageView2/2/h/350"></p>
<p>看到了玛莎拉大提琴 弹钢琴   因为真的很热 像我边蹦跶边唱 浑身是汗 刚开始他们还穿西装 更热 唱《诺亚方舟》的时候 有个镜头就是他抬起头 头发都粘在脸上了 心疼</p>
<p>“他怎么也不剪啊” 从开场 就蹦得很嗨 记得有一首歌 大家都坐在桌子旁 只有他一个人在后面跳舞晃头自嗨了一首歌 那飘逸的长发 帅呆了 好想去问问他用什么牌子的洗发水啊 （这个问题之前有人问过  他回答说 就一般的啊 ）</p>
<p>又有一首歌 应该是《笑忘歌》 大家都左右摇晃荧光棒 啊 玛莎很可爱的举起了餐桌上的一整只烛台来左右晃 就这样晃了一整首歌 啊啊啊啊啊</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 14pt;">#《温柔》</span></span><br>这个梗 该懂的人都懂啊</p>
<p>四年前 2012年7月19号 那时候 我大二  早早跟贴吧买了票 7月初就放暑假了 于是 我一个怕热的人硬是在学校多呆了半个月</p>
<p>和室友一起去看</p>
<p>之前也喜欢五月天一段时间了  知道温柔的梗   那时候还有我暗恋的人  从高二开始 一直没说出口 高考后 大家都考入了不同的学校 甚至不在一个省 也就放假见见 所以还是想让对方知道吧 于是 大晚上的给他打电话 因为现场 很多人 信号不好 就算打通了电话也听不清对方到底接没接通 接通了双方说什么能不能听得到  反正我听不到 所以 我心里也很忐忑  但是 没办法 这辈子可能就这一次机会来告白 勇敢一点吧（厚着脸皮一次好了）</p>
<p>于是 就打电话  因为不知道能不能接通就隔一分钟挂断 当时想的就是 我把要说的话说出来  让你听到 就可以了</p>
<p>嗯</p>
<p>第二天 那人给我打电话说 “你那么晚打电话啥事儿啊 喝多了吧 ”</p>
<p>我说 嗯 “我喝多了”</p>
<p>—-over—-</p>
<p>现在觉得说 我那时至少还有喜欢的人 默默的放在心里 那时候还用人人 qq空间</p>
<p>会悄悄的去看他的动态 好奇他的近况 会看他的访客互动 动态下留言 猜测他的心情。。。</p>
<p>暗恋就是这样啊 你不想让对方知道 你又怕对方不知道 很纠结 也很美好</p>
<p>咳咳 不讲故事了</p>
<p>为了圆打电话的愿望 （我觉得既然那个人没陪你来看演唱会 有一个能打给的人也很好）我厚着脸皮让老年人准备大晚上的接我电话 对 就是那个扛把子的 电话接通了 听到了  很高兴<br><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 14pt;"># 关于门票</span></span></p>
<p>有很多人通过某些渠道 网上或是场外黄牛买到了假票 很多人都被骗了 所以你们要理智 啊 不会从五吧和纯真收票么 而且今年的票务方也是有脑子哦 一段段放票后 造成票子紧张的局面 抬高了价钱 上海首场黄牛255的票子卖500多 （其实对于黄牛党 我的观点就是 为了利益 加价可以接受 卖假票还有没有良心啦） 以至于后来票子卖不出去 十一前一个星期 永乐票务还有大量余票 一个朋友25号下单买了张555的票 收到的是票价755的 哈哈哈 吃惊</p>
<p>反正我只信任五吧和纯真 感谢这两个组织 不加价无假票 感谢默默付出的相关人员 尤其是团购相关的 五吧的座位一直都很好 这次555的座位已经很值了 离舞台超近 嗯 希望以后还能一起看演唱会<br><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 14pt;"></span></span></p>
<h1 id="什么感动了你"><a href="#什么感动了你" class="headerlink" title="什么感动了你"></a>什么感动了你</h1><p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 14pt;">## 行李箱</span></span><br>本来以为上海尾场人会变少 6:40进场 看人确实也不多 我们右边四个座位都是空的</p>
<p>后来慢慢的入座 内场也差不多坐满了 除了后区右侧 有一个正方形的区域  位子没几个人坐 很明晰</p>
<p>到开场的时候 差不多都坐满了 右边两个座位还是空的。。。。</p>
<p>后来 人来了 被惊到了 一个妹子拎着行李箱来的<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10073.jpeg?imageView2/2/h/350"><br>（写到这儿 我都又感动了一下呢）</p>
<p>真爱啊 佩服</p>
<p>后来 出去的时候 又看到了几个行李箱 你们来得值 嗯 路上有多少汗水都值</p>
<h2 id="安可时举的标语-平板和毯子"><a href="#安可时举的标语-平板和毯子" class="headerlink" title="安可时举的标语 平板和毯子"></a>安可时举的标语 平板和毯子</h2><p>还记得么</p>
<p>“请让我们一起喊安可”</p>
<p>。。。。。<br><span style="color: #ff6600; font-size: 14pt;">#图<br>很喜欢蓝海 也喜欢彩虹<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10074.jpeg?imageView2/2/h/350"></span></p>
<p><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10077.jpeg?imageView2/2/h/350"><br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10078.jpeg?imageView2/2/h/350"><br><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;"># 结束后赶地铁</span></span></p>
<p>心中有不舍啊 因为不知道大爷们到底打算唱到几点啊</p>
<p>这是上海站尾场 加时很正常 而且演唱会过程中 冠佑透露 可能会多唱几首</p>
<p>12年诺亚方舟 十一点多才结束</p>
<p>所以今晚 如果唱到十一点多  那我十点多就走了 就有很多遗憾</p>
<p>由于从大爷们七点半开场就一直很嗨 跟唱 有时候激动的一直蹦达 跳起来 到了温柔唱出来 觉得也没什么遗憾了  就算少听了安可的歌 所以任性的决定先走吧 自己的生活还要继续</p>
<p>22:12听着倒数第四首歌《转眼》的时候果断收拾东西 和妹子抱了抱 边听转眼边跟着人群满满走出演唱会</p>
<p>出来的时候 拍了张照片 我来过 真好<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/100714.jpeg?imageView2/2/h/350"><br>跑去赶地铁 跑出去之后 天空下起了小雨 开始唱洋葱了  于是就边跑边唱摇着荧光棒唱洋葱 那场面 也是难忘</p>
<p>刚开始跑反了方向 到了一个十字路口 问了穿制服的 又往回跑</p>
<p>那时候只有几个妹子在跑 很多人都是正常走 嗯 可能是因为我们比较远吧</p>
<p>快跑到地铁口的时候 听到工作人员在喊 说  最后一班地铁快到了</p>
<p>于是 跑的人多了起来</p>
<p>超热 sr不是盖的 面料真不透气啊 蹦跶了三个小时＋一路赶地铁狂奔 现在静下来 满头大汗</p>
<p>貌似还有几分钟到22:34分呢 于是 拿出了发的扇子 扇风 擦汗</p>
<p>这就意味着 我能坐地铁回去啦 不怕回不去啦啦啦啦</p>
<p>回到家都快十二点了 大雨</p>
<p>实际上 演唱会三首歌后结束 我也没什么可惜的了 还好<br><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 14pt;">＃ 碎碎念</span></span><br>这三天朋友圈都说被刷屏 说可以通过朋友圈看直播哈哈哈哈</p>
<p>体育场一进去就各种周边 每个铺子都写着“五月天官方荧光棒摊位”也是醉了<br><img src="http://7xsw2u.com1.z0.glb.clouddn.com/10079.jpeg?imageView2/2/h/350"><br>而且 就算是官方买的荧光棒 质量好像也不太好 知道的两个妹子都坏了 还要去买新的 一个四十呢 不得不说 五只有头脑 演唱会的可控荧光棒数量可观呢</p>
<p>我不是脑残粉 只是一个喜欢了五年的迷妹</p>
<p>不是信仰 不是梦想 只是成长路上的背景音乐</p>
<p>还记得八十岁的约定 无论那是我在哪里 都会去的 一大家子人一起去</p>
<p>今早上班 找同事借充电器 同事说我 “咋春风得意的呢”</p>
<p>额  额  额 就是默默的爆发了下 觉得生活很美好 我有想要的 有期待的 有追求的 我就有努力的动力</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff6600; font-size: 18pt;">－－总结－－</span></span></p>
<p>所以 下一场演唱会你还是会一个人么？？？</p>
<p>23:34 困了 演唱会录音明天再传吧。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/01/spicy-hot-pot/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="gleamwang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="gleamwang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/01/spicy-hot-pot/" itemprop="url">
                  麻辣香锅系列
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-01T00:00:00+08:00">
                2016-10-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/01/spicy-hot-pot/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/01/spicy-hot-pot/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>2016-10 天气转冷 请预防感冒</p>
</blockquote>
<p>一米九给邮了一些火锅底料麻辣香锅锅底啊 两斤装的郫县豆瓣酱什么的</p>
<p>对 就右下角的身长一米九的一米九</p>
<p>于是 就慢慢试试看</p>
<p><span style="color: #ff6600; font-size: 18pt;">#下面是图</span></p>
<h2 id="1022试吃"><a href="#1022试吃" class="headerlink" title="1022试吃"></a>1022试吃</h2><p>酱<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10234.jpg?imageView2/2/h/350"></p>
<p>切好<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10235.jpg?imageView2/2/h/350"></p>
<p>最近很喜欢闻洋葱在油里炸的味 很香<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10236.jpg?imageView2/2/h/350"></p>
<p>不好看<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10237.jpg?imageView2/2/h/350"></p>
<p>不好看＋1<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10238.jpg?imageView2/2/h/350"></p>
<p>不好看＋2<br><img class="" src="http://7xsw2u.com1.z0.glb.clouddn.com/10239.jpg?imageView2/2/h/350"></p>
<p><span style="color: #ff6600; font-size: 18pt;">#总结</span></p>
<p>总归要尝试的是不是</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">69</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"洞洞1993"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  

  

  

  

  


</body>
</html>
